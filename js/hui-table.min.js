/*! harmony-ui-components - v23.5.0 - 2017-04-05 
 * Copyright (c) 2017 Intuit; Licensed  */

var forDocument,fragmentFasterHeuristic=/[-+,> ]/,factory=function(a,b){"use strict";function c(b,c){b.appendChild(a.createTextNode(c))}function d(b){function i(){n&&m&&n!=m&&(m==b&&(j||(j=fragmentFasterHeuristic.test(r)&&a.createDocumentFragment()))?j:m).insertBefore(n,l||null)}for(var j,k,l,m,n,o=arguments,p=o[0],q=0;q<o.length;q++){var r=o[q];if("object"==typeof r){if(k=!1,r instanceof Array){n=a.createDocumentFragment();for(var s=0;s<r.length;s++)n.appendChild(d(r[s]));r=n}if(r.nodeType)n=r,i(),m=r,l=0;else for(var s in r)n[s]=r[s]}else if(k)k=!1,c(n,r);else{q<1&&(b=null),k=!0;var t=r.replace(f,function(f,j,k,p,s,t){j&&(i(),"-"==j||"+"==j?(m=(l=n||m).parentNode,n=null,"+"==j&&(l=l.nextSibling)):("<"==j?m=n=(n||m).parentNode:(","==j?m=b:n&&(m=n),n=null),l=0),n&&(m=n));var u=!k&&p;if(u||!n&&(k||s))if("$"==u)c(m,o[++q]);else{u=u||d.defaultTag;var v=h&&o[q+1]&&o[q+1].name;v&&(u="<"+u+' name="'+v+'">'),n=g&&~(e=u.indexOf("|"))?a.createElementNS(g[u.slice(0,e)],u.slice(e+1)):a.createElement(u)}if(k)if("$"==p&&(p=o[++q]),"#"==k)n.id=p;else{var w=n.className,x=w&&(" "+w+" ").replace(" "+p+" "," ");if("."==k)n.className=w?(x+p).substring(1):p;else if("!"==r){var y;h?d("div",n,"<").innerHTML="":(y=n.parentNode)&&y.removeChild(n)}else(x=x.substring(1,x.length-1))!=w&&(n.className=x)}if(s)if("$"==t&&(t=o[++q]),"style"==s)n.style.cssText=t;else{var z="!"==s.charAt(0)?(s=s.substring(1))&&"removeAttribute":"setAttribute";t=""===t?s:t,g&&~(e=s.indexOf("|"))?n[z+"NS"](g[s.slice(0,e)],s.slice(e+1),t):n[z](s,t)}return""});if(t)throw new SyntaxError("Unexpected char "+t+" in "+r);i(),m=p=n||m}}return b&&j&&b.appendChild(j),p}fragmentFasterHeuristic=b||fragmentFasterHeuristic;var e,f=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,g=!1,a=a||document,h="object"==typeof a.createElement;return d.addNamespace=function(b,c){a.createElementNS?(g||(g={}))[b]=c:a.namespaces.add(b,c)},d.defaultTag="div",d.forDocument=forDocument,d};!function(a){a=a||deps,"function"==typeof define&&define.amd?define("hui/table/put",[],a):"undefined"==typeof window?require("./node-html")(module,a):put=a()}(factory),define("dgrid-0.4/util/misc",["dojo/_base/kernel","dojo/has","put-selector/put"],function(a,b,c){function d(a){var b,c,d=h[a];if(void 0!==d)for(e[f](d),h[a]=void 0,b=a+1,c=h.length;b<c;b++)h[b]>d&&h[b]--}b.add("dom-contains",function(a,b,c){return!!c.contains});var e,f,g,h=[],i=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,j={defaultDelay:15,throttle:function(a,b,c){var d=!1;return c=c||j.defaultDelay,function(){d||(d=!0,a.apply(b,arguments),setTimeout(function(){d=!1},c))}},throttleDelayed:function(a,b,c){var d=!1;return c=c||j.defaultDelay,function(){if(!d){d=!0;var e=arguments;setTimeout(function(){d=!1,a.apply(b,e)},c)}}},debounce:function(a,b,c){var d;return c=c||j.defaultDelay,function(){d&&(clearTimeout(d),d=null);var e=arguments;d=setTimeout(function(){a.apply(b,e)},c)}},each:function(a,b,c){var d,e;if(a)if("number"==typeof a.length)for(d=0,e=a.length;d<e;d++)b.call(c,a[d],d,a);else for(d in a)b.call(c,a[d],d,a)},contains:function(b,c){return a.deprecated("miscUtil.contains","Use Node#contains instead, which all browsers supported by dgrid already support.","1.0"),b.contains(c)},addCssRule:function(a,b){e||(e=c(document.getElementsByTagName("head")[0],"style"),e=e.sheet||e.styleSheet,f=e.deleteRule?"deleteRule":"removeRule",g=e.cssRules?"cssRules":"rules");var i=h.length;return h[i]=(e.cssRules||e.rules).length,e.addRule?e.addRule(a,b):e.insertRule(a+"{"+b+"}",h[i]),{get:function(a){return e[g][h[i]].style[a]},set:function(a,b){void 0!==h[i]&&(e[g][h[i]].style[a]=b)},remove:function(){d(i)}}},escapeCssIdentifier:function(a,b){return"string"==typeof a?a.replace(i,b||"\\$1"):a}};return j}),define("dgrid-0.4/List",["dojo/_base/declare","dojo/on","dojo/has","./util/misc","xstyle/has-class","put-selector/put","dojo/_base/sniff","xstyle/css!./css/dgrid.css"],function(a,b,c,d,e,f){function g(a){return document.getElementById(a)}function h(a){a.className="",a.parentNode&&document.body.removeChild(a)}function i(a,b){f(document.body,a,".dgrid-scrollbar-measure");var c=a["offset"+b]-a["client"+b];return h(a),c}function j(){return t.autoIdPrefix+q++}function k(a){var b=a?"."+a.replace(r,"."):"";this._class&&(b="!"+this._class.replace(r,"!")+b),f(this.domNode,b),this._class=a}function l(){return this._class}e("mozilla","touch"),c.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a&&"MSPointer"});var m,n,o="dgrid-row-odd",p="dgrid-row-even";c.add("dom-scrollbar-width",function(a,b,c){return i(c,"Width")}),c.add("dom-scrollbar-height",function(a,b,c){return i(c,"Height")}),c.add("dom-rtl-scrollbar-left",function(a,b,d){var e,g=f("div");return f(document.body,d,".dgrid-scrollbar-measure[dir=rtl]"),f(d,g),e=!!c("ie")||!!c("trident")||/\bEdge\//.test(navigator.userAgent)||g.offsetLeft>=c("dom-scrollbar-width"),h(d),f(g,"!"),d.removeAttribute("dir"),e});var q=0,r=/ +/g,s=function(){this._started&&this.resize()},t=a(null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,addUiClasses:!0,highlightDuration:250,postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a,this.data=b,this.element=c}).prototype.remove=function(){c.removeRow(this.element)},b&&(this.srcNodeRef=b=b.nodeType?b:g(b)),this.create(a,b)},listType:"list",create:function(b,c){var d,e=this.domNode=c||f("div");b&&(this.params=b,a.safeMixin(this,b),d=b.class||b.className||e.className),this.sort=this.sort||[],this._listeners=[],this._rowIdToObject={},this.postMixInProperties&&this.postMixInProperties(),this.id=e.id=e.id||this.id||j(),this.buildRendering(),d&&k.call(this,d),this.postCreate(),delete this.srcNodeRef,this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a,e,g,h,i=this.domNode,j=this.addUiClasses,k=this;h=this.isRTL="rtl"===(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase(),i.className="",f(i,"[role=grid].dgrid.dgrid-"+this.listType+(j?".ui-widget":"")),a=this.headerNode=f(i,"div.dgrid-header.dgrid-header-row"+(j?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden")),e=this.bodyNode=f(i,"div.dgrid-scroller"),c("ff")&&(e.tabIndex=-1),this.headerScrollNode=f(i,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(j?".ui-widget-header":"")),g=this.footerNode=f("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden")),f(i,g),h&&(i.className+=" dgrid-rtl"+(c("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":"")),b(e,"scroll",function(c){k.showHeader&&(a.scrollLeft=c.scrollLeft||e.scrollLeft),c.stopPropagation(),b.emit(i,"scroll",{scrollTarget:e})}),this.configStructure(),this.renderHeader(),this.contentNode=this.touchNode=f(this.bodyNode,"div.dgrid-content"+(j?".ui-widget-content":"")),this._listeners.push(this._resizeHandle=b(window,"resize",d.throttleDelayed(s,this)))},postCreate:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this.sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,b=this.headerNode,e=this.footerNode,f=b.offsetHeight,g=this.showFooter?e.offsetHeight:0;this.headerScrollNode.style.height=a.style.marginTop=f+"px",a.style.marginBottom=g+"px",m||(m=c("dom-scrollbar-width"),n=c("dom-scrollbar-height"),c("ie")&&(m++,n++),d.addCssRule(".dgrid-scrollbar-width","width: "+m+"px"),d.addCssRule(".dgrid-scrollbar-height","height: "+n+"px"),17!==m&&(d.addCssRule(".dgrid-header-row","right: "+m+"px"),d.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+m+"px")))},addCssRule:function(a,b){var c=d.addCssRule(a,b);return this.cleanAddedRules&&this._listeners.push(c),c},on:function(a,d){var e=b(this.domNode,a,d);return c("dom-addeventlistener")||this._listeners.push(e),e},cleanup:function(){var a;for(a in this._rowIdToObject)if(this._rowIdToObject[a]!==this.columns){var b=g(a);b&&this.removeRow(b,!0)}},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();this._listeners=null}this._started=!1,this.cleanup(),f(this.domNode,"!")},refresh:function(){this.cleanup(),this._rowIdToObject={},this._autoRowId=0,this.contentNode.innerHTML="",this.scrollTo({x:0,y:0})},highlightRow:function(a,b){a=a.element||a,f(a,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":"")),setTimeout(function(){f(a,"!dgrid-highlight!ui-state-highlight")},b||this.highlightDuration)},adjustRowIndices:function(a){var b=a,c=b.rowIndex;if(c>-1)do{b.rowIndex>-1&&(this.maintainOddEven&&(b.className+" ").indexOf("dgrid-row ")>-1&&f(b,"."+(c%2==1?o:p)+"!"+(c%2==0?o:p)),b.rowIndex=c++)}while((b=b.nextSibling)&&b.rowIndex!==c)},renderArray:function(a,b,c){c=c||{};var d,e=this,f=c.start||0,g=document.createDocumentFragment(),h=[],i=0,j=a.length;for(b||(this._lastCollection=a);i<j;)h[i]=this.insertRow(a[i],g,null,f++,c),i++;return d=b?b.parentNode:e.contentNode,d&&d.parentNode&&(d!==e.contentNode||j)&&(d.insertBefore(g,b||null),j&&e.adjustRowIndices(h[j-1])),h},renderHeader:function(){},_autoRowId:0,insertRow:function(a,b,c,d,e){var f=this.id+"-row-"+(this.collection&&this.collection.getIdentity?this.collection.getIdentity(a):this._autoRowId++),h=g(f),i=h&&h.previousSibling;return h&&(h===c&&(c=(c.connected||c).nextSibling),this.removeRow(h,!1,e)),h=this.renderRow(a,e),h.className=(h.className||"")+" dgrid-row "+(d%2==1?o:p)+(this.addUiClasses?" ui-state-default":""),this._rowIdToObject[h.id=f]=a,b.insertBefore(h,c||null),h.rowIndex=d,i&&i.rowIndex!==h.rowIndex-1&&this.adjustRowIndices(i),h},renderRow:function(a){return f("div",""+a)},removeRow:function(a,b){a=a.element||a,delete this._rowIdToObject[a.id],b||f(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);{if(!a.nodeType)return"object"==typeof a?b=this.collection.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,g(this.id+"-row-"+b));var c;do{var d=a.id;if(c=this._rowIdToObject[d])return new this._Row(d.substring(this.id.length+5),c,a);a=a.parentNode}while(a&&a!==this.domNode)}},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f,g;g=f=a.element,b=b||1;do{if(e=f[b<0?"previousSibling":"nextSibling"]){do{if((f=e)&&(f.className+" ").indexOf(c+" ")>-1){g=f,b+=b<0?1:-1;break}}while(e=(!d||!f.hidden)&&f[b<0?"lastChild":"firstChild"])}else if(!(f=f.parentNode)||f===this.bodyNode||f===this.headerNode)break}while(b);return g},up:function(a,b,c){return a.element||(a=this.row(a)),this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){return a.element||(a=this.row(a)),this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:function(a){void 0!==a.x&&(this.bodyNode.scrollLeft=a.x),void 0!==a.y&&(this.bodyNode.scrollTop=a.y)},getScrollPosition:function(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}},get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"==typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):(c("dojo-built")||"function"!=typeof this[b+"Attr"]||console.warn("dgrid: Use "+b+" instead of "+b+"Attr for getting "+a),this[a])},set:function(a,b){if("object"==typeof a)for(var d in a)this.set(d,a[d]);else{var e="_set"+a.charAt(0).toUpperCase()+a.slice(1);"function"==typeof this[e]?this[e].apply(this,[].slice.call(arguments,1)):(c("dojo-built")||"function"!=typeof this[e+"Attr"]||console.warn("dgrid: Use "+e+" instead of "+e+"Attr for setting "+a),this[a]=b)}return this},_getClass:l,_setClass:k,_getClassName:l,_setClassName:k,_setSort:function(a,b){this.sort="string"!=typeof a?a:[{property:a,descending:b}],this._applySort()},_applySort:function(){if(this.refresh(),this._lastCollection){var a=this.sort;if(a&&a.length>0){var b=a[0].property,c=!!a[0].descending;this._lastCollection.sort(function(a,d){var e=a[b],f=d[b];return void 0===e&&(e=""),void 0===f&&(f=""),e===f?0:e>f!==c?1:-1})}this.renderArray(this._lastCollection)}},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a,f(b,(a?"!":".")+"dgrid-header-hidden"),this.renderHeader(),this.resize(),a&&(b.scrollLeft=this.getScrollPosition().x)},_setShowFooter:function(a){this.showFooter=a,f(this.footerNode,(a?"!":".")+"dgrid-footer-hidden"),this.resize()}});return t.autoIdPrefix="dgrid_",t}),define("dgrid-0.4/Grid",["dojo/_base/declare","dojo/_base/kernel","dojo/on","dojo/has","put-selector/put","./List","./util/misc","dojo/_base/sniff"],function(a,b,c,d,e,f,g){function h(a,b){b&&b.nodeType&&a.appendChild(b)}function i(a){return g.escapeCssIdentifier(a,"-")}var j=a(f,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!=typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,b){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&(a=a.target);var c;if(a.nodeType)do{if(this._rowIdToObject[a.id])break;var d=a.columnId;if(d){b=d,c=a;break}a=a.parentNode}while(a&&a!==this.domNode);if(!c&&void 0!==b){var e=this.row(a),f=e&&e.element;if(f)for(var g=f.getElementsByTagName("td"),h=0;h<g.length;h++)if(g[h].columnId===b){c=g[h];break}}return null!=a?{row:e||this.row(a),column:b&&this.column(b),element:c}:void 0},createRowCells:function(a,b,c,f){var g,h,j,k,l,m,n,o,p,q,r,s,t,u=e("table.dgrid-row-table[role=presentation]"),v=d("ie")<9?e(u,"tbody"):u;for(c=c||this.subRows,h=0,j=c.length;h<j;h++)for(m=c[h],g=e(v,"tr"),m.className&&e(g,"."+m.className),k=0,l=m.length;k<l;k++)n=m[k],o=n.id,p=n.field?".field-"+i(n.field):"",q="function"==typeof n.className?n.className(f):n.className,q&&(p+="."+q),r=e(a+".dgrid-cell"+(o?".dgrid-column-"+i(o):"")+p.replace(/ +/g,".")+"[role="+("th"===a?"columnheader":"gridcell")+"]"),r.columnId=o,s=n.colSpan,s&&(r.colSpan=s),t=n.rowSpan,t&&(r.rowSpan=t),b(r,n),g.appendChild(r);return u},left:function(a,b){return a.element||(a=this.cell(a)),this.cell(this._move(a,-(b||1),"dgrid-cell"))},right:function(a,b){return a.element||(a=this.cell(a)),this.cell(this._move(a,b||1,"dgrid-cell"))},_defaultRenderCell:function(a,b,c){if(this.formatter){var d=this.formatter,e=this.grid.formatterScope;c.innerHTML="string"==typeof d&&e?e[d](b,a):this.formatter(b,a)}else null!=b&&c.appendChild(document.createTextNode(b))},renderRow:function(a,b){var c=this,d=this.createRowCells("td",function(d,e){var f=a;e.get?f=e.get(a):"field"in e&&"_item"!==e.field&&(f=f[e.field]),e.renderCell?h(d,e.renderCell(a,f,d,b)):c._defaultRenderCell.call(e,a,f,d,b)},b&&b.subRows,a);return e("div[role=row]>",d)},renderHeader:function(){var a=this,b=this.headerNode,f=b.childNodes.length;for(b.setAttribute("role","row");f--;)e(b.childNodes[f],"!");var g=this.createRowCells("th",function(a,b){var c=b.headerNode=a,d=b.field;d&&(a.field=d),b.renderHeaderCell?h(c,b.renderHeaderCell(c)):("label"in b||b.field)&&c.appendChild(document.createTextNode("label"in b?b.label:b.field)),!1!==b.sortable&&d&&"_item"!==d&&(a.sortable=!0,a.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[g.id=this.id+"-header"]=this.columns,b.appendChild(g),this._sortListener&&this._sortListener.remove(),this._sortListener=c(g,"click,keydown",function(e){if("click"===e.type||32===e.keyCode||!d("opera")&&13===e.keyCode){var f,g,h,i,j=e.target;do{if(j.sortable){h=[{property:f=j.field||j.columnId,descending:(g=a.sort[0])&&g.property===f&&!g.descending}],i={bubbles:!0,cancelable:!0,grid:a,parentType:e.type,sort:h},c.emit(e.target,"dgrid-sort",i)&&(a._sortNode=j,a.set("sort",h));break}}while((j=j.parentNode)&&j!==b)}})},resize:function(){var a,b=this.headerNode.firstChild,c=this.contentNode;this.inherited(arguments),c.style.width="",c&&b&&(a=b.offsetWidth)>c.offsetWidth&&(c.style.width=a+"px")},destroy:function(){this._destroyColumns(),this._sortListener&&this._sortListener.remove(),this.inherited(arguments)},_setSort:function(){this.inherited(arguments),this.updateSortArrow(this.sort)},_findSortArrowParent:function(a){var b=this.columns;for(var c in b){var d=b[c];if(d.field===a)return d.headerNode}},updateSortArrow:function(a,b){if(this._lastSortedArrow&&(e(this._lastSortedArrow,"<!dgrid-sort-up!dgrid-sort-down"),e(this._lastSortedArrow,"!"),delete this._lastSortedArrow),b&&(this.sort=a),a[0]){var c,d=a[0].property,f=a[0].descending,g=this._sortNode||this._findSortArrowParent(d);delete this._sortNode,g&&(g=g.contents||g,c=this._lastSortedArrow=e("div.dgrid-sort-arrow.ui-icon[role=presentation]"),c.innerHTML="&nbsp;",g.insertBefore(c,g.firstChild),e(g,f?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(a,b){return this.addCssRule("#"+g.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+i(a),b)},_configColumns:function(a,c){function d(d,g){"string"==typeof d&&(c[g]=d={label:d}),f||d.field||(d.field=g),g=d.id=d.id||(isNaN(g)?g:a+g),this._configColumn&&(this._configColumn(d,c,a),g=d.id),f&&(this.columns[g]=d),d.grid=this,"function"==typeof d.init&&(b.deprecated("colum.init","Column plugins are being phased out in favor of mixins for better extensibility. column.init may be removed in a future release."),d.init()),e.push(d)}var e=[],f=c instanceof Array;return g.each(c,d,this),f?c:e},_destroyColumns:function(){var a,c,d,e,f=this.subRows,g=f&&f.length;for(this.cleanup(),a=0;a<g;a++)for(c=0,e=f[a].length;c<e;c++)d=f[a][c],"function"==typeof d.destroy&&(b.deprecated("colum.destroy","Column plugins are being phased out in favor of mixins for better extensibility. column.destroy may be removed in a future release."),d.destroy())},configStructure:function(){var a=this.subRows,b=this._columns=this.columns;if(this.columns=!b||b instanceof Array?{}:b,a)for(var c=0;c<a.length;c++)a[c]=this._configColumns(c+"-",a[c]);else this.subRows=[this._configColumns("",b)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns(),this.subRows=null,this.columns=a,this._updateColumns()},_setSubRows:function(a){this._destroyColumns(),this.subRows=a,this._updateColumns()},_updateColumns:function(){this.configStructure(),this.renderHeader(),this.refresh(),this._lastCollection&&this.renderArray(this._lastCollection),this._started&&(this.sort.length?this.updateSortArrow(this.sort):this.resize())}});return j.appendIfNode=h,j}),define("dgrid-0.4/Keyboard",["dojo/_base/declare","dojo/aspect","dojo/on","dojo/_base/lang","dojo/has","put-selector/put","./util/misc","dojo/_base/sniff"],function(a,b,c,d,e,f,g){function h(a){a.preventDefault()}var i={checkbox:1,radio:1,button:1},j=/\bdgrid-cell\b/,k=/\bdgrid-row\b/,l=a(null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments),this.keyMap||(this.keyMap=d.mixin({},l.defaultKeyMap)),this.headerKeyMap||(this.headerKeyMap=d.mixin({},l.defaultHeaderKeyMap))},postCreate:function(){function a(a){var b=a.target;return b.type&&(!i[b.type]||32===a.keyCode)}function d(d){function f(){if(e._focusedHeaderNode&&(e._focusedHeaderNode.tabIndex=-1),e.showHeader){if(h){for(var a,b=e.headerNode.getElementsByTagName("th"),c=0;a=b[c];++c)if(i.test(a.className)){e._focusedHeaderNode=m=a;break}}else e._focusedHeaderNode=m=e.headerNode;m&&(m.tabIndex=e.tabIndex)}}function g(){var a=e._focusedNode||m;if(!i.test(a.className)||!d.contains(a)){for(var b,c=d.getElementsByTagName("*"),f=0;b=c[f];++f)if(i.test(b.className)){a=e._focusedNode=b;break}m.tabIndex=-1,a.tabIndex=e.tabIndex}}var h=e.cellNavigation,i=h?j:k,l=d===e.headerNode,m=d;l?(f(),b.after(e,"renderHeader",f,!0)):(b.after(e,"renderArray",g,!0),b.after(e,"_onNotification",function(a,b){0===b.totalLength?d.tabIndex=0:1===b.totalLength&&"add"===b.type&&g()},!0)),e._listeners.push(c(d,"mousedown",function(b){a(b)||e._focusOnNode(b.target,l,b)})),e._listeners.push(c(d,"keydown",function(b){if(!b.metaKey&&!b.altKey){var c=e[l?"headerKeyMap":"keyMap"][b.keyCode];c&&!a(b)&&c.call(e,b)}}))}this.inherited(arguments);var e=this;this.tabableHeader&&(d(this.headerNode),c(this.headerNode,"dgrid-cellfocusin",function(){e.scrollTo({x:this.scrollLeft})})),d(this.contentNode),this._debouncedEnsureScroll=g.debounce(this._ensureScroll,this)},removeRow:function(a){if(!this._focusedNode)return this.inherited(arguments);var b,c=this,d=document.activeElement===this._focusedNode,e=this[this.cellNavigation?"cell":"row"](this._focusedNode),f=e.row||e;a=a.element||a,a===f.element&&(b=this.down(f,!0),b&&b.element!==a||(b=this.up(f,!0)),this._removedFocus={active:d,rowId:f.id,columnId:e.column&&e.column.id,siblingId:b&&b.element!==a?b.id:void 0},setTimeout(function(){c._removedFocus&&c._restoreFocus(f.id)},0),this._focusedNode=null),this.inherited(arguments)},insertRow:function(){var a=this.inherited(arguments);return this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(a),a},_restoreFocus:function(a){var b,c,d=this._removedFocus;if(a=a&&this.row(a),(b=a&&a.element&&a.id===d.rowId?a:void 0!==d.siblingId&&this.row(d.siblingId))&&b.element){if(!b.element.parentNode.parentNode)return void(d.wait=!0);void 0!==d.columnId&&(c=this.cell(b,d.columnId))&&c.element&&(b=c),d.active&&0!==b.element.offsetHeight?this._focusOnNode(b,!1,null):(f(b.element,".dgrid-focus"),b.element.tabIndex=this.tabIndex,this._focusedNode=b.element)}delete this._removedFocus},addKeyHandler:function(a,c,d){return b.after(this[d?"headerKeyMap":"keyMap"],a,c,!0)},_ensureRowScroll:function(a){var b=this.getScrollPosition().y;b>a.offsetTop?this.scrollTo({y:a.offsetTop}):b+this.contentNode.offsetHeight<a.offsetTop+a.offsetHeight&&this.scrollTo({y:a.offsetTop-this.contentNode.offsetHeight+a.offsetHeight})},_ensureColumnScroll:function(a){var b=this.getScrollPosition().x,c=a.offsetLeft;if(b>c)this.scrollTo({x:c});else{var d=this.bodyNode.clientWidth,e=a.offsetWidth,f=c+e;b+d<f&&this.scrollTo({x:d>e?f-d:c})}},_ensureScroll:function(a,b){this.cellNavigation&&(this.columnSets||this.subRows.length>1)&&!b&&this._ensureRowScroll(a.row.element),this.bodyNode.clientWidth<this.contentNode.offsetWidth&&this._ensureColumnScroll(a.element)},_focusOnNode:function(a,b,e){var g,h,i,l,m,n="_focused"+(b?"Header":"")+"Node",o=this[n],p=this.cellNavigation?"cell":"row",q=this[p](a);if(a=q&&q.element){if(this.cellNavigation)for(g=a.getElementsByTagName("input"),m=0,i=g.length;m<i;m++)if(h=g[m],(-1!==h.tabIndex||"_dgridLastValue"in h)&&!h.disabled){h.focus(),l=!0;break}null!==e&&(e=d.mixin({grid:this},e),e.type&&(e.parentType=e.type),e.bubbles||(e.bubbles=!0)),o&&(f(o,"!dgrid-focus[!tabIndex]"),e&&(e[p]=this[p](o),c.emit(o,"dgrid-cellfocusout",e))),o=this[n]=a,e&&(e[p]=q);var r=this.cellNavigation?j:k;!l&&r.test(a.className)&&(a.tabIndex=this.tabIndex,a.focus()),f(a,".dgrid-focus"),e&&c.emit(o,"dgrid-cellfocusin",e),this._debouncedEnsureScroll(q,b)}},focusHeader:function(a){this._focusOnNode(a||this._focusedHeaderNode,!0)},focus:function(a){var b=a||this._focusedNode;b?this._focusOnNode(b,!1):(this._removedFocus&&(this._removedFocus.active=!0),this.contentNode.focus())}}),m=l.moveFocusVertical=function(a,b){var c=this.cellNavigation,d=this[c?"cell":"row"](a),e=c&&d.column.id,f=this.down(this._focusedNode,b,!0);c&&(f=this.cell(f,e)),this._focusOnNode(f,!1,a),a.preventDefault()},n=l.moveFocusUp=function(a){m.call(this,a,-1)},o=l.moveFocusDown=function(a){m.call(this,a,1)},p=l.moveFocusPageUp=function(a){m.call(this,a,-this.pageSkip)},q=l.moveFocusPageDown=function(a){m.call(this,a,this.pageSkip)},r=l.moveFocusHorizontal=function(a,b){if(this.cellNavigation){var c=!this.row(a),d=this["_focused"+(c?"Header":"")+"Node"];this._focusOnNode(this.right(d,b),c,a),a.preventDefault()}},s=l.moveFocusLeft=function(a){r.call(this,a,-1)},t=l.moveFocusRight=function(a){r.call(this,a,1)},u=l.moveHeaderFocusEnd=function(a,b){var c;this.cellNavigation&&(c=this.headerNode.getElementsByTagName("th"),this._focusOnNode(c[b?0:c.length-1],!0,a)),a.preventDefault()},v=l.moveHeaderFocusHome=function(a){u.call(this,a,!0)},w=l.moveFocusEnd=function(a,c){var f,g=this.cellNavigation,h=this.contentNode,i=c?0:h.scrollHeight,j=h.scrollTop+i,k=h[c?"firstChild":"lastChild"],l=k.className.indexOf("dgrid-preload")>-1,m=l?k[(c?"next":"previous")+"Sibling"]:k;if(a.preventDefault(),this.scrollTo({y:j}),l){for(;m&&m.className.indexOf("dgrid-row")<0;)m=m[(c?"next":"previous")+"Sibling"];if(!m)return}!l||k.offsetHeight<1?(g&&(m=this.cell(m,this.cell(a).column.id)),this._focusOnNode(m,!1,a)):(e("dom-addeventlistener")||(a=d.mixin({},a)),f=b.after(this,"renderArray",function(b){var d=b[c?0:b.length-1];return g&&(d=this.cell(d,this.cell(a).column.id)),this._focusOnNode(d,!1,a),f.remove(),b}))},x=l.moveFocusHome=function(a){w.call(this,a,!0)};return l.defaultKeyMap={32:h,33:p,34:q,35:w,36:x,37:s,38:n,39:t,40:o},l.defaultHeaderKeyMap={32:h,35:u,36:v,37:s,39:t},l}),define("hui/table/ColumnLocking",["dojo/_base/declare","dojo/aspect","dojo/on","dojo/has","../core/deviceUtils"],function(a,b,c,d,e){function f(a,b){for(1!==a.nodeType&&(a=a.parentNode);a&&!a[a.matches?"matches":"msMatchesSelector"](".dgrid-column-set["+j+"]");)if((a=a.parentNode)===b)return null;return a}function g(a){var b=d("pointer"),c={start:"down",end:"up"};return b?(a=c[a]||a,"MS"===b.slice(0,2)?"MSPointer"+a.slice(0,1).toUpperCase()+a.slice(1):"pointer"+a):"touch"+a}function h(a){return function(b,d){var e=[c(b,g("start"),function(c){if(!a._currentlyTouchedColumnSet){var d=f(c.target,b);!d||c.pointerType&&"touch"!==c.pointerType&&2!==c.pointerType||(a._currentlyTouchedColumnSet=d,a._lastColumnSetTouchX=c.clientX,a._lastColumnSetTouchY=c.clientY)}}),c(b,g("move"),function(b){if(null!==a._currentlyTouchedColumnSet){var c=f(b.target);c&&(d.call(a,c,a._lastColumnSetTouchX-b.clientX),a._lastColumnSetTouchX=b.clientX,a._lastColumnSetTouchY=b.clientY)}}),c(b,g("end"),function(){a._currentlyTouchedColumnSet=null})];return{remove:function(){e.forEach(function(a){a.remove()})}}}}function i(a){return d("event-mousewheel")||d("event-wheel")?function(b,e){return c(b,d("event-wheel")?"wheel":"mousewheel",function(c){var d,g=f(c.target,b);g&&(d=c.deltaX||-c.wheelDeltaX/3)&&e.call(a,g,d)})}:function(b,d){return c(b,".dgrid-column-set["+j+"]:MozMousePixelScroll",function(b){1===b.axis&&d.call(a,this,b.detail)})}}d.add("event-mousewheel",function(a,b,c){return"onmousewheel"in c}),d.add("event-wheel",function(a,b,c){return"onwheel"in c});var j="data-dgrid-column-set-id";return a(null,{_columnSetListeners:null,columnSets:null,postMixInProperties:function(){this.inherited(arguments),this._columnSetListeners=[]},postCreate:function(){this.inherited(arguments),this.lockedColumns&&this._setupColumnSetListeners()},_setupColumnSetListeners:function(){var a=this,b=this._columnSetListeners;b.length&&this._removeColumnSetListeners(),b.push(this.on(i(this),this._horizMoveHandler)),d("touch")&&b.push(this.on(h(this),this._horizMoveHandler)),b.push(this.on(".dgrid-column-set:dgrid-cellfocusin",function(b){a._onColumnSetCellFocus(b,this)}))},_removeColumnSetListeners:function(){this._columnSetListeners.forEach(function(a){a.remove()}),this._columnSetListeners=[]},_horizMoveHandler:function(a,b){var c=a.getAttribute(j),d=this._columnSetScrollers[c],e=d.scrollLeft+b;d.scrollLeft=e<0?0:e},renderArray:function(){var a=this.inherited(arguments);return a.forEach(function(a){this._adjustScrollLeft(a)},this),a},_adjustScrollLeft:function(a){var b=this._columnSetScrollLefts;Array.prototype.forEach.call(a.querySelectorAll(".dgrid-column-set"),function(a){a.scrollLeft=b[a.getAttribute(j)]})},createRowCells:function(a,b,c,d){if(!this.lockedColumns)return this.inherited(arguments);var e,f=document.createElement("table"),g=document.createElement("tbody"),h=document.createElement("tr"),i=arguments;return f.classList.add("dgrid-row-table"),f.setAttribute("role","presentation"),f.appendChild(g),g.appendChild(h),c=(c||this.subRows)[0],e=this.columnSets=[[c.slice(0,this.lockedColumns)],[c.slice(this.lockedColumns)]],e.forEach(function(c,e){var f=document.createElement(a),g=document.createElement("div");h.appendChild(f),f.classList.add("dgrid-column-set-cell"),f.classList.add("dgrid-column-set-"+e),f.appendChild(g),g.classList.add("dgrid-column-set"),g.setAttribute(j,e),g.appendChild(this.inherited(i,[a,b,c,d]))},this),f},renderHeader:function(){function a(){g._positionScrollers()}if(this.inherited(arguments),this.lockedColumns){var c,d,e=this.columnSets,f=this._columnSetScrollers,g=this;if(this._columnSetScrollerContents={},this._columnSetScrollLefts={},f)for(d in f)f[d].parentNode.removeChild(f[d]);else b.after(this,"styleColumn",a,!0),this._columnSetScrollerNode=c=document.createElement("div"),c.classList.add("dgrid-column-set-scroller-container"),this.footerNode.parentElement.insertBefore(c,this.footerNode.nextSibling);f=this._columnSetScrollers={},e.forEach(this._putScroller.bind(this)),this._positionScrollers()}},_putScroller:function(a,b){var d=this._columnSetScrollers[b]=document.createElement("span"),e=document.createElement("div");d.classList.add("dgrid-column-set-scroller"),d.classList.add("dgrid-column-set-scroller-"+b),d.setAttribute(j,b),this._columnSetScrollerNode.appendChild(d),e.classList.add("dgrid-column-set-scroller-content"),d.appendChild(e),this._columnSetScrollerContents[b]=e,c(d,"scroll",this._onColumnSetScroll.bind(this))},_onColumnSetScroll:function(a){var b,c=a.target.scrollLeft,d=a.target.getAttribute(j);this._columnSetScrollLefts[d]!==c&&(Array.prototype.forEach.call(this.domNode.querySelectorAll(".dgrid-column-set["+j+'="'+d+'"], .dgrid-column-set-scroller['+j+'="'+d+'"]'),function(a,d){e.isHandheld()?a.style.transform="translate3d(-"+c+"px, 0, 0)":a.scrollLeft=c,d||(b=c)}),this._columnSetScrollLefts[d]=b)},_positionScrollers:function(){var a,b,c=this.domNode,e=this._columnSetScrollers,f=this._columnSetScrollerContents,g=this.columnSets,h=0,i=0;g.forEach(function(d,g){a=c.querySelector(".dgrid-column-set["+j+'="'+g+'"]'),h=a.offsetWidth,b=a.firstChild.offsetWidth,f[g].style.width=b+"px",e[g].style.width=h+"px",b>h&&i++}),this._columnSetScrollerNode.style.bottom=this.showFooter?this.footerNode.offsetHeight+"px":"0",this.bodyNode.style.bottom=i?d("dom-scrollbar-height")+(d("ie")?1:0)+"px":"0"},_onColumnSetCellFocus:function(a,b){var c=a.target,d=b.getAttribute(j),e=this._columnSetScrollers[d];(c.offsetLeft-e.scrollLeft+c.offsetWidth>b.offsetWidth||e.scrollLeft>c.offsetLeft)&&this._scrollColumnSetTo(b,c.offsetLeft)},_scrollColumnSetTo:function(a,b){var c=a.getAttribute(j);this._columnSetScrollers[c].scrollLeft=b<0?0:b},_setLockedColumns:function(a){a<0&&(a=0),this.columnSets=null,this._resetColumnSizes(),this.lockedColumns=a,this._updateColumns(),this[a?"_setupColumnSetListeners":"_removeColumnSetListeners"]()},_resetColumnSizes:function(){for(var a in this._columnSizes)this._columnSizes[a].remove();this._columnSizes={}}})}),define("dgrid-0.4/_StoreMixin",["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/aspect","dojo/has","dojo/on","dojo/when","put-selector/put"],function(a,b,c,d,e,f,g,h){function i(a){if("object"!=typeof a)a=new Error(a);else if("cancel"===a.dojoType)return;f.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return a(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",loadingMessage:"",_total:0,constructor:function(){this.dirty={},this._updating={},this._columnsWithSet={},d.before(this,"configStructure",b.hitch(this,function(){this._columnsWithSet={}}))},destroy:function(){this.inherited(arguments),this._renderedCollection&&this._cleanupCollection()},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a),this.inherited(arguments)},_setCollection:function(a){if(this._renderedCollection&&(this.cleanup(),this._cleanupCollection({shouldRevert:!a||a.storage!==this._renderedCollection.storage})),this.collection=a,this._started){if(a){var b=a;this.sort&&this.sort.length>0&&(b=a.sort(this.sort)),b.track&&this.shouldTrackCollection&&(b=b.track(),this._rows=[],this._observerHandle=this._observeCollection(b,this.contentNode,{rows:this._rows})),this._renderedCollection=b}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection') for 0.4")},_getTotal:function(){return this._total},_cleanupCollection:function(a){a=a||{},this._renderedCollection.tracking&&this._renderedCollection.tracking.remove(),this._observerHandle&&(this._observerHandle.remove(),this._observerHandle=this._rows=null),!1!==a.shouldRevert&&(this.dirty={}),this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},row:function(){var a=this.inherited(arguments);return a&&a.data&&void 0!==a.id&&(a.id=this.collection.getIdentity(a.data)),a},refresh:function(){var a=this.inherited(arguments);return this.collection||(this.noDataNode=h(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage),a},renderArray:function(){var a=this.inherited(arguments);return this.collection||a.length&&this.noDataNode&&h(this.noDataNode,"!"),a},insertRow:function(a,c,d,e,f){var g,i,j=this.collection,k=this.dirty,l=j&&j.getIdentity(a);return l in k&&!(l in this._updating)&&(g=k[l]),g&&(a=b.delegate(a,g)),i=this.inherited(arguments),f&&f.rows&&(f.rows[e]=i),this.noDataNode&&(h(this.noDataNode,"!"),this.noDataNode=null),i},updateDirty:function(a,b,c){var d=this.dirty,e=d[a];e||(e=d[a]={}),e[b]=c},save:function(){function a(a,c){return function(f){var h,i,j=b._columnsWithSet,k=b._updating;if("function"==typeof f.set)f.set(c);else for(h in c)f[h]=c[h];for(h in j)void 0!==(i=j[h].set(f))&&(f[h]=i);return k[a]=!0,d.put(f).then(function(b){return delete e[a],delete k[a],g[a]=b,g})}}var b=this,d=this.collection,e=this.dirty,f=new c,g={},h=function(a){var c;return b.getBeforePut||!(c=b.row(a).data)?function(){return d.get(a)}:function(){return c}},i=f.then(function(){return g});for(var j in e){var k=a(j,e[j]);i=i.then(h(j)).then(k)}return f.resolve(),i},revert:function(){this.dirty={},this.refresh()},_trackError:function(a){"string"==typeof a&&(a=b.hitch(this,a));var d,e=this;try{d=g(a())}catch(a){var f=new c;f.reject(a),d=f.promise}return d.otherwise(function(a){i.call(e,a)}),d},removeRow:function(a,b,c){var d={element:a};!b&&this.noDataMessage&&this.up(d).element===a&&this.down(d).element===a&&(this.noDataNode=h(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);var e=c&&c.rows||this._rows;return e&&delete e[a.rowIndex],this.inherited(arguments)},renderQueryResults:function(a,c,d){d=b.mixin({rows:this._rows},d);var f=this;return e("dojo-built")||a.totalLength.then(function(a){null==a&&console.warn("Store reported null or undefined totalLength. Make sure your store (and service, if applicable) are reporting total correctly!")}),a.then(function(a){var b=f.renderArray(a,c,d);return delete f._lastCollection,b})},_observeCollection:function(a,b,c){var d,e=this,f=c.rows,g=[a.on("delete, update",function(a){var g=a.previousIndex,h=a.index;void 0!==g&&f[g]&&("max"in f&&(void 0===h||h<f.min||h>f.max)&&f.max--,d=f[g],d.parentNode===b&&e.removeRow(d,!1,c),f.splice(g,1),("delete"===a.type||"update"===a.type&&(g<h||void 0===h))&&f[g]&&f[g].rowIndex--),"delete"===a.type&&(d=null)}),a.on("add, update",function(a){function g(){h=(h.connected||h).nextSibling}var h,i=a.previousIndex,j=a.index;void 0===j||"max"in f&&!(j>=f.min&&j<=f.max)||("max"in f&&(void 0===i||i<f.min||i>f.max)&&f.max++,f.length?(h=f[j])||(h=f[j-1])&&g():h=e._getFirstRowSibling&&e._getFirstRowSibling(b),d&&h&&d.id===h.id&&g(),h&&!h.parentNode&&(h=document.getElementById(h.id)),f.splice(j,0,void 0),d=e.insertRow(a.target,b,h,j,c),e.highlightRow(d)),d=null}),a.on("add, delete, update",function(b){var c=void 0!==b.previousIndex?b.previousIndex:1/0,d=void 0!==b.index?b.index:1/0,g=Math.min(c,d);c!==d&&f[g]&&e.adjustRowIndices(f[g]),c!==1/0&&e._processScroll&&(f[c]||f[c-1])&&e._processScroll(),e._onNotification(f,b,a),a===e._renderedCollection&&"totalLength"in b&&(e._total=b.totalLength)})];return{remove:function(){for(;g.length>0;)g.pop().remove()}}},_onNotification:function(){}})}),define("dgrid-0.4/extensions/Pagination",["../_StoreMixin","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/on","dojo/query","dojo/string","dojo/has","dojo/when","put-selector/put","../util/misc","dojo/i18n!./nls/pagination","dojo/_base/sniff","xstyle/css!../css/extensions/Pagination.css"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){a.noDataNode?(j(a.noDataNode,"!"),delete a.noDataNode):a.cleanup(),a.contentNode.innerHTML=""}function n(a){if(a.loadingNode)j(a.loadingNode,"!"),delete a.loadingNode;else if(a._oldPageNodes){for(var b in a._oldPageNodes)a.removeRow(a._oldPageNodes[b]);delete a._oldPageNodes}delete a._isLoading}return b(a,{rowsPerPage:10,pagingTextBox:!1,previousNextArrows:!0,firstLastArrows:!1,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:!0,i18nPagination:l,showFooter:!0,_currentPage:1,buildRendering:function(){this.inherited(arguments);var a,b,c=this,d=this.paginationNode=j(this.footerNode,"div.dgrid-pagination"),f=this.paginationStatusNode=j(d,"div.dgrid-status"),g=this.i18nPagination;f.tabIndex=0,this._updatePaginationSizeSelect(),this._updateRowsPerPageOption(),this._updatePaginationStatus(this._total),a=this.paginationNavigationNode=j(d,"div.dgrid-navigation"),this.firstLastArrows&&(b=this.paginationFirstNode=j(a,"span.dgrid-first.dgrid-page-link","«"),b.setAttribute("aria-label",g.gotoFirst),b.tabIndex=0),this.previousNextArrows&&(b=this.paginationPreviousNode=j(a,"span.dgrid-previous.dgrid-page-link","‹"),b.setAttribute("aria-label",g.gotoPrev),b.tabIndex=0),this.paginationLinksNode=j(a,"span.dgrid-pagination-links"),this.previousNextArrows&&(b=this.paginationNextNode=j(a,"span.dgrid-next.dgrid-page-link","›"),b.setAttribute("aria-label",g.gotoNext),b.tabIndex=0),this.firstLastArrows&&(b=this.paginationLastNode=j(a,"span.dgrid-last.dgrid-page-link","»"),b.setAttribute("aria-label",g.gotoLast),b.tabIndex=0),this._listeners.push(e(a,".dgrid-page-link:click,.dgrid-page-link:keydown",function(a){if("keydown"!==a.type||13===a.keyCode){var b,d,e=this.className;c._isLoading||e.indexOf("dgrid-page-disabled")>-1||(b=c._currentPage,d=Math.ceil(c._total/c.rowsPerPage),this===c.paginationPreviousNode?c.gotoPage(b-1):this===c.paginationNextNode?c.gotoPage(b+1):this===c.paginationFirstNode?c.gotoPage(1):this===c.paginationLastNode?c.gotoPage(d):"dgrid-page-link"===e&&c.gotoPage(+this.innerHTML))}}))},destroy:function(){this.inherited(arguments),this._pagingTextBoxHandle&&this._pagingTextBoxHandle.remove()},_updatePaginationSizeSelect:function(){var a,b=this.pageSizeOptions,c=this.paginationSizeSelect;if(b&&b.length){c||(c=this.paginationSizeSelect=j(this.paginationNode,"select.dgrid-page-size[aria-label="+this.i18nPagination.rowsPerPage+"]"),a=this._paginationSizeChangeHandle=e(c,"change",d.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value)})),this._listeners.push(a)),c.options.length=0;for(var f=0;f<b.length;f++)j(c,"option",b[f],{value:b[f],selected:this.rowsPerPage===b[f]});this._updateRowsPerPageOption()}else b&&b.length||!c||(j(c,"!"),this.paginationSizeSelect=null,this._paginationSizeChangeHandle.remove())},_setPageSizeOptions:function(a){this.pageSizeOptions=a&&a.sort(function(a,b){return a-b}),this._updatePaginationSizeSelect()},_updateRowsPerPageOption:function(){var a=this.rowsPerPage,b=this.pageSizeOptions,d=this.paginationSizeSelect;d&&(c.indexOf(b,a)<0?this._setPageSizeOptions(b.concat([a])):d.value=""+a)},_setRowsPerPage:function(a){this.rowsPerPage=a,this._updateRowsPerPageOption(),this.gotoPage(1)},_updateNavigation:function(a){function b(a,b){var c,f;i.pagingTextBox&&a===m&&p>1?(c=j(l,"input.dgrid-page-input[type=text][value=$]",m),c.setAttribute("aria-label",k.jumpPage),i._pagingTextBoxHandle=e(c,"change",function(){var a=+this.value;!isNaN(a)&&a>0&&a<=p&&i.gotoPage(+this.value)}),r&&"INPUT"===r.tagName&&c.focus()):(f=a===m,c=j(l,"span"+(f?".dgrid-page-disabled":"")+".dgrid-page-link",a+(b?" ":"")),c.setAttribute("aria-label",k.gotoPage),c.tabIndex=f?-1:0,d===a&&(f?a<p?d++:g.focus():c.focus()),f||(g=c))}function c(a,b){j(a,(b?".":"!")+"dgrid-page-disabled"),a.tabIndex=b?-1:0}var d,g,h,i=this,k=this.i18nPagination,l=this.paginationLinksNode,m=this._currentPage,n=this.pagingLinks,o=this.paginationNavigationNode,p=Math.ceil(a/this.rowsPerPage),q=this._pagingTextBoxHandle,r=document.activeElement;if(r&&this.paginationNavigationNode.contains(r)?"dgrid-page-link"===r.className&&(d=+r.innerHTML):r=null,q&&q.remove(),l.innerHTML="",f(".dgrid-first, .dgrid-previous",o).forEach(function(a){c(a,1===m)}),f(".dgrid-last, .dgrid-next",o).forEach(function(a){c(a,m>=p)}),n&&p>0){b(1,!0);var s=m-n;s>2?j(l,"span.dgrid-page-skip","..."):s=2;for(var t=s;t<Math.min(m+n+1,p);t++)b(t,!0);m+n+1<p&&j(l,"span.dgrid-page-skip","..."),p>1&&b(p)}else i.pagingTextBox&&b(m);r&&-1===r.tabIndex&&(h=f('[tabindex="0"]',this.paginationNavigationNode),r===this.paginationPreviousNode||r===this.paginationFirstNode?r=h[0]:h.length&&(r=h[h.length-1]),r&&r.focus())},_updatePaginationStatus:function(a){var b=this.rowsPerPage,c=Math.min(a,(this._currentPage-1)*b+1);this.paginationStatusNode.innerHTML=g.substitute(this.i18nPagination.status,{start:c,end:Math.min(a,c+b-1),total:a})},refresh:function(a){var b=this,c=a&&a.keepCurrentPage?Math.min(this._currentPage,Math.ceil(this._total/this.rowsPerPage)):1;return this.inherited(arguments),this.gotoPage(c).then(function(a){return setTimeout(function(){e.emit(b.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:b})},0),a})},_onNotification:function(a,b,c){var d=this.rowsPerPage,e=this._currentPage*d;"add"===b.type&&b.index<e||"delete"===b.type&&b.previousIndex<e||"update"===b.type&&Math.floor(b.index/d)!==Math.floor(b.previousIndex/d)?this.gotoPage(Math.min(this._currentPage,Math.ceil(b.totalLength/this.rowsPerPage))||1):c===this._renderedCollection&&b.totalLength!==this._total&&(this._updatePaginationStatus(b.totalLength),this._updateNavigation(b.totalLength))},renderQueryResults:function(a,b){var c=this,d=this.inherited(arguments);return b||(this._topLevelRequest&&(this._topLevelRequest.cancel(),delete this._topLevelRequest),"function"==typeof d.cancel&&(this._topLevelRequest=d),d.then(function(){c._topLevelRequest&&delete c._topLevelRequest})),d},insertRow:function(){var a=this._oldPageNodes,b=this.inherited(arguments);return a&&b===a[b.id]&&delete a[b.id],b},gotoPage:function(a){var b=this,c=(this._currentPage-1)*this.rowsPerPage;return this._renderedCollection?(this._renderedCollection.releaseRange&&this._renderedCollection.releaseRange(c,c+this.rowsPerPage),this._trackError(function(){var c,d,e,f,g,h,i=b.rowsPerPage,k=(a-1)*i,l={start:k,count:i},o=b.contentNode;if(b.showLoadingMessage)m(b),d=b.loadingNode=j(o,"div.dgrid-loading"),d.innerHTML=b.loadingMessage;else for(b._oldPageNodes=e={},f=o.children,g=0,h=f.length;g<h;g++)e[f[g].id]=f[g];return b._isLoading=!0,c=b._renderedCollection.fetchRange({start:k,end:k+i}),b.renderQueryResults(c,null,l).then(function(d){return n(b),b.scrollTo({y:0}),b._rows&&(b._rows.min=k,b._rows.max=k+i-1),c.totalLength.then(function(c){c||(b.noDataNode&&(j(b.noDataNode,"!"),delete b.noDataNode),b.noDataNode=j(b.contentNode,"div.dgrid-no-data"),b.noDataNode.innerHTML=b.noDataMessage),b._total=c,b._currentPage=a,b._rowsOnPage=d.length,b._updatePaginationStatus(c),b._updateNavigation(c)}),c},function(a){throw n(b),a})})):(console.warn("Pagination requires a collection to operate."),i([]))}})}),define("hui/table/CustomizablePagination",["dojo/string","dgrid/extensions/Pagination","dojo/on","dojo/when","dojo/_base/sniff","xstyle/css!dgrid/css/extensions/Pagination.css"],function(a,b,c,d){function e(a){var b=document.createElement("button");return b.appendChild(document.createTextNode(a.value)),b.classList.add(a.className),b.classList.add("dgrid-page-link"),b.setAttribute("aria-label",a.label),b.tabIndex=a.tabIndex||0,b}var f=b.prototype._updateNavigation;return b.extend({pagingLinks:0,firstLastArrows:!0,buildRendering:function(){this.inherited(arguments);var a=this.paginationNode=document.createElement("div"),b=this.paginationStatusNode=document.createElement("div"),d=this.paginationNavigationNode=document.createElement("div"),f=this.paginationLinksNode=document.createElement("div"),g=this,h=this.i18nPagination;a.classList.add("dgrid-pagination"),this.footerNode.appendChild(a),b.classList.add("dgrid-status"),d.classList.add("dgrid-navigation"),d.setAttribute("role","navigation"),d.setAttribute("aria-label",this.paginationAriaLabel),a.appendChild(d),f.classList.add("dgrid-pagination-links"),b.tabIndex=-1,this._updatePaginationSizeSelect(),this._updateRowsPerPageOption(),this._updatePaginationStatus(this._total),this.paginationFirstNode=e({className:"dgrid-first",value:this.paginationFirstText,label:h.gotoFirst}),d.appendChild(this.paginationFirstNode),this.paginationPreviousNode=e({className:"dgrid-previous",value:this.paginationPreviousText,label:h.gotoPrev}),d.appendChild(this.paginationPreviousNode),d.appendChild(b),d.appendChild(f),this.paginationNextNode=e({className:"dgrid-next",value:this.paginationNextText,label:h.gotoNext}),d.appendChild(this.paginationNextNode),this.paginationLastNode=e({className:"dgrid-last",value:this.paginationLastText,label:h.gotoLast}),d.appendChild(this.paginationLastNode),this._listeners.push(c(d,".dgrid-page-link:click,.dgrid-page-link:keydown",function(a){if("keydown"!==a.type||13===a.keyCode){var b,c,d=this.className;g._isLoading||d.indexOf("dgrid-page-disabled")>-1||(b=g._currentPage,c=Math.ceil(g._total/g.rowsPerPage),this===g.paginationPreviousNode?g.gotoPage(b-1):this===g.paginationNextNode?g.gotoPage(b+1):this===g.paginationFirstNode?g.gotoPage(1):this===g.paginationLastNode?g.gotoPage(c):"dgrid-page-link"===d&&g.gotoPage(+this.innerHTML))}})),this._paginationButtons=[this.paginationFirstNode,this.paginationPreviousNode,this.paginationNextNode,this.paginationLastNode]},refresh:function(a){a=a||{},a.keepCurrentPage=!(this._firstRun||!this._currentPage||!1===a.keepCurrentPage)||a.keepCurrentPage;var b=this,d=a&&a.keepCurrentPage?Math.min(this._currentPage,Math.ceil(this._total/this.rowsPerPage))||1:1;return(this.keepScrollPosition||a.keepScrollPosition)&&(a.keepCurrentPage||this.keepCurrentPage)&&(this._previousScrollPosition=this.getScrollPosition()),this.inherited(arguments),this.gotoPage(d).then(function(a){return setTimeout(function(){c.emit(b.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:b})},0),a})},gotoPage:function(){return this._renderedCollection?(this._currentPage!==arguments[0]&&this.clearSelection(),this.inherited(arguments)):d([])},_updateNavigation:function(a){f.call(this,a),this._paginationButtons.forEach(function(a){a.disabled=-1===a.tabIndex,a.removeAttribute("tabindex")})},_updatePaginationStatus:function(b){var c=this.rowsPerPage,d=Math.min(b,(this._currentPage-1)*c+1);this.paginationStatusNode.innerHTML=a.substitute(this.paginationText?this.paginationText:this.i18nPagination.status,{start:d,end:Math.min(b,d+c-1),total:b})},_setPaginationFirstText:function(a){this.paginationFirstText=a,this.paginationFirstNode.textContent=a},_setPaginationPreviousText:function(a){this.paginationPreviousText=a,this.paginationPreviousNode.textContent=a},_setPaginationNextText:function(a){this.paginationNextText=a,this.paginationNextNode.textContent=a},_setPaginationLastText:function(a){this.paginationLastText=a,this.paginationLastNode.textContent=a},_togglePaginationButtons:function(a){[this.paginationFirstNode,this.paginationPreviousNode,this.paginationNextNode,this.paginationLastNode].forEach(function(b){b.disabled=!a})}}),b}),define("dgrid-0.4/util/has-css3",["dojo/has"],function(a){function b(a,b){var d,e=a.style;if(b in e)return!0;for(b=b.slice(0,1).toUpperCase()+b.slice(1),d=c.length;d--;)if(c[d]+b in e)return c[d];return!1}var c=["ms","O","Moz","Webkit"];return a.add("css-transitions",function(a,c,d){return b(d,"transitionProperty")}),a.add("css-transforms",function(a,c,d){return b(d,"transform")}),a.add("css-transforms3d",function(a,c,d){return b(d,"perspective")}),a.add("transitionend",function(){var b=a("css-transitions");return!!b&&(!0===b?"transitionend":{ms:"MSTransitionEnd",O:"oTransitionEnd",Moz:"transitionend",Webkit:"webkitTransitionEnd"}[b])}),a}),define("dgrid-0.4/Tree",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/aspect","dojo/on","dojo/query","dojo/when","./util/has-css3","./Grid","dojo/has!touch?./util/touch","put-selector/put"],function(a,b,c,d,e,f,g,h,i,j,k){return a(null,{collapseOnRefresh:!1,enableTreeTransitions:!0,treeIndentWidth:9,constructor:function(){this._treeColumnListeners=[]},shouldExpand:function(a,b,c){return c},expand:function(a,c,d){if(this._treeColumn){var i,j=this,l=a.element?a:this.row(a),m=!!this._expanded[l.id],n=h("transitionend");if(a=l.element,a=a.className.indexOf("dgrid-expando-icon")>-1?a:f(".dgrid-expando-icon",a)[0],d=d||!this.enableTreeTransitions,a&&a.mayHaveChildren&&(d||c!==m)){var o=void 0===c?!this._expanded[l.id]:c;k(a,".ui-icon-triangle-1-"+(o?"se":"e")+"!ui-icon-triangle-1-"+(o?"e":"se")),k(l.element,(o?".":"!")+"dgrid-row-expanded");var p,q,r=l.element,s=r.connected,t={};if(!s){s=t.container=r.connected=k(r,"+div.dgrid-tree-container");var u=function(a){var b,c=j._renderedCollection.getChildren(l.data);if(j.sort&&j.sort.length>0&&(c=c.sort(j.sort)),c.track&&j.shouldTrackCollection&&(s._rows=a.rows=[],c=c.track(),s._handles=[c.tracking,j._observeCollection(c,s,a)]),"start"in a){var d={start:a.start,end:a.start+a.count};b=c.fetchRange(d)}else b=c.fetch();return b};if("level"in a&&(u.level=a.level),this.renderQuery)i=this.renderQuery(u,t);else{var v=k(s,"div");i=this._trackError(function(){return j.renderQueryResults(u(t),v,b.mixin({rows:t.rows},"level"in u?{queryLevel:u.level}:null)).then(function(a){return k(v,"!"),a})})}n&&e(s,n,this._onTreeTransitionEnd)}s.hidden=!o,p=s.style,!n||d?(p.display=o?"block":"none",p.height=""):(o?(p.display="block",q=s.scrollHeight,p.height="0px"):(k(s,".dgrid-tree-resetting"),p.height=s.scrollHeight+"px"),setTimeout(function(){k(s,"!dgrid-tree-resetting"),p.height=o?q?q+"px":"auto":"0px"},0)),o?this._expanded[l.id]=!0:delete this._expanded[l.id]}return g(i)}},_configColumns:function(){var a=this.inherited(arguments);this._expanded={};for(var b=0,c=a.length;b<c;b++)if(a[b].renderExpando){this._configureTreeColumn(a[b]);break}return a},insertRow:function(a){var b=this.inherited(arguments),c=this.row(b),d=this.shouldExpand(c,this._currentLevel,this._expanded[c.id]);return d&&this.expand(b,!0,!0),(d||!this.collection.mayHaveChildren||this.collection.mayHaveChildren(a))&&k(b,".dgrid-row-expandable"),b},removeRow:function(a,b){var d=a.connected,e={};d&&(d._handles&&(c.forEach(d._handles,function(a){a.remove()}),delete d._handles),d._rows&&(e.rows=d._rows),f(">.dgrid-row",d).forEach(function(a){this.removeRow(a,!0,e)},this),d._rows&&(d._rows.length=0,delete d._rows),b||k(d,"!")),this.inherited(arguments)},cleanup:function(){this.inherited(arguments),this.collapseOnRefresh&&(this._expanded={})},_destroyColumns:function(){for(var a=this._treeColumnListeners,b=a.length;b--;)a[b].remove();this._treeColumnListeners=[],this._treeColumn=null},_calcRowHeight:function(a){var b=a.connected;return this.inherited(arguments)+(b?b.offsetHeight:0)},_configureTreeColumn:function(a){var b,c=this,d=".dgrid-content .dgrid-column-"+a.id;if(this._treeColumn=a,!a._isConfiguredTreeColumn){var e=a.renderCell||this._defaultRenderCell;a._isConfiguredTreeColumn=!0,a.renderCell=function(b,d,f,g){var h,i,j=Number(g&&g.queryLevel)+1,l=!c.collection.mayHaveChildren||c.collection.mayHaveChildren(b);j=c._currentLevel=isNaN(j)?0:j,h=a.renderExpando(j,l,c._expanded[c.collection.getIdentity(b)],b),h.level=j,h.mayHaveChildren=l,i=e.call(a,b,d,f,g),i&&i.nodeType?(k(f,h),k(f,i)):f.insertBefore(h,f.firstChild)},"function"!=typeof a.renderExpando&&(a.renderExpando=this._defaultRenderExpando)}var f=this._treeColumnListeners;0===f.length&&(f.push(this.on(a.expandOn||".dgrid-expando-icon:click,"+d+":dblclick,"+d+":keydown",function(a){var d=c.row(a);c.collection.mayHaveChildren&&!c.collection.mayHaveChildren(d.data)||"keydown"===a.type&&32!==a.keyCode||"dblclick"===a.type&&b&&b.count>1&&d.id===b.id&&a.target.className.indexOf("dgrid-expando-icon")>-1||c.expand(d),a.target.className.indexOf("dgrid-expando-icon")>-1&&(b&&b.id===c.row(a).id?b.count++:b={id:c.row(a).id,count:1})})),h("touch")&&f.push(this.on(j.selector(d,j.dbltap),function(){c.expand(this)})))},_defaultRenderExpando:function(a,b,c){var d,e=this.grid.isRTL?"right":"left",f=".dgrid-expando-icon";return b&&(f+=".ui-icon.ui-icon-triangle-1-"+(c?"se":"e")),d=k("div"+f+"[style=margin-"+e+": "+a*this.grid.treeIndentWidth+"px; float: "+e+"]"),d.innerHTML="&nbsp;",d},_onNotification:function(a,b){"delete"===b.type&&delete this._expanded[b.id],this.inherited(arguments)},_onTreeTransitionEnd:function(a){var b=this,c=this.style.height;c&&(this.style.display="0px"===c?"none":"block"),a&&(k(this,".dgrid-tree-resetting"),setTimeout(function(){k(b,"!dgrid-tree-resetting")},0)),this.style.height=""}})}),define("hui/table/ContentGroups",["dojo/_base/declare","dgrid/Tree","dojo/has","dojo/query","dojo/Deferred","put-selector/put","dojo/has!touch?dgrid/util/touch","dojo/when","dojo/aspect"],function(a,b,c,d,e,f,g,h,i){return a(b,{_setCategoryProperty:function(a){this.categoryProperty=a,this.keepScrollPosition=!0},postCreate:function(){this.inherited(arguments);var a=function(){this._setCategoryTotals(this.categoryTotals)}.bind(this);i.after(this,"_hideColumn",a),i.after(this,"_showColumn",a)},_setExpandAll:function(a){this.expandAll!==a&&(this.expandAll=a,this.refresh())},renderHeader:function(){this.inherited(arguments),this._hideCategoryCell(this.headerNode)},renderRow:function(a){var b=this.inherited(arguments);return this.categoryProperty&&(a[this.categoryProperty]?this._showOnlyCategoryCell(b,a):this._hideCategoryCell(b)),b},shouldExpand:function(a){return!(arguments.length>1)&&(this.expandAll||a)},_setCategoryTotals:function(a){if(this.categoryProperty){this.categoryTotals=a||{};var b=this,c=new this.collection.Filter;c=c.or.apply(c,Object.keys(this.categoryTotals).map(function(a){return c.eq(b.categoryProperty,a)})),this.collection.filter(c).forEach(function(a){var c;b.categoryTotals.hasOwnProperty(c=a[b.categoryProperty])&&(b.categoryTotals[a.id]=b.categoryTotals[c],delete b.categoryTotals[c])}).then(function(){b.refresh()})}},_setTotalText:function(){this.inherited(arguments),this._setCategoryTotals(this.categoryTotals)},_renderCategoryTotalRow:function(a,b,c){var d=this._renderTotalRow(a,"_"+b+"TotalRow",c);d&&this._hideCategoryCell(d)},_showExpanded:function(a,b,c){var e,g,h;return h=b.element,h=h.className.indexOf("dgrid-expando-icon")>-1?h:d(".dgrid-expando-icon",h)[0],g=this.collection.getIdentity(b.data),e=void 0==a?!this._expanded[g]:a,f(h,".ui-icon-triangle-1-"+(e?"se":"e")+"!ui-icon-triangle-1-"+(e?"e":"se")),f(b.element,(e?".":"!")+"dgrid-row-expanded"),c&&c.setAttribute("aria-expanded",e?"true":"false"),this._expanded[g]=!!e,e},expand:function(a,b,c,d){if(!this._treeColumn)return h();var f,g,i,j,k,l,m=this,n=a.element?a:this.row(a),o=this.getScrollPosition();return d=d||!1!==d&&(!this.collection.mayHaveChildren||this.collection.mayHaveChildren(n.data)),a&&d?(g=this._showExpanded(b,n,c),f=this.collapseOnRefresh,this.collapseOnRefresh=!1,l=this.farOffRemoval,this.farOffRemoval=1/0,i=this.refresh(),!m.on||i&&i.then||(j=new e,i=j.promise,k=m.on("dgrid-refresh-complete",function(){j.resolve()})),h(i,function(){return k&&k.remove(),o&&m.gotoPage&&m.scrollTo(o),m.farOffRemoval=l,m.collapseOnRefresh=f,g})):h()},_clicked:null,_configureTreeColumn:function(a){var b=this,d=".dgrid-content .dgrid-column-"+a.id,e=a.renderCell||this._defaultRenderCell;if(this._treeColumn=a,!b.collection)throw new Error("dgrid Tree mixin requires a collection to operate.");"function"!=typeof a.renderExpando&&(a.renderExpando=this._defaultRenderExpando),this._treeColumnListeners.push(this.on(a.expandOn||d+":click,.ha-expando-button:click,.ha-expando-button:keydown",this._onClick.bind(this))),c("touch")&&this._treeColumnListeners.push(this.on(g.selector(d,g.dbltap),function(){b.expand(this)})),a.renderCell=function(c,d,f,g){b._renderCell(a,e,c,d,f,g)}},_renderCell:function(a,b,c,d,e,g){var h,i,j=a.grid,k=Number(g&&g.queryLevel)+1,l=!j.collection.mayHaveChildren||j.collection.mayHaveChildren(c);k=j._currentLevel=isNaN(k)?0:k,h=a.renderExpando(k,l,j._expanded[j.collection.getIdentity(c)],c),h.level=k,h.mayHaveChildren=l,i=b.call(a,c,d,e,g),i&&i.nodeType?(f(e,h),f(e,i)):e.insertBefore(h,e.firstChild)},_onClick:function(a){var b,c=this.row(a),d=c?c.id:"",e=this;this.collection.mayHaveChildren&&!(b=this.collection.mayHaveChildren(c?c.data:null))||"keydown"===a.type&&32!==a.keyCode||("keydown"===a.type&&32===a.keyCode&&(a.preventDefault(),a.stopPropagation()),this.expand(c,null,null,b).then(function(a){if(a&&d){var b=e.row(d);b&&b.element&&b.element.nextSibling&&b.element.nextSibling.focus()}})),a.target.classList.contains("dgrid-expando-icon")&&(this._clicked&&this._clicked.id===this.row(a).id?this._clicked.count++:this._clicked={id:this.row(a).id,count:1})},renderQueryResults:function(){var a=this,b=this.inherited(arguments);return this.categoryTotals?b.then(function(b){var c,d,e,f,g,h=b&&b.length?b[b.length-1]:null;for(c=0;c<b.length;c++)g=f,d=g&&g.data.parent,f=a.row(b[c]),null==f.data.parent&&a._expanded[d]&&(e=a.categoryTotals[d])&&a._renderCategoryTotalRow(e,d,f.element);return h&&h.rowIndex>=a._total&&(f=a.row(h))&&(e=a.categoryTotals[f.data.parent])&&a._renderCategoryTotalRow(e,f.data.parent,a._totalRow||null),b}):b},insertRow:function(){var a=this.inherited(arguments),b=this.row(a);return this.shouldExpand(b&&this._expanded[b.id])&&this._showExpanded(!0,b,a.querySelector(".ha-expando-button")),a},_defaultRenderExpando:function(){var a=b.prototype._defaultRenderExpando.apply(this,Array.prototype.slice.call(arguments));return"left"===a.style.float?a.style.float="right":a.style.float="left",a},_hideCategoryCell:function(a){this.categoryProperty&&Array.prototype.slice.apply(a.getElementsByClassName("field-"+this.categoryProperty)).forEach(function(a){a.classList.add("hidden")})},_showOnlyCategoryCell:function(a){var b=this.categoryProperty;b&&(a.classList.add("category-row"),Array.prototype.slice.apply(a.querySelectorAll('[class*="field-"]')).forEach(function(a){if(a.classList.contains("field-"+b)){a.classList.add("category-column");var c,d,e=document.createElement("button"),f=document.createElement("span");for(e.classList.add("ha-expando-button"),e.setAttribute("aria-expanded","false"),e.setAttribute("tabindex","0"),f.classList.add("sr-only"),f.textContent="expand/collapse "+a.textContent.trim(),c=a.children.length-1;c>=0;c--)d=a.children[c],a.removeChild(d),d.style.float&&e.classList.add("ha-expando-"+d.style.float),e.insertBefore(d,e.firstChild);e.insertBefore(f,e.firstChild),a.appendChild(e)}else a.classList.add("hidden")}))},_getExpanded:function(){var a,b=[];for(a in this._expanded)this._expanded.hasOwnProperty(a)&&(this.expandAll||this._expanded[a])&&b.push(a);return b}})}),define("hui/table/ContentGroupPagination",["dojo/_base/declare","dojo/when","put-selector/put","./CustomizablePagination","./ContentGroups"],function(a,b,c,d,e){function f(a){a.noDataNode?(c(a.noDataNode,"!"),delete a.noDataNode):a.cleanup(),a.contentNode.innerHTML=""}function g(a){if(a.loadingNode)c(a.loadingNode,"!"),delete a.loadingNode;else if(a._oldPageNodes){for(var b in a._oldPageNodes)a.removeRow(a._oldPageNodes[b]);delete a._oldPageNodes}delete a._isLoading}return a([d,e],{_renderNoDataDivs:function(){var a=this;Array.prototype.map.call(a.contentNode.getElementsByClassName("category-row"),function(b){return a.row(b)}).forEach(function(b){if(b&&a._expanded[a.collection.getIdentity(b.data)]&&(b.element.parentNode.lastChild===b.element||b.element.nextSibling.classList.contains("category-row"))){var c=document.createElement("div");c.classList.add("ha-table-no-data"),c.textContent="No Data Available",b.element.nextSibling?b.element.parentNode.insertBefore(c,b.element.nextSibling):b.element.parentNode.appendChild(c)}})},gotoPage:function(a){var d=this,e=(this._currentPage-1)*this.rowsPerPage;return this._renderedCollection?(this._currentPage!==arguments[0]&&this.clearSelection(),this._renderedCollection.releaseRange&&this._renderedCollection.releaseRange(e,e+this.rowsPerPage),this._trackError(function(){var e,h,i,j,k,l,m=d.rowsPerPage,n=(a-1)*m,o={start:n,count:m},p=d.contentNode,q=d._getExpanded();if(d.showLoadingMessage)f(d),h=d.loadingNode=c(p,"div.dgrid-loading[role=alert]"),h.innerHTML=d.loadingMessage;else for(d._oldPageNodes=i={},j=p.children,k=0,l=j.length;k<l;k++)i[j[k].id]=j[k];return d._isLoading=!0,e=d._renderedCollection.fetchGroupRange?d._renderedCollection.fetchGroupRange({start:n,end:n+m,expanded:q}):d._renderedCollection.fetchRange({start:n,end:n+m}),d.renderQueryResults(e,null,o).then(function(f){return g(d),d._previousScrollPosition?(d.scrollTo(d._previousScrollPosition),d._previousScrollPosition=null):d.scrollTo({y:0}),d._rows&&(d._rows.min=n,d._rows.max=n+m-1),b(e.totalLength,function(g){g||(d.noDataNode&&(c(d.noDataNode,"!"),delete d.noDataNode),d.noDataNode=c(d.contentNode,"div.dgrid-no-data[role=gridcell]"),d.noDataNode.innerHTML=d.noDataMessage),b(e,function(c){b(c.start,function(e){a=e?(e-1)/m+1:a,d._total=g,d._currentPage=a,d._rowsOnPage=f.length,d._updatePaginationStatus(g),b(c.isLastPage,function(a){a?(d._updateNavigation(g),d.paginationNextNode.disabled=d.paginationLastNode.disabled=!0,d.paginationNextNode.classList.add("dgrid-page-disabled"),d.paginationLastNode.classList.add("dgrid-page-disabled")):(d.paginationNextNode.disabled=d.paginationLastNode.disabled=!1,d.paginationNextNode.classList.remove("dgrid-page-disabled"),d.paginationLastNode.classList.remove("dgrid-page-disabled"),d._updateNavigation(g))})})})}),d._renderNoDataDivs(),e},function(a){throw g(d),a})})):b([])}})}),define("dgrid-0.4/OnDemandList",["./List","./_StoreMixin","dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/when","./util/misc","put-selector/put"],function(a,b,c,d,e,f,g,h){return c([a,b],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:1/0,bufferRows:10,farOffRemoval:2e3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:g.defaultDelay,keepScrollPosition:!1,rowHeight:0,postCreate:function(){this.inherited(arguments);var a=this;e(this.bodyNode,"scroll",g[this.pagingMethod](function(b){a._processScroll(b)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments),this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(a,b){var c,e=this,g=b&&b.container||this.contentNode,i={query:a,count:0},j=this.preload,k={node:h(g,"div.dgrid-preload",{rowIndex:0}),count:0,query:a,next:i};k.node.style.height="0",i.node=c=h(g,"div.dgrid-preload"),i.previous=k,c.rowIndex=this.minRowsPerPage,j?((i.next=j.next)&&c.offsetTop>=j.node.offsetTop?i.previous=j:(i.next=j,i.previous=j.previous),i.previous.next=i,i.next.previous=i):this.preload=i;var l=h(c,"-div.dgrid-loading");return h(l,"div.dgrid-below").innerHTML=this.loadingMessage,b=d.mixin({start:0,count:this.minRowsPerPage},"level"in a?{queryLevel:a.level}:null),this._trackError(function(){var d=a(b);return e.renderQueryResults(d,c,b).then(function(a){return d.totalLength.then(function(d){var g=a.length,j=c.parentNode,k=e.noDataNode;return e._rows&&(e._rows.min=0,e._rows.max=g===d?1/0:g-1),h(l,"!"),"queryLevel"in b||(e._total=d),0===d&&j&&(k&&(h(k,"!"),delete e.noDataNode),e.noDataNode=k=h("div.dgrid-no-data"),j.insertBefore(k,e._getFirstRowSibling(j)),k.innerHTML=e.noDataMessage),e._calcAverageRowHeight(a),d-=g,i.count=d,c.rowIndex=g,d?c.style.height=Math.min(d*e.rowHeight,e.maxEmptySpace)+"px":c.style.display="none",e._previousScrollPosition&&(e.scrollTo(e._previousScrollPosition),delete e._previousScrollPosition),f(e._processScroll()).then(function(){return a})})}).otherwise(function(a){throw h(l,"!"),a})})},refresh:function(a){var b=this,c=a&&a.keepScrollPosition;if(void 0===c&&(c=this.keepScrollPosition),c&&(this._previousScrollPosition=this.getScrollPosition()),this.inherited(arguments),this._renderedCollection)return this.renderQuery(function(a){return b._renderedCollection.fetchRange({start:a.start,end:a.start+a.count})}).then(function(){b._refreshTimeout=setTimeout(function(){e.emit(b.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:b}),b._refreshTimeout=null},0)})},resize:function(){this.inherited(arguments),this.rowHeight||this._calcAverageRowHeight(this.contentNode.getElementsByClassName("dgrid-row")),this._processScroll()},cleanup:function(){this.inherited(arguments),this.preload=null},renderQueryResults:function(a){var b=this.inherited(arguments),c=this._renderedCollection;return c&&c.releaseRange&&b.then(function(b){b[0]&&!b[0].parentNode.tagName&&a.totalLength.then(function(){c.releaseRange(b[0].rowIndex,b[b.length-1].rowIndex+1)})}),b},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var b=a.nextSibling;return b&&!/\bdgrid-preload\b/.test(b.className)?b.offsetTop-a.offsetTop:a.offsetHeight},_calcAverageRowHeight:function(a){for(var b=a.length,c=0,d=0;d<b;d++)c+=this._calcRowHeight(a[d]);b&&c&&(this.rowHeight=c/b)},lastScrollTop:0,_processScroll:function(a){function b(a,b,d,e){var f=i.farOffRemoval,g=a.node;if(b>2*f){for(var j,k,l=g[d],m=0,n=0,o=[],p=l&&l.rowIndex;j=l;){var q=i._calcRowHeight(j);if(m+q+f>b||l.className.indexOf("dgrid-row")<0&&l.className.indexOf("dgrid-loading")<0)break;l=j[d],m+=q,n+=j.count||1,i.removeRow(j,!0),o.push(j),"rowIndex"in j&&(k=j.rowIndex)}i._renderedCollection.releaseRange&&"number"==typeof p&&"number"==typeof k&&(e?i._renderedCollection.releaseRange(k,p+1):i._renderedCollection.releaseRange(p,k+1),i._rows[e?"max":"min"]=k,i._rows.max>=i._total-1&&(i._rows.max=1/0)),a.count+=n,e?(g.rowIndex-=n,c(a)):g.style.height=g.offsetHeight+m+"px";var r=h("div",o);setTimeout(function(){h(r,"!")},1)}}function c(a,b){a.node.style.height=Math.min(a.count*i.rowHeight,b?1/0:i.maxEmptySpace)+"px"}function d(a,b){do{a=b?a.next:a.previous}while(a&&!a.node.offsetWidth);return a}if(this.rowHeight){var e,f,g,i=this,j=i.bodyNode,k=a&&a.scrollTop||this.getScrollPosition().y,l=j.offsetHeight+k,m=i.preload,n=i.lastScrollTop,o=i.bufferRows*i.rowHeight,p=o-i.rowHeight,q=!0,r=1;for(i.lastScrollTop=k;m&&!m.node.offsetWidth;)m=m.previous;for(;m&&m!==e;){e=i.preload,i.preload=m,f=m.node;var s=f.offsetTop;if(l+r+p<s)m=d(m,q=!1);else if(k-r-p>s+f.offsetHeight)m=d(m,q=!0);else{var t=((f.rowIndex?k-o:l)-s)/i.rowHeight,u=(l-k+2*o)/i.rowHeight,v=Math.max(Math.min((k-n)*i.rowHeight,i.maxRowsPerPage/2),i.maxRowsPerPage/-2);if(u+=Math.min(Math.abs(v),10),0===f.rowIndex&&(t-=u),t=Math.max(t,0),t<10&&t>0&&u+t<i.maxRowsPerPage&&(u+=Math.max(0,t),t=0),0===(u=Math.min(Math.max(u,i.minRowsPerPage),i.maxRowsPerPage,m.count))){m=d(m,q);continue}u=Math.ceil(u),t=Math.min(Math.floor(t),m.count-u);var w={};m.count-=u;var x,y=f,z=i.queryRowsOverlap,A=(f.rowIndex>0||f.offsetTop>k)&&m;if(A){var B=m.previous;B&&(b(B,k-(B.node.offsetTop+B.node.offsetHeight),"nextSibling"),t>0&&B.node===f.previousSibling?(t=Math.min(m.count,t),m.previous.count+=t,c(m.previous,!0),f.rowIndex+=t,z=0):u+=t,m.count-=t),w.start=f.rowIndex-z,w.count=Math.min(u+z,i.maxRowsPerPage),f.rowIndex=w.start+w.count}else m.next&&(b(m.next,m.next.node.offsetTop-l,"previousSibling",!0),y=f.nextSibling,y===m.next.node?(m.next.count+=m.count-t,m.next.node.rowIndex=t+u,c(m.next),m.count=t,z=0):x=!0),w.start=m.count,w.count=Math.min(u+z,i.maxRowsPerPage);if(x&&y&&y.offsetWidth&&(x=y.offsetTop),c(m),"level"in m.query&&(w.queryLevel=m.query.level),!("queryLevel"in w)&&(w.start>i._total||w.count<0))continue;var C=h(y,"-div.dgrid-loading[style=height:"+u*i.rowHeight+"px]"),D=h(C,"div.dgrid-"+(A?"below":"above"));D.innerHTML=i.loadingMessage,C.count=u,i._trackError(function(){!function(a,b,d){var e=m.query(w);g=i.renderQueryResults(e,a,w).then(function(f){var g=i._rows;if(!g||"queryLevel"in w||!f.length||(b?(g.max<=g.min&&(g.min=f[0].rowIndex),g.max=f[f.length-1].rowIndex):(g.max<=g.min&&(g.max=f[f.length-1].rowIndex),g.min=f[0].rowIndex)),y=a.nextSibling,h(a,"!"),d&&y&&y.offsetWidth){var j=i.getScrollPosition();i.scrollTo({x:j.x,y:j.y+y.offsetTop-d,preserveMomentum:!0})}return e.totalLength.then(function(a){"queryLevel"in w||(i._total=a,i._rows&&i._rows.max>=i._total-1&&(i._rows.max=1/0)),b&&(b.count=a-b.node.rowIndex,c(b))}),i._processScroll(),f},function(b){throw h(a,"!"),b})}(C,A,x)}),m=m.previous}}return g}}})}),define("hui/table/OnDemandContentGroups",["dojo/_base/declare","dojo/on","dgrid/Grid","dgrid/OnDemandList","./ContentGroups"],function(a,b,c,d,e){return d.extend({_renderNoDataDivs:function(){var a=this;Array.prototype.map.call(a.contentNode.getElementsByClassName("category-row"),function(b){return a.row(b)}).forEach(function(b){if(b&&a._expanded[a.collection.getIdentity(b.data)]&&(b.element.nextSibling.classList.contains("dgrid-preload")||b.element.nextSibling.classList.contains("category-row"))){var c=document.createElement("div");c.classList.add("ha-table-no-data"),c.textContent="No Data Available",b.element.parentNode.insertBefore(c,b.element.nextSibling)}})},refresh:function(a){var c=this,d=a&&a.keepScrollPosition,e=c._getExpanded();if(void 0===d&&(d=this.keepScrollPosition),d&&(!this.categoryProperty||e.length>0)&&(this._previousScrollPosition=this.getScrollPosition()),this.inherited(arguments),this._renderedCollection)return this.renderQuery(function(a){return c._renderedCollection.fetchGroupRange&&Math.abs(a.start+a.count-(c._total?c._total:0))<Object.keys(c._expanded).length&&(a.count+=Object.keys(c._expanded).length),c._renderedCollection.fetchGroupRange?c._renderedCollection.fetchGroupRange({start:a.start,end:a.start+a.count,expanded:e,virtual:!0}):c._renderedCollection.fetchRange({start:a.start,end:a.start+a.count})}).then(function(){setTimeout(function(){c._renderNoDataDivs(),b.emit(c.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:c})},0)})}}),a([c,d,e],{_processScroll:function(){var a;return(!this.categoryProperty||this._getExpanded().length>0)&&(this._isProcessingScroll=!0,a=this.inherited(arguments),a?a.then(function(){this._isProcessingScroll=!1}):setTimeout(function(){this._isProcessingScroll=!1},100)),this._renderNoDataDivs(),this._applyA11yRoles(),a}})}),define("dgrid-0.4/extensions/ColumnResizer",["dojo/_base/declare","dojo/_base/array","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c,d,e){for(var f=1;f<b;f++)a[c+f][d]=e}function l(a){for(var c=a.length,d=c,e=b.filter(a[0],function(a){return!a.hidden}).length,f=new Array(c);c--;)f[c]=new Array(e);var g={};for(c=0;c<d;c++)for(var h=f[c],i=a[c],j=0,l=0;j<e;j++){var m,n=i[l];if(void 0===h[j]){if(h[j]=n.id,n.rowSpan&&n.rowSpan>1&&k(f,n.rowSpan,c,j,n.id),c>0&&n.colSpan&&n.colSpan>1)for(m=1;m<n.colSpan;m++)h[++j]=n.id,n.rowSpan&&n.rowSpan>1&&k(f,n.rowSpan,c,j,n.id);g[n.id]=a[0][j].id,l++}}return g}function m(a,b,d,e,f){if(!(d<=0)){var g,h,j=a.columns[b];if(j)return g={grid:a,columnId:b,width:d,bubbles:!0,cancelable:!0},e&&(g.parentType=e),!a._resizedColumns||c.emit(a.headerNode,"dgrid-columnresize",g)?("auto"===d?delete j.width:(j.width=d,d+="px"),h=a._columnSizes[b],h?h.set("width",d):h=i.addCssRule("#"+i.escapeCssIdentifier(a.domNode.id)+" .dgrid-column-"+i.escapeCssIdentifier(b,"-"),"width: "+d+";"),a._columnSizes[b]=h,!1!==f&&a.resize(),!0):void 0}}var n,o,p=0,q={create:function(){n=j("div.dgrid-column-resizer"),o=j("div.dgrid-resize-guard")},destroy:function(){j(n,"!"),j(o,"!"),n=o=null},show:function(a){var b=g.position(a.domNode,!0);n.style.top=b.y+"px",n.style.height=b.h+"px",j(document.body,n),j(a.domNode,o)},move:function(a){n.style.left=a+"px"},hide:function(){n.parentNode.removeChild(n),o.parentNode.removeChild(o)}};return a(null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments),p||q.create(),p++},destroy:function(){this.inherited(arguments);for(var a in this._columnSizes)this._columnSizes[a].remove();--p||q.destroy()},resizeColumnWidth:function(a,b){return m(this,a,b)},configStructure:function(){var a,b=this._oldColumnSizes=e.mixin({},this._columnSizes);this._resizedColumns=!1,this._columnSizes={},this.inherited(arguments);for(a in b)a in this._columnSizes||b[a].remove();delete this._oldColumnSizes},_configColumn:function(a){this.inherited(arguments);var b,c=a.id;"width"in a&&((b=this._oldColumnSizes[c])?b.set("width",a.width+"px"):b=i.addCssRule("#"+i.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+i.escapeCssIdentifier(c,"-"),"width: "+a.width+"px;"),this._columnSizes[c]=b)},renderHeader:function(){this.inherited(arguments);var a,b=this;if(this.columnSets&&this.columnSets.length)for(var f=this.columnSets.length;f--;)a=e.mixin(a||{},l(this.columnSets[f]));else this.subRows&&this.subRows.length>1&&(a=l(this.subRows));for(var g=d(".dgrid-cell",b.headerNode),k=g.length;k--;){var m,n=g[k],o=n.columnId,p=b.columns[o],q=n.childNodes;if(p&&!1!==p.resizable){var r=j("div.dgrid-resize-header-container");for(n.contents=r;q.length>0;)j(r,q[0]);m=j(n,r,"div.dgrid-resize-handle.resizeNode-"+i.escapeCssIdentifier(o,"-")),m.columnId=a&&a[o]||o}}b.mouseMoveListen||(c(b.headerNode,".dgrid-resize-handle:mousedown"+(h("touch")?",.dgrid-resize-handle:touchstart":""),function(a){b._resizeMouseDown(a,this),b.mouseMoveListen.resume(),b.mouseUpListen.resume()}),b._listeners.push(b.mouseMoveListen=c.pausable(document,"mousemove"+(h("touch")?",touchmove":""),i.throttleDelayed(function(a){b._updateResizerPosition(a)}))),b._listeners.push(b.mouseUpListen=c.pausable(document,"mouseup"+(h("touch")?",touchend":""),function(a){b._resizeMouseUp(a),b.mouseMoveListen.pause(),b.mouseUpListen.pause()})),b.mouseMoveListen.pause(),b.mouseUpListen.pause())},_resizeMouseDown:function(a,b){a.preventDefault(),f.setSelectable(this.domNode,!1),this._startX=this._getResizeMouseLocation(a),this._targetCell=d(".dgrid-column-"+i.escapeCssIdentifier(b.columnId,"-"),this.headerNode)[0],this._updateResizerPosition(a),q.show(this)},_resizeMouseUp:function(a){var b,c,e,g=this._columnSizes;this.adjustLastColumn&&(e=this.headerNode.clientWidth-1),this._resizedColumns||(b=d(".dgrid-cell",this.headerNode),this.columnSets&&this.columnSets.length?b=b.filter(function(a){return"0"===a.columnId.split("-")[0]&&!(a.columnId in g)}):this.subRows&&this.subRows.length>1&&(b=b.filter(function(a){return"0"===a.columnId.charAt(0)&&!(a.columnId in g)})),c=b.map(function(a){return a.offsetWidth}),b.forEach(function(a,b){m(this,a.columnId,c[b],null,!1)},this),this._resizedColumns=!0),f.setSelectable(this.domNode,!0);var h=this._targetCell,j=this._getResizeMouseLocation(a)-this._startX,k=h.offsetWidth+j,l=this._getResizedColumnWidths(),n=l.totalWidth,o=l.lastColId,p=d(".dgrid-column-"+i.escapeCssIdentifier(o,"-"),this.headerNode)[0].offsetWidth;k<this.minWidth&&(k=this.minWidth),m(this,h.columnId,k,a.type)&&h.columnId!==o&&this.adjustLastColumn&&(n+j<e?m(this,o,"auto",a.type):p-j<=this.minWidth&&m(this,o,this.minWidth,a.type)),q.hide(),delete this._startX,delete this._targetCell},_updateResizerPosition:function(a){if(this._targetCell){var b=this._getResizeMouseLocation(a),c=b-this._startX,d=this._targetCell.offsetWidth,e=b;d+c<this.minWidth&&(e=this._startX-(d-this.minWidth)),q.move(e)}},_getResizeMouseLocation:function(a){var b=0;return a.pageX?b=a.pageX:a.clientX&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft),b},_getResizedColumnWidths:function(){var a=0,b=d((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),c=b.length;if(!c)return{};for(var e=b[c-1].columnId;c--;)a+=b[c].offsetWidth;return{totalWidth:a,lastColId:e}}})}),define("dgrid-0.4/extensions/ColumnHider",["dojo/_base/declare","dojo/has","dojo/on","../util/misc","put-selector/put","dojo/i18n!./nls/columnHider","xstyle/css!../css/extensions/ColumnHider.css"],function(a,b,c,d,e,f){function g(a,b){return a.id.substr(b.id.length+18)}var h,i;return a(null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:f,_hiderMenuOpened:!1,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var a,b,c,d,e=this.subRows,f=!0;for(delete this._columnHiderFirstCheckbox,c=0,a=e.length;c<a;c++)for(d=0,b=e[c].length;d<b;d++)this._renderHiderMenuEntry(e[c][d]),f&&(f=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[e[c][d].id])},_renderHiderMenuEntry:function(a){var b,c,f,g=a.id,h=d.escapeCssIdentifier(g,"-");a.hidden&&(a.hidden=!1,this._hideColumn(g),a.hidden=!0),a.unhidable||(b=e("div.dgrid-hider-menu-row"),c=this.domNode.id+"-hider-menu-check-"+h,f=this._columnHiderCheckboxes[g]=e(b,"input.dgrid-hider-menu-check.hider-menu-check-"+h+"[type=checkbox]"),f.id=c,e(b,"label.dgrid-hider-menu-label.hider-menu-label-"+h+"[for="+c+"]",a.label||a.field||""),e(this.hiderMenuNode,b),a.hidden||(f.checked=!0))},renderHeader:function(){function a(a){a.stopPropagation()}var d,f=this,j=this.hiderMenuNode,k=this.hiderToggleNode;if(this.inherited(arguments),j){for(d in this._columnHiderRules)this._columnHiderRules[d].remove();j.innerHTML=""}else k=this.hiderToggleNode=e(this.domNode,"button.ui-icon.dgrid-hider-toggle[type=button][aria-label="+this.i18nColumnHider.popupTriggerLabel+"]"),this._listeners.push(c(k,"click",function(a){f._toggleColumnHiderMenu(a)})),j=this.hiderMenuNode=e("div.dgrid-hider-menu[role=dialog][aria-label="+this.i18nColumnHider.popupLabel+"]"),j.id=this.id+"-hider-menu",this._listeners.push(c(j,"keyup",function(a){27===(a.charCode||a.keyCode)&&(f._toggleColumnHiderMenu(a),k.focus())})),j.style.display="none",e(this.domNode,j),this._listeners.push(c(j,".dgrid-hider-menu-check:"+(b("ie")<9?"click":"change"),function(a){f._updateColumnHiddenState(g(a.target,f),!a.target.checked)})),this._listeners.push(c(j,"mousedown",a),c(k,"mousedown",a)),i||(i=c.pausable(document,"mousedown",function(a){h&&h._toggleColumnHiderMenu(a)}),i.pause());this._columnHiderCheckboxes={},this._columnHiderRules={},this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);for(var a in this._columnHiderRules)this._columnHiderRules[a].remove()},left:function(a,b){return this.right(a,-b)},right:function(a,b){a.element||(a=this.cell(a));for(var c=this.inherited(arguments),d=a;c.column.hidden;){if(c=this.inherited(arguments,[c,b>0?1:-1]),d.element===c.element)return a;d=c}return c},isColumnHidden:function(a){return!!this._columnHiderRules[a]},_toggleColumnHiderMenu:function(){var a,b=this._hiderMenuOpened,c=this.hiderMenuNode,d=this.domNode;c.style.display=b?"none":"",b?c.style.height="":(c.offsetHeight>d.offsetHeight-12&&(c.style.height=d.offsetHeight-12+"px"),(a=this._columnHiderFirstCheckbox)&&a.focus()),i[b?"pause":"resume"](),h=b?null:this,this._hiderMenuOpened=!b},_hideColumn:function(a){var c,e=this,f="#"+d.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-";this._columnHiderRules[a]||(this._columnHiderRules[a]=d.addCssRule(f+d.escapeCssIdentifier(a,"-"),"display: none;"),8!==b("ie")&&10!==b("ie")||(c=d.addCssRule(".dgrid-row-table","display: inline-table;"),window.setTimeout(function(){c.remove(),e.resize()},0)))},_showColumn:function(a){this._columnHiderRules[a]&&(this._columnHiderRules[a].remove(),delete this._columnHiderRules[a])},_updateColumnHiddenState:function(a,b){this[b?"_hideColumn":"_showColumn"](a),this.columns[a].hidden=b,c.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[a],hidden:b,bubbles:!0}),this.resize()},toggleColumnHiddenState:function(a,b){void 0===b&&(b=!this._columnHiderRules[a]),this._updateColumnHiddenState(a,b),this._columnHiderCheckboxes[a]&&(this._columnHiderCheckboxes[a].checked=!b)}})}),define("hui/table/ColumnHider",["dgrid/extensions/ColumnHider"],function(a){return a.extend({postMixInProperties:function(){this.inherited(arguments),this._columnHiderRules={}},renderHeader:function(){this._columnHiderCheckboxes={},this._columnHiderRules={},this.inherited(arguments)},toggleColumnHiddenState:function(a,b){void 0===b&&(b=!this._columnHiderRules[a]),this._updateColumnHiddenState(a,b),this._columnHiderCheckboxes[a]&&(this._columnHiderCheckboxes[a].checked=!b)}}),a}),define("dgrid-0.4/Selection",["dojo/_base/declare","dojo/on","dojo/has","dojo/aspect","./List","dojo/has!touch?./util/touch","put-selector/put","dojo/query","dojo/_base/sniff","dojo/dom"],function(a,b,c,d,e,f,g){function h(a,b){for(var c=a.unselectable=b?"on":"",d=a.getElementsByTagName("*"),e=d.length;--e;)"INPUT"!==d[e].tagName&&"TEXTAREA"!==d[e].tagName&&(d[e].unselectable=c)}function i(a,e){var f=a.bodyNode,g=e?"text":c("ff")<21?"-moz-none":"none";k&&"msUserSelect"!==k?f.style[k]=g:c("dom-selectstart")?e||a._selectstartHandle?e&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=b(f,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):(h(f,!e),e||a._unselectableHandle?e&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=d.after(a,"renderRow",function(a){return h(a,!0),a}))}c.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition}),c.add("dom-selectstart",void 0!==document.onselectstart);var j=c("mac")?"metaKey":"ctrlKey",k=c("css-user-select"),l=c("pointer"),m=l&&"MS"===l.slice(0,2),n=l?l+(m?"Down":"down"):"mousedown",o=l?l+(m?"Up":"up"):"mouseup";return"WebkitUserSelect"===k&&void 0!==document.documentElement.style.msUserSelect&&(k=!1),a(null,{selectionDelegate:".dgrid-row",selectionEvents:n+","+o+",dgrid-cellfocusin",selectionTouchEvents:c("touch")?f.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){return this.selection={},this.inherited(arguments)},postCreate:function(){this.inherited(arguments),this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="",this._setSelectionMode(a)},destroy:function(){this.inherited(arguments),this._selectstartHandle&&this._selectstartHandle.remove(),this._unselectableHandle&&this._unselectableHandle.remove(),this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!==this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},_setAllowTextSelection:function(a){void 0!==a?i(this,a):i(this,"none"===this.selectionMode),this.allowTextSelection=a},_handleSelect:function(a,b){!this[this._selectionHandlerName]||!this.allowSelect(this.row(b))||"dgrid-cellfocusin"===a.type&&"mousedown"===a.parentType||a.type===o&&b!==this._waitForMouseUp||(this._waitForMouseUp=null,this._selectionTriggerEvent=a,a.keyCode&&a.ctrlKey&&32!==a.keyCode||(!a.shiftKey&&a.type===n&&this.isSelected(b)?this._waitForMouseUp=b:this[this._selectionHandlerName](a,b)),this._selectionTriggerEvent=null)},_singleSelectionHandler:function(a,b){var c=a.keyCode?a.ctrlKey:a[j];this._lastSelected===b?this.select(b,null,!c||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c,d=this._lastSelected,e=a.keyCode?a.ctrlKey:a[j];a.shiftKey||(c=!e||null,d=null),this.select(b,d,c),d||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:a[j])||this.clearSelection(null,!0),this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var a=this,e=this.contentNode,g=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]},c("touch")&&!c("pointer")&&this.selectionTouchEvents?(b(e,f.selector(g,this.selectionTouchEvents),function(b){a._handleSelect(b,this),a._ignoreMouseSelect=this}),b(e,b.selector(g,this.selectionEvents),function(b){a._ignoreMouseSelect!==this?a._handleSelect(b,this):b.type===o&&(a._ignoreMouseSelect=null)})):b(e,b.selector(g,this.selectionEvents),function(b){a._handleSelect(b,this)}),this.addKeyHandler&&this.addKeyHandler(32,function(b){a._handleSelect(b,b.target)}),this.allowSelectAll&&this.on("keydown",function(b){b[j]&&65===b.keyCode&&!/\bdgrid-input\b/.test(b.target.className)&&(b.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())}),this._setCollection&&d.before(this,"_setCollection",function(b){a._updateDeselectionAspect(b)}),this._updateDeselectionAspect()},_updateDeselectionAspect:function(a){function b(a,b){var c=e.row(a);c&&e.selection[c.id]&&e[b](c)}var c,e=this;this._removeDeselectSignals&&this._removeDeselectSignals(),c=a&&a.track&&this._observeCollection?[d.before(this,"_observeCollection",function(a){c.push(a.on("delete",function(a){void 0===a.index&&b(a.id,"deselect")}))}),d.after(this,"_observeCollection",function(a){c.push(a.on("update",function(c){void 0!==c.index&&b(a.getIdentity(c.target),"select")}))},!0)]:[d.before(this,"removeRow",function(a,b){var c;b||(c=this.row(a))&&c.id in this.selection&&this.deselect(c)})],this._removeDeselectSignals=function(){for(var a=c.length;a--;)c[a].remove();c=[]}},allowSelect:function(){return!0},_fireSelectionEvent:function(a){var c,d=this._selectionEventQueues[a],e=this._selectionTriggerEvent;c={bubbles:!0,grid:this},e&&(c.parentType=e.type),c[this._selectionTargetType]=d,this._selectionEventQueues[a]=[],b.emit(this.contentNode,"dgrid-"+a,c)},_fireSelectionEvents:function(){var a,b=this._selectionEventQueues;for(a in b)b[a].length&&this._fireSelectionEvent(a)},_select:function(a,b,c){var d,e,f,h,i;if(void 0===c&&(c=!0),a.element||(a=this.row(a)),(!1===c||this.allowSelect(a))&&(d=this.selection,e=!!d[a.id],null===c&&(c=!e),f=a.element,c||this.allSelected?d[a.id]=c:delete this.selection[a.id],f&&(c?g(f,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):g(f,"!dgrid-selected!ui-state-active")),c!==e&&f&&this._selectionEventQueues[(c?"":"de")+"select"].push(a),b)){if(b.element||(b=this.row(b)),!b)return this._lastSelected=f,void console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.");if(h=b.element)for(i=this._determineSelectionDirection(f,h),i||(h=document.getElementById(h.id),i=this._determineSelectionDirection(f,h));a.element!==h&&(a=this[i](a));)this._select(a,null,c)}},_determineSelectionDirection:c("dom-comparedocumentposition")?function(a,b){var c=b.compareDocumentPosition(a);return!(1&c)&&(2===c?"down":"up")}:function(a,b){return!(b.sourceIndex<1)&&(b.sourceIndex>a.sourceIndex?"down":"up")},select:function(a,b,c){this._select(a,b,c),this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null),this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0,this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){return void 0!==a&&null!==a&&(a.element||(a=this.row(a)),a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a)))},refresh:function(){return this.deselectOnRefresh&&this.clearSelection(),this._lastSelected=null,this.inherited(arguments)},renderArray:function(){var a,b,c,d=this.inherited(arguments),e=this.selection;for(a=0;a<d.length;a++)b=this.row(d[a]),(c=b.id in e?e[b.id]:this.allSelected)&&this.select(b,null,c);return this._fireSelectionEvents(),d}})}),define("dgrid-0.4/extensions/DnD",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/aspect","dojo/on","dojo/topic","dojo/has","dojo/when","dojo/dnd/Source","dojo/dnd/Manager","dojo/_base/NodeList","put-selector/put","../Selection","dojo/has!touch?../util/touch","dojo/has!touch?./_DnD-touch-autoscroll","xstyle/css!dojo/resources/dnd.css"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=a(i,{grid:null,getObject:function(a){var b=this.grid;return b._trackError(function(){return b.collection.get(a.id.slice(b.id.length+5))})},_legalMouseDown:function(a){return this.inherited(arguments)&&a.target!==this.grid.bodyNode},onDrop:function(a,b,c){var d=this,e=this._targetAnchor=this.targetAnchor,f=this.grid,g=f.collection;!this.before&&e&&(e=e.nextSibling),e=e&&f.row(e),h(e&&g.get(e.id),function(e){d!==a?d.onDropExternal(a,b,c,e):d.onDropInternal(b,c,e)})},onDropInternal:function(a,b,c){var d,e,f=this.grid,g=f.collection,i=this,j=i._targetAnchor;j&&(d=this.before?j.previousSibling:j.nextSibling),e=f.row(a[0]),(b||d!==a[0]&&(c||!e||f.down(e).element!==a[0]))&&a.forEach(function(a){h(i.getObject(a),function(a){var d=g.getIdentity(a);f._trackError(function(){return g[b&&g.copy?"copy":"put"](a,{beforeId:c?g.getIdentity(c):null}).then(function(){i._selectedNodes[d]&&(i._selectedNodes[d]=f.row(d).element)})})})})},onDropExternal:function(a,b,c,d){var e=this.grid,f=this.grid.collection,g=a.grid;b.forEach(function(b,i){h(a.getObject(b),function(h){e._trackError(function(){return f[f.copy?"copy":"put"](h,{beforeId:d?f.getIdentity(d):null}).then(function(){if(!c){if(g){var d=g.collection.getIdentity(h);return!i&&a.selectNone(),a.delItem(b.id),g.collection.remove(d)}a.deleteSelectedNodes()}})})})})},onDndStart:function(a){this.inherited(arguments),a===this&&(this.grid.cancelTouchScroll&&this.grid.cancelTouchScroll(),j.manager().avatar.node.style.width=this.grid.domNode.offsetWidth/2+"px")},onMouseDown:function(a){g("touch")&&this.isDragging&&n.countCurrentTouches(a,this.grid.touchNode)>1?(f.publish("/dnd/cancel"),j.manager().stopDrag()):this.inherited(arguments)},onMouseMove:function(a){(!g("touch")||n.countCurrentTouches(a,this.grid.touchNode)<=1)&&this.inherited(arguments)},checkAcceptance:function(a){return a.getObject&&i.prototype.checkAcceptance.apply(this,arguments)},getSelectedNodes:function(){if(!this.grid.selection)return this.inherited(arguments);var a,b=new k;for(a in this.grid.selection)b.push(this._selectedNodes[a]);return b}}),p=a(m,{dndSourceType:"dgrid-row",dndParams:null,dndConstructor:o,postMixInProperties:function(){this.inherited(arguments),this.dndParams=b.mixin({accept:[this.dndSourceType]},this.dndParams)},postCreate:function(){function a(a){h[a.id]=a.element}function e(a){delete h[a.id],l(a.element,"!dojoDndItemSelected!dojoDndItemAnchor")}this.inherited(arguments);var f=this.dndConstructor||o,g=b.mixin(this.dndParams,{grid:this,dropParent:this.contentNode});"function"==typeof this.expand&&(g.allowNested=!0),this.dndSource=new f(this.bodyNode,g);var h=this.dndSource._selectedNodes={};this.on("dgrid-select",function(b){c.forEach(b.rows,a)}),this.on("dgrid-deselect",function(a){c.forEach(a.rows,e)}),d.after(this,"destroy",function(){delete this.dndSource._selectedNodes,h=null,this.dndSource.destroy()},!0)},insertRow:function(a){var b=this.inherited(arguments),c="function"==typeof this.getObjectDndType?this.getObjectDndType(a):[this.dndSourceType];return l(b,".dojoDndItem"),this.dndSource.setItem(b.id,{data:a,type:c instanceof Array?c:[c]}),b},removeRow:function(a){this.dndSource.delItem(this.row(a)),this.inherited(arguments)}});return p.GridSource=o,p}),define("hui/table/TableDndSource",["dgrid/extensions/DnD","dojo/dnd/common","dojo/dnd/Manager","dojo/dnd/autoscroll","dojo/dnd/Selector","dojo/_base/declare","dojo/has","dojo/on"],function(a,b,c,d,e,f,g,h){return c.extend({onMouseMove:function(a){if(!this.dragging){var c,e,f=this.avatar;f&&(d.autoScrollNodes(a),c=f.node.style,c.left=a.pageX+this.OFFSET_X+"px",c.top=a.pageY+this.OFFSET_Y+"px",e=Boolean(this.source.copyState(b.getCopyKeyState(a))),this.copy!==e&&this._setCopyStatus(e)),g("touch")&&a.preventDefault()}}}),f(a.GridSource.extend({onDndStart:function(a){if(this.inherited(arguments),a===this){this.grid.cancelTouchScroll&&this.grid.cancelTouchScroll();var b=c.manager().avatar.node,d=b.querySelector(".dojoDndAvatarHeader"),e=b.querySelectorAll(".dgrid-selected"),f=b.querySelectorAll(".dojoDndAvatarItem"),g=this.grid.domNode.querySelector(".dgrid-row");f&&Array.prototype.forEach.call(f,function(a){a.style.opacity="",a.classList.add("ha-table-drag-and-drop")}),b.style.width=g?g.offsetWidth+"px":"",d&&d.parentNode.removeChild(d),e&&Array.prototype.forEach.call(e,function(a){a.classList.remove("dgrid-selected")}),a.grid.domNode.parentNode.classList.contains("compact")?b.classList.add("compact"):a.grid.domNode.parentNode.classList.contains("double")&&b.classList.add("double"),Array.prototype.forEach.call(a.grid.domNode.querySelectorAll(".dgrid-row"),function(a){a.setAttribute("aria-dropeffect","move")})}},getSelectedNodes:function(){return this.inherited(arguments)}}),{SpaceKeyCode:32,EscapeKeyCode:27,ArrowUpKeyCode:38,ArrowDownKeyCode:40,EnterKeyCode:13,MKeyCode:77,scrollListener:null,dragging:!1,scrollCushion:50,_targetIcon:null,onDndCancel:function(){this.inherited(arguments),Array.prototype.forEach.call(this.grid.domNode.querySelectorAll(".dgrid-row"),function(a){a.removeAttribute("aria-dropeffect")}),this.dragging=!1,c.manager().dragging=!1,this.scrollListener.resume()},onDndDrop:function(){this.inherited(arguments),Array.prototype.forEach.call(this.grid.domNode.querySelectorAll(".dgrid-row"),function(a){a.removeAttribute("aria-dropeffect")}),this.dragging=!1,c.manager().dragging=!1,this.scrollListener.resume()},constructor:function(){this._targetIcon=document.createElement("div"),this.grid&&this.grid.domNode&&this.grid.domNode.parentNode&&this.grid.domNode.parentNode.appendChild(this._targetIcon),this._targetIcon.classList.add("hidden"),this._targetIcon.classList.add("hi"),this._targetIcon.classList.add("hi-adjust"),this._targetIcon.classList.add("drag-and-drop-target-icon"),this.scrollListener=h.pausable(this.node,"scroll",this._unmarkTargetAnchor.bind(this)),this.events.push(this.scrollListener,h(this.node,".ha-dnd-button:keydown",this.onKeyDown.bind(this)))},_markTargetAnchor:function(a,b){this.inherited(arguments);var d,e,f;this.targetAnchor&&(e=this.targetAnchor.getBoundingClientRect(),f=a?e.top-12:e.bottom-13,this._targetIcon.style.top=f+(window.scrollY||window.pageYOffset)+"px",this._targetIcon.style.left=e.left-20+"px",this._targetIcon.classList.remove("hidden"),b&&(d=c.manager().avatar,d.node.style.left=e.left+Math.min(this.targetAnchor.offsetWidth/5,75)+"px",d.node.style.top=e.bottom+(window.scrollY||window.pageYOffset)+this.targetAnchor.offsetHeight+"px"))},_unmarkTargetAnchor:function(){this.inherited(arguments),this._targetIcon.classList.add("hidden")},onMouseOver:function(){this.dragging||this.inherited(arguments)},onMouseMove:function(){this.dragging||this.inherited(arguments)},onDndSourceOver:function(){this.dragging||this.inherited(arguments)},onKeyDown:function(a){var b,d,f,g=a.target.getBoundingClientRect(),h=c.manager();this.dragging?(d=this.grid.row(this.current||a.target),(b=a.keyCode===this.ArrowUpKeyCode)||a.keyCode===this.ArrowDownKeyCode?(a.preventDefault(),(f=b?d&&d.element&&d.element.previousSibling?d.element.previousSibling:this.current?this.current.previousSibling:null:d&&d.element&&d.element.nextSibling?d.element.nextSibling:this.current?this.current.nextSibling:null)&&f.classList.contains("dgrid-row")&&(this._unmarkTargetAnchor(),f.offsetTop>this.grid.bodyNode.scrollTop+this.grid.bodyNode.offsetHeight-this.scrollCushion?this.grid.scrollTo({y:this.grid.bodyNode.scrollTop+f.offsetHeight}):f.offsetTop<this.grid.bodyNode.scrollTop&&this.grid.scrollTo({y:this.grid.bodyNode.scrollTop-f.offsetHeight}),this.current=f,this._markTargetAnchor(!1,!0))):a.keyCode===this.MKeyCode&&a.ctrlKey||a.keyCode===this.EnterKeyCode?(h.canDropFlag=!0,h.onMouseUp(a)):a.keyCode===this.EscapeKeyCode&&(h.stopDrag(),this.onDndCancel())):(d=this.grid.row(a.target),a.keyCode===this.SpaceKeyCode&&(this.current=d&&d.element?d.element:a.target,this.dragging=!0,c.manager().dragging=!0,this.scrollListener.pause(),a.target.hasAttribute("aria-grabbed")&&a.target.setAttribute("aria-grabbed",!0),h.startDrag(this,[d.element],!1),this._lastX=g.left,this._lastY=g.top,e.prototype.onMouseDown.call(this,a),this.onDndStart(this,[d.element]),this._markTargetAnchor(!1,!0)))}})}),define("hui/table/RowReordering",["dojo/_base/declare","dojo/_base/lang","dgrid/extensions/DnD","./TableDndSource","../core/utils"],function(a,b,c,d,e){return a(c,{allowRowReordering:!1,rowReorderField:"_rowReorder",_reorderIconText:"Reorder Row",dndConstructor:d,dndEnabled:!1,postMixInProperties:function(){this.inherited(arguments),this.dndParams=b.mixin({withHandles:!0},this.dndParams)},_enableDnd:function(a){this.dndEnabled=a,Array.prototype.forEach.call(this.domNode.querySelectorAll(".hi-arrange"),this._toggleIcon.bind(null,a))},_toggleIcon:function(a,b){b&&(a?(b.parentNode.setAttribute("aria-grabbed","false"),b.classList.remove("disabled-dnd-handle"),b.parentNode.parentNode.classList.add("dojoDndHandle"),b.parentNode.classList.add("ha-dnd-button")):(b.parentNode.setAttribute("aria-grabbed",""),b.classList.add("disabled-dnd-handle"),b.parentNode.parentNode.classList.remove("dojoDndHandle"),b.parentNode.classList.remove("ha-dnd-button")))},_setReorderIconText:function(a){this._reorderIconText=a,this.refresh()},_setBatchModeActive:function(a){this.inherited(arguments),this._enableDnd(!a)},_setEditable:function(a){this.inherited(arguments),this._enableDnd(!a)},renderRow:function(){var a=this.inherited(arguments);return this._toggleIcon(this.dndEnabled,a.querySelector(".hi-arrange")),a},_setAllowRowReordering:function(a){this.allowRowReordering=a,this.set("columns",this.table&&this.table.originalColumns?e.clone(this.table.originalColumns,[this]):this.__columns),this._enableDnd(a)},_addCustomColumn:function(a){this.inherited(arguments),this.get("allowRowReordering")&&a.unshift(this._defineRowReorderColumn())},_defineRowReorderColumn:function(){var a={field:this.rowReorderField,sortable:!1,unhidable:!0};return a.renderCell=this._renderReorderCell.bind(this),a.renderHeaderCell=function(a){a.textContent=""},a},_renderReorderCell:function(){var a=arguments[2],b=document.createElement("button"),c=document.createElement("span"),d=document.createElement("span");a.classList.add("dojoDndHandle"),c.classList.add("hi-arrange"),c.classList.add("hi"),c.setAttribute("aria-hidden",!0),d.textContent=this._reorderIconText,d.classList.add("icon-text"),b.setAttribute("aria-grabbed",!1),b.classList.add("ha-dnd-button"),b.appendChild(c),b.appendChild(d),a.appendChild(b),a.addEventListener("pointerdown",this._stopPropagation),a.addEventListener("MSPointerDown",this._stopPropagation),a.addEventListener("click",this._stopPropagation),a.addEventListener("mousedown",this._delegateToDnDMouseDown.bind(this))},_delegateToDnDMouseDown:function(a){this.dndSource&&this.dndSource.onMouseDown&&this.dndSource.onMouseDown(a)},_stopPropagation:function(a){a.stopPropagation()}})}),define("hui/table/RowDeletion",["dojo/_base/declare"],function(a){return a(null,{allowRowDeletion:!1,_rowDeletionField:"_rowDelete",_deletionIconText:"Delete Row",_deletionIconClass:"hi-delete",_setDeletionIconText:function(a){this._deletionIconText=a,this.refresh()},_setDeletionIconClass:function(a){this._deletionIconClass=a,this.refresh()},_setAllowRowDeletion:function(a){this.allowRowDeletion=a,this.set("columns",this.__columns)},_getColumns:function(){return this.__columns||this.inherited(arguments)},_addCustomColumn:function(a){this.inherited(arguments),this.get("allowRowDeletion")&&a.push(this._defineRowDeletionColumn())},_defineRowDeletionColumn:function(){var a={field:this._rowDeletionField,sortable:!1,unhidable:!0};return a.renderCell=this._renderDeletionCell.bind(this),a.renderHeaderCell=function(a){a.textContent=""},a},_clickHandler:function(a){a.stopPropagation(),a.preventDefault();var b=this.row(a);if(b){this._previousScrollPosition=this.getScrollPosition();var c=this.collection.idProperty?this.collection.idProperty:"id";this.collection.remove(b[c]),this.refresh()}},_renderDeletionCell:function(){var a=arguments[2],b=document.createElement("button"),c=document.createElement("span"),d=document.createElement("span");c.classList.add(this._deletionIconClass),c.classList.add("hi"),c.setAttribute("aria-hidden",!0),d.textContent=this._deletionIconText,d.classList.add("icon-text"),b.appendChild(c),b.appendChild(d),a.appendChild(b),b.addEventListener("click",this._clickHandler.bind(this))}})}),define("dgrid-0.4/Editor",["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dojo/has","dojo/query","./Grid","put-selector/put","dojo/_base/sniff"],function(a,b,c,d,e,f,g,h){return a(null,{constructor:function(){this._editorInstances={},this._editorColumnListeners=[],this._editorCellListeners={},this._editorsPendingStartup=[]},postCreate:function(){var a=this;this.inherited(arguments),this.on(".dgrid-input:focusin",function(){a._focusedEditorCell=a.cell(this)}),this._editorFocusoutHandle=d.pausable(this.domNode,".dgrid-input:focusout",function(){a._focusedEditorCell=null}),this._listeners.push(this._editorFocusoutHandle)},insertRow:function(){this._editorRowListeners={};var a=this.inherited(arguments),b=this.row(a),c=this._editorCellListeners[a.id]=this._editorCellListeners[a.id]||{};for(var d in this._editorRowListeners)c[d]=this._editorRowListeners[d];this._editorRowListeners=null;var e=this._previouslyFocusedEditorCell;return e&&e.row.id===b.id&&this.edit(this.cell(b,e.column.id)),a},refresh:function(){for(var a in this._editorInstances){var b=this._editorInstances[a].domNode;b&&b.parentNode&&b.parentNode.removeChild(b)}this.inherited(arguments)},removeRow:function(a){var b=this,c=this._focusedEditorCell;if(c&&c.row.id===this.row(a).id&&(this._previouslyFocusedEditorCell=c,this._editorFocusoutHandle.pause(),setTimeout(function(){b._editorFocusoutHandle.resume(),b._previouslyFocusedEditorCell=null},0)),this._editorCellListeners[a.id]){for(var d in this._editorCellListeners[a.id])this._editorCellListeners[a.id][d].remove();delete this._editorCellListeners[a.id]}for(var e=this._alwaysOnWidgetColumns.length;e--;){var f=this.cell(a,this._alwaysOnWidgetColumns[e].id).element,g=f&&(f.contents||f).widget;g&&(this._editorFocusoutHandle.pause(),g.destroyRecursive())}return this.inherited(arguments)},renderArray:function(){var a=this.inherited(arguments);return a.length?this._startupPendingEditors():this._editorsPendingStartup=[],a},_onNotification:function(){this.inherited(arguments),this._startupPendingEditors()},_destroyColumns:function(){this._editorStructureCleanup(),this.inherited(arguments)},_editorStructureCleanup:function(){var a=this._editorInstances,b=this._editorColumnListeners;this._editTimer&&clearTimeout(this._editTimer);for(var c in a){var d=a[c];d.domNode&&d.destroyRecursive()}this._editorInstances={};for(var e=b.length;e--;)b[e].remove();for(var f in this._editorCellListeners)for(c in this._editorCellListeners[f])this._editorCellListeners[f][c].remove();for(e=0;e<this._editorColumnListeners.length;e++)this._editorColumnListeners[e].remove();this._editorCellListeners={},this._editorColumnListeners=[],this._editorsPendingStartup=[]},_configColumns:function(){var a=this.inherited(arguments);this._alwaysOnWidgetColumns=[];for(var b=0,c=a.length;b<c;b++)a[b].editor&&this._configureEditorColumn(a[b]);return a},_configureEditorColumn:function(a){var b=a.editor,c=this,e=a.renderCell||this._defaultRenderCell,f=a.editOn,g="string"!=typeof b;f?this._editorInstances[a.id]=this._createSharedEditor(a,e):g&&this._alwaysOnWidgetColumns.push(a),a.renderCell=f?function(b,g,h,i){if(!i||!i.alreadyHooked){var j=d(h,f,function(){c._activeOptions=i,c.edit(this)});c._editorRowListeners&&(c._editorRowListeners[a.id]=j)}return e.call(a,b,g,h,i)}:function(b,d,f,h){if(a.canEdit&&!a.canEdit(b,d))return e.call(a,b,d,f,h);var i=c._createEditor(a);c._showEditor(i,a,f,d),f[g?"widget":"input"]=i}},edit:function(a){function b(a){k._activeCell=e,k._showEditor(i,d,e,h),k._editTimer=setTimeout(function(){i.focus&&i.focus(),d._editorBlurHandle&&d._editorBlurHandle.resume(),k._editTimer=null,a.resolve(i)},0)}var d,e,f,g,h,i,j,k=this;if(a.column||(a=this.cell(a)),!a||!a.element)return null;if(d=a.column,g=d.field,e=a.element.contents||a.element,i=this._editorInstances[d.id]){if(this._activeCell!==e){var l=a.row;if(f=this.dirty&&this.dirty[l.id],h=f&&g in f?f[g]:d.get?d.get(l.data):l.data[g],!d.canEdit||d.canEdit(a.row.data,h)){j=new c;var m=i.domNode||i;return m.offsetWidth?(m.blur(),setTimeout(function(){b(j)},0)):b(j),j.promise}}}else if(d.editor&&(i=e.widget||e.input))return j=new c,i.focus&&i.focus(),j.resolve(i),j.promise;return null},_showEditor:function(a,b,c,d){var e=a.domNode;e||this._updateInputValue(a,d),c.innerHTML="",h(c,".dgrid-cell-editing"),h(c,a.domNode||a),e&&b.editOn&&a.validate&&a.reset&&a.reset(),e&&!b.editOn?this._editorsPendingStartup.push([a,b,c,d]):this._startupEditor(a,b,c,d)},_startupEditor:function(a,b,c,e){a.domNode&&(a._started||a.startup(),a._dgridIgnoreChange=!0,a.set("value",e),setTimeout(function(){a._dgridIgnoreChange=!1},0)),a._dgridLastValue=e,this._activeCell&&(this._activeValue=e,d.emit(c,"dgrid-editor-show",{grid:this,cell:this.cell(c),column:b,editor:a,bubbles:!0,cancelable:!1}))},_startupPendingEditors:function(){for(var a=this._editorsPendingStartup,b=a.length;b--;)this._startupEditor.apply(this,a[b]);this._editorsPendingStartup=[]},_handleEditorChange:function(a,b){var c=a.target;"_dgridLastValue"in c&&c.className.indexOf("dgrid-input")>-1&&this._updatePropertyFromEditor(b||this.cell(c).column,c,a)},_createEditor:function(a){var c,f,g,i,j=a.editor,k=a.editOn,l=this,m="string"!=typeof j&&j;if(c=a.editorArgs||{},"function"==typeof c&&(c=c.call(this,a)),m)f=new m(c),g=f.focusNode||f.domNode,g.className+=" dgrid-input",f.on(k?"blur":"change",function(){f._dgridIgnoreChange||l._updatePropertyFromEditor(a,this,{type:"widget"})});else if(this._hasInputListener||(this._hasInputListener=!0,this.on("change",function(a){l._handleEditorChange(a)})),i="textarea"===j?"textarea":"input[type="+j+"]",f=g=h(i+".dgrid-input",b.mixin({name:a.field,tabIndex:isNaN(a.tabIndex)?-1:a.tabIndex},c)),e("ie")<9){var n;n="radio"===j||"checkbox"===j?d(f,"click",function(b){l._handleEditorChange(b,a)}):d(f,"change",function(b){l._handleEditorChange(b,a)}),k?this._editorColumnListeners.push(n):this._editorRowListeners&&(this._editorRowListeners[a.id]=n)}if(a.autoSelect){var o=f.focusNode||f;o.select&&d(o,"focus",function(){setTimeout(function(){o.select()},0)})}return f},_createSharedEditor:function(a){function c(){var a=k._activeCell;n.blur(),"function"==typeof k.focus&&setTimeout(function(){k.focus(a)},l&&e("ie")<9?15:0)}function f(){var c=m.parentNode,e=c.children.length-1,f={alreadyHooked:!0},i=k.cell(m);if(d.emit(i.element,"dgrid-editor-hide",{grid:k,cell:i,column:a,editor:j,bubbles:!0,cancelable:!1}),a._editorBlurHandle.pause(),c.removeChild(m),i.row){for(h(i.element,"!dgrid-cell-editing");e--;)h(c.firstChild,"!");g.appendIfNode(c,a.renderCell(i.row.data,k._activeValue,c,k._activeOptions?b.delegate(f,k._activeOptions):f))}k._focusedEditorCell=k._activeCell=k._activeValue=k._activeOptions=null}function i(b){var d=b.keyCode||b.which;27===d?(o(),k._activeValue=j._dgridLastValue,c()):13===d&&!1!==a.dismissOnEnter&&c()}var j=this._createEditor(a),k=this,l=j.domNode,m=j.domNode||j,n=j.focusNode||m,o=l?function(){j.set("value",j._dgridLastValue)}:function(){k._updateInputValue(j,j._dgridLastValue),k._updatePropertyFromEditor(a,j)};return this._editorColumnListeners.push(d(n,"keydown",i)),(a._editorBlurHandle=d.pausable(j,"blur",f)).pause(),this._editorColumnListeners.push(a._editorBlurHandle),j},_updatePropertyFromEditor:function(a,b,c){var d,e,g;if((!b.isValid||b.isValid())&&(d=this._updateProperty((b.domNode||b).parentNode,this._activeCell?this._activeValue:b._dgridLastValue,this._retrieveEditorValue(a,b),c),this._activeCell?this._activeValue=d:b._dgridLastValue=d,"radio"===b.type&&b.name&&!a.editOn&&a.field)){g=this.row(b),f("input[type=radio][name="+b.name+"]",this.contentNode).forEach(function(c){var d=this.row(c);c!==b&&c._dgridLastValue&&(c._dgridLastValue=!1,this.updateDirty?this.updateDirty(d.id,a.field,!1):d.data[a.field]=!1)},this);for(e in this.dirty)g.id.toString()!==e&&this.dirty[e][a.field]&&this.updateDirty(e,a.field,!1)}},_updateProperty:function(a,b,c,e){var f=this;if((b&&b.valueOf())!==(c&&c.valueOf())){var g=this.cell(a),h=g.row,i=g.column;if(a=g.element,i.field&&h){var j={grid:this,cell:g,oldValue:b,value:c,bubbles:!0,cancelable:!0};if(e&&e.type&&(j.parentType=e.type),!d.emit(a,"dgrid-datachange",j)){var k;return(k=a.widget)?(k._dgridIgnoreChange=!0,k.set("value",b),setTimeout(function(){k._dgridIgnoreChange=!1},0)):(k=a.input)&&this._updateInputValue(k,b),b}this.updateDirty?(this.updateDirty(h.id,i.field,c),i.autoSave&&setTimeout(function(){f._trackError("save")},0)):h.data[i.field]=c}}return c},_updateInputValue:function(a,b){a.value=b,"radio"!==a.type&&"checkbox"!==a.type||(a.checked=a.defaultChecked=!!b)},_retrieveEditorValue:function(a,b){return"function"==typeof b.get?this._convertEditorValue(b.get("value")):this._convertEditorValue(b["checkbox"===b.type||"radio"===b.type?"checked":"value"])},_convertEditorValue:function(a,b){if("number"==typeof b)a=isNaN(a)?a:parseFloat(a);else if("boolean"==typeof b)a="true"===a||"false"!==a&&a;else if(b instanceof Date){var c=new Date(a);a=isNaN(c.getTime())?a:c}return a}})}),define("hui/core/icon",{onChangeIconProperty:function(a){if(this._textField)return this._textField.icon=a,void(a||this.removeAttribute("icon"));var b=this.querySelector("i");if(a){if(!b)switch(b=this.ownerDocument.createElement("i"),this.tagName.toLowerCase()){case"ha-select":this.querySelector("button").appendChild(b);break;case"ha-text-field":this.insertBefore(b,this.querySelector("input"));break;default:throw new Error("Embedded icon not implemented for "+this.tagName)}b.className="hi embedded "+a}else b&&b.parentNode.removeChild(b),this.removeAttribute("icon")}}),define("hui/text-field",["register-component/v2/register","./validatable/validatable","./core/icon","./core/utils","./core/deviceUtils","./core/keys","object-utils/classes"],function(a,b,c,d,e,f,g){function h(a,b){function c(a){for(3===a.nodeType&&""!==a.textContent.trim()&&(e=a),a=a.firstChild;a;)c(a),a=a.nextSibling}var e,f=a.querySelector("label");f&&(b?f.textContent=d.toggleSuffixText(b," *",a.required&&!a.noRequiredIndicator):(c(f),e&&(e.textContent=d.toggleSuffixText(e.textContent," *",a.required&&!a.noRequiredIndicator))))}function i(a){return a.required||!!a.max||!!a.min||!!a.pattern||!!a.minLength||!!a.validator}function j(a,b){a!==b&&this.handleTooltipBinding(i(this))}function k(a){var b=a.querySelector("input");a._validationListenersAdded||(a._boundValidator=a._reportValidity.bind(a),a.listenTo(b,"mouseenter",a._boundValidator),a.listenTo(b,"mouseout",a._boundValidator),a.listenTo(b,"focus",a._boundValidator),a.listenTo(b,"blur",a._boundValidator),a.listenTo(b,"keyup",a._boundValidator),a.listenTo(a,".ha-icon-alert:mouseover",a._boundValidator),a.listenTo(a,".ha-icon-alert:mouseout",a._boundValidator),a.classList.add("ha-validatable"),a._validationListenersAdded=!0)}function l(a){var b=a.querySelector("input");!d.validationRequired(a)&&a._validationListenersAdded&&(a.stopListening(b,"mouseenter",a._boundValidator),a.stopListening(b,"mouseout",a._boundValidator),a.stopListening(b,"focus",a._boundValidator),a.stopListening(b,"blur",a._boundValidator),a.stopListening(b,"keyup",a._boundValidator),a.stopListening(a,".ha-icon-alert:mouseover",a._boundValidator),a.stopListening(a,".ha-icon-alert:mouseout",a._boundValidator),a.classList.remove("ha-validatable"),a._validationListenersAdded=!1)}return a("ha-text-field",g.createObject(b,{init:function a(){a.super(this),this._validationListenersAdded=!1,this._label=null,this.validationTarget=this,this.highlightElementSelector="input",this._customValidatorFunction=null,this.supportedClasses=["mobile-text-field","mobile-text-field-focused","mobile-text-field-attachment-focused","mobile-text-field-show-placeholder","mobile-text-field-content","disabled","ha-validatable"],this.setupProperties({optional:{default:!1,type:Boolean,change:function(a){a&&(this.required=!1);var b,c=this.querySelector("label");c&&(b=c.querySelector("span.optional"),a?b||(b=this.ownerDocument.createElement("span"),b.className="optional",c.appendChild(b),b.innerHTML=" "+this.labelOptional):b&&c.removeChild(b))}},labelOptional:{default:"optional",change:function(a){var b=this.querySelector(".optional");this.optional&&b&&(b.innerHTML=" "+a)}},name:{default:"",change:function(a){var b=this.querySelector("input"),c=this.querySelector('input[type="file"]');a?c?(c.name=a,b.removeAttribute("name")):b.name=a:(b.removeAttribute("name"),c&&c.removeAttribute("name"))}},autoComplete:{default:"on",change:function(a){this.querySelector("input").autocomplete=a}},size:{default:20,type:Number,change:function(a){this.querySelector("input").size=a}},placeholder:{default:"",change:function(a){var b=this.querySelector("input");b.placeholder=a,this.label||this.ariaLabel||b.setAttribute("aria-label",a),a||(b.hasAttribute("aria-label")&&b.removeAttribute("aria-label"),b.hasAttribute("placeholder")&&b.removeAttribute("placeholder"))}},icon:{default:"",type:String,change:c.onChangeIconProperty},disabled:{default:!1,type:Boolean,change:function(a){this.querySelector("input").disabled=a,a?this.classList.add("disabled"):this.classList.remove("disabled")}},noRequiredIndicator:{default:!1,type:Boolean,change:function(a,b){a!==b&&h(this)}},required:{default:!1,type:Boolean,change:function(a,b){var c=this.querySelector("input");a&&(this.optional=!1),a!==b&&(h(this),a?k(this,c):l(this,c),this.handleTooltipBinding(i(this)),c.required=a,c.setAttribute("aria-required",a))}},maxLength:{default:524288,type:Number,change:function(a){this.querySelector("input").maxLength=a}},minLength:{default:0,type:Number,change:function(a){var b=this.querySelector("input");a?(b.minLength=a,b.setAttribute("minLength",a),k(this,b)):(b.removeAttribute("minLength"),b.minLength=0,l(this,b))}},pattern:{default:"",change:function(a){var b=this.querySelector("input");a?(b.pattern=a,k(this,b)):(b.removeAttribute("pattern"),l(this,b))}},min:{change:this._onChangeMin},max:{change:this._onChangeMax},mobileMaxHeight:{type:Number,default:34,change:function(a){e.isHandheld()&&(this.classList.contains("mobile-text-field-focused")?this._inputElement.style.height=a+"px":(this.value&&(this._previousHeight=Math.min(this.mobileMaxHeight,this._getDefaultHeight(this.value)+15)+"px"),this._inputElement.style.height=this._previousHeight||""))}},attachment:{type:Boolean,change:function(a){a?this._setUpAttachmentField():this._removeAttachmentField()}},type:{type:String,default:"text",change:function(a){var b=this.querySelector("input");this.attachment||b.setAttribute("type",a||"text")}},ariaLabel:{default:"",change:function(a){var b=this.querySelector("input");b&&(a?b.setAttribute("aria-label",a):b.placeholder||b.removeAttribute("aria-label"))}}}),this._validationData={}},postRender:function a(){a.super(this);var b,c,d=this.querySelector("input"),g=this.querySelector("ha-label");d||(d=this.ownerDocument.createElement("input"),d.className="ha-input",this.appendChild(d)),e.isHandheld()&&(this.classList.add("mobile-text-field"),e.addiOS9ImmediateFocus(),this.listenTo(d,"focus",function(){this.classList.add("mobile-text-field-focused"),d.style.height=this.mobileMaxHeight+"px"}.bind(this)),this.listenTo(d,"blur",function(){this.classList.remove("mobile-text-field-focused"),d.style.height=this._previousHeight||""}.bind(this))),d.id="ha-text-field-"+this.componentId,this.highlightElement=d,b=this.getAttribute("value"),b&&(this.value=b,e.isHandheld()&&this.classList.add("mobile-text-field-content")),c=this.getAttribute("label"),g?this.label=Array.prototype.slice.call(g.childNodes):c&&(this.label=c),this.listenTo(d,"input",function(a){a.stopPropagation(),this.value=a.target.value,this.emit("input")}.bind(this)),this.listenTo(d,"change",function(a){a.stopPropagation(),this.value&&e.isHandheld()?this.classList.add("mobile-text-field-content"):this.classList.remove("mobile-text-field-content"),this.emit("change")}.bind(this)),this.listenTo(d,"blur",function(){this.emit("blur")}.bind(this)),this.listenTo(d,"focus",function(){this.emit("focus")}.bind(this)),this.listenTo(d,"invalid",function(a){a.preventDefault()}),this.listenTo(d,"click",function(a){var b=this.querySelector('input[type="file"]');b&&(a.preventDefault(),a.stopPropagation(),b.click())}.bind(this)),this.listenTo(this,'input[type="file"]:change',function(a){var b,c,f=a.target.value;f&&(b=f.indexOf("\\")>=0?f.lastIndexOf("\\"):f.lastIndexOf("/"),c=f.substring(b),0!==c.indexOf("\\")&&0!==c.indexOf("/")||(c=c.substring(1)),d.value=c,e.isHandheld()&&this.classList.add("mobile-text-field-content"))}.bind(this)),this.listenTo(d,"keydown",function(a){if(this.attachment&&(a.preventDefault(),a.keyCode===f.BACKSPACE||a.keyCode===f.DELETE)){d.value="",this.classList.remove("mobile-text-field-content");var b,c,e=this.querySelector('input[type="file"]');e&&(b=e.cloneNode(!0),c=e.parentNode,c.removeChild(e),c.appendChild(b))}}.bind(this)),this._setUpMobileListeners(),this.listenTo(d,"blur",function(){this.classList.remove("mobile-text-field-focused"),this.classList.remove("mobile-text-field-attachment-focused"),this.classList.remove("mobile-text-field-show-placeholder")}.bind(this))},_onChangeMax:j,_onChangeMin:j,_reportValidity:function(a){var b=d.getComponentFromElement(a.target,this.tagName);b&&b.reportValidity(a)},startValidation:function(){k(this)},stopValidation:function(){l(this)},_setUpMobileListeners:function(){var a=this.querySelector("input");this.listenTo(a,"focus",function(){e.isHandheld()&&(this.attachment?this.classList.add("mobile-text-field-attachment-focused"):(this.classList.add("mobile-text-field-focused"),a.style.height="34px"))}.bind(this)),this.listenTo(a,"blur",function(){e.isHandheld()&&(this.attachment?this.classList.remove("mobile-text-field-attachment-focused"):(this.classList.remove("mobile-text-field-focused"),a.style.height=this._previousHeight||""))}.bind(this))},_removeAttachmentField:function(){var a,b=this.querySelector('input[type="file"]'),c=this.querySelector("input"),d=this.querySelector("label"),e=this.name;b&&("hi-attach"===this.icon&&(this.icon=""),a=b.parentNode,a.parentNode.removeChild(a)),c&&c.removeAttribute("aria-hidden"),d&&d.removeAttribute("aria-hidden"),this.name="",this.name=e},_setUpAttachmentField:function(){var a,b,c,d,e,f,g,h=this.name;a=this.querySelector('input[type="file"]'),a&&a.parentNode.parentNode.removeChild(a.parentNode),"hi-attach"!==this.icon&&(this.icon="hi-attach"),e=this.querySelector("input"),f=this.querySelector("label"),c=e.id+"-file-upload",g=this.querySelector(".hi-attach"),f&&f.setAttribute("aria-hidden","true"),e.setAttribute("aria-hidden","true"),g.setAttribute("aria-hidden","true"),a=document.createElement("input"),a.setAttribute("type","file"),a.setAttribute("id",c),d=document.createElement("div"),d.classList.add("ha-textfield-file-input-container"),d.classList.add("sr-only"),f&&(b=document.createElement("label"),b.innerHTML=f.innerHTML,b.setAttribute("for",c),d.appendChild(b)),d.appendChild(a),this.appendChild(d),this.name="",this.name=h},get value(){return this.querySelector("input").value},set value(a){var b=this.querySelector("input"),c=e.isHandheld();"number"==typeof a&&(a+="",a&&c?this.classList.add("mobile-text-field-content"):this.classList.remove("mobile-text-field-content")),a!==this.value&&(this.querySelector("input").value=a),a?a!==this.getAttribute("value")&&this.setAttribute("value",a):(this.removeAttribute("value"),c&&(this.classList.remove("mobile-text-field-content"),this._previousHeight="",this.classList.contains("mobile-text-field-focused")||(b.style.height=""))),this._calculateMobileHeight(a)},_calculateMobileHeight:function(a){var b=this.querySelector("input");e.isHandheld()&&(a?(this.classList.add("mobile-text-field-content"),this._previousHeight=Math.min(this.mobileMaxHeight,this._getDefaultHeight(a)+15)+"px",this.classList.contains("mobile-text-field-focused")||(b.style.height=this._previousHeight)):(this._previousHeight="",this.classList.contains("mobile-text-field-focused")||(b.style.height="")))},get validator(){return this._customValidatorFunction},set validator(a){a&&a!==this.validator?(this._customValidatorFunction=a,this.startValidation()):a||(this._customValidatorFunction=null,this.stopValidation())},get _inputElement(){return this.querySelector("input")},set label(a){var b,c=this.querySelector("input"),d=this.querySelector("label"),e=this.querySelector("ha-label");a?(b=Array.isArray(a)||1===a.nodeType,"string"==typeof a?(e&&(this.removeChild(e),d=this.querySelector("label")),d||(d=this.ownerDocument.createElement("label"),this.insertBefore(d,c)),d.htmlFor=c.id,h(this,a),this.setAttribute("label",a)):b&&(this.hasAttribute("label")&&this.removeAttribute("label"),d=this.querySelector("label"),d&&!e?this.removeChild(d):e&&this.removeChild(e),d=this.ownerDocument.createElement("label"),e=this.ownerDocument.createElement("ha-label"),a=Array.isArray(a)?a:[a],a.forEach(function(a){d.appendChild(a)}),e.appendChild(d),this.insertBefore(e,this.firstElementChild),h(this)),this.ariaLabel||c.hasAttribute("aria-label")&&c.removeAttribute("aria-label")):(this.hasAttribute("label")&&this.removeAttribute("label"),d=this.querySelector("label"),e=this.querySelector("ha-label"),e?this.removeChild(e):d&&this.removeChild(d),c.placeholder&&(this.ariaLabel||c.setAttribute("aria-label",c.placeholder))),this._label=a,this.attachment&&this._setUpAttachmentField()},get label(){return this._label},attributeChangedCallback:function a(b,c,d){"value"===b?this.value!==d&&null!==d&&(this.value=d):"label"===b?this.label=d:a.super(this,b,c,d)},focus:function(){this._inputElement.focus()},blur:function(){this._inputElement.blur()},_getDefaultHeight:function(a){var b,c,d=getComputedStyle(this._inputElement);return a=String(a||""),b=this.ownerDocument.createElement("div"),b.style.fontSize=d.fontSize,b.style.whiteSpace="pre-wrap",b.style.wordBreak="break-all",b.style.fontFamily=d.fontFamily,b.style.width=d.width,b.style.maxHeight=this.mobileMaxHeight+"px",b.style.position="absolute",b.style.top="-44px",b.style.left="-"+(parseInt(d.width,10)+10)+"px",b.textContent=a.endsWith("\n")?a+"_":a,this.ownerDocument.body.appendChild(b),c=b.offsetHeight,this.ownerDocument.body.removeChild(b),c}}))}),define("hui/table/Editor",["dojo/_base/declare","dgrid/Editor","dojo/on","../text-field"],function(a,b,c){return a(b.extend({_createEditor:function(a){var b,c=a.editor,d=this;return this._hasInputListener||(this._hasInputListener=!0,this.on("change",function(b){d._handleEditorChange(b,a)})),b=document.createElement(c),b.classList.add("dgrid-input"),b.name=a.field,b.tabIndex=isNaN(a.tabIndex)?-1:a.tabIndex,"ha-text-field"===c?b.ariaLabel=a.label:b.setAttribute("aria-label",a.label),a.autoSelect&&b.select&&b.addEventListener("focus",function(){setTimeout(function(){b.select()},0)}),b},_configColumns:function(){var a=this.inherited(arguments);return this._alwaysOnWidgetColumns=[],a.forEach(function(a){this.editable&&a.editor?this._configureEditorColumn(a):a.renderCell=a._originalRenderCell||a.renderCell}.bind(this)),a},_configureEditorColumn:function(a){var b=a.editor,d=this,e=a.editOn,f=a.renderCell||this._defaultRenderCell,g="string"!=typeof b;e?this._editorInstances[a.id]=this._createSharedEditor(a,f):g&&this._alwaysOnWidgetColumns.push(a),a._originalRenderCell=a._originalRenderCell||f,a.renderCell=e?function(a,b,f,g){g&&g.alreadyHooked||d._editorColumnListeners.push(c(f,e,function(){d._activeOptions=g,d.edit(this)}))}:function(b,c,e,h){if(!d._isEditable(a.field)||a.canEdit&&!a.canEdit(b,c))return f.call(a,b,c,e,h);var i=d._createEditor(a);d._showEditor(i,a,e,c),e[g?"widget":"input"]=i}.bind(this)},_handleEditorChange:function(a,b){var c=a.target;"_dgridLastValue"in c&&c.classList.contains("dgrid-input")&&this._updatePropertyFromEditor(b||this.cell(c).column,c,a)}}),{_setEditable:function(a){var b=this.editable;this.editable=a,void 0===this.editableFields&&(this.editableFields=this.getAvailableEditableFields()),b!==a&&this._configEditMode()},getAvailableEditableFields:function(){var a=[];return Object.keys(this.columns).forEach(function(b){var c=this.columns[b];c.editor&&a.push(c.field)}.bind(this)),a},_setEditMode:function(a){var b=this.editMode;this.editMode=a,b!==a&&this._configEditMode()},_isEditable:function(a){return this.editable&&this.getAvailableEditableFields().indexOf(a)>-1&&("specific"!==this.editMode||this.editableFields&&this.editableFields.indexOf(a)>-1)},_configEditMode:function(){this.configStructure(),this.refresh()},_showEditor:function(a,b,c,d){return b.editorInit&&b.editorInit(a,d,b),this.inherited(arguments)}})}),define("hui/table/RowStatusIndicator",["dojo/_base/declare"],function(a){return a(null,{renderRow:function(a){var b,c=this.inherited(arguments);return this.rowStatus&&("string"==typeof this.rowStatus?b=a[this.rowStatus]:"function"==typeof this.rowStatus&&(b=this.rowStatus(a)),"error"===b?(c.classList.remove("success"),c.classList.remove("warning"),c.classList.add("error")):"success"===b?(c.classList.remove("error"),c.classList.remove("warning"),c.classList.add("success")):"warning"===b?(c.classList.remove("error"),c.classList.remove("success"),c.classList.add("warning")):(c.classList.remove("success"),c.classList.remove("error"),c.classList.remove("warning"))),c}})}),define("hui/table/RowErrors",["dojo/_base/declare","dojo/_base/lang"],function(a,b){return a(null,{_rowErrors:null,postMixInProperties:function(){this.inherited(arguments),this._rowErrors={}},renderRowError:function(a,b){if(!a)return b;var c,d=document.createElement("div"),e=document.createElement("span"),f=document.createElement("div");return e.classList.add("hi-circle-alert"),e.classList.add("hi"),"string"==typeof a?(c=document.createElement("span"),c.textContent=a):a instanceof HTMLElement&&(c=a),d.appendChild(e),c&&d.appendChild(c),f.classList.add("dgrid-row-alert"),f.appendChild(d),f.appendChild(b),f},setError:function(a,b){this.setErrors([a],[b])},setErrors:function(a,c){var d,e,f,g,h=this;if(a&&c)for(d=0;d<a.length;d++)e=a[d]?this.row(a[d]):null,f=e?e.id:null,g=c[d],f&&g&&(this._rowErrors[f]=g,this.reRenderRow(e));else a&&"object"==typeof a&&(b.mixin(this._rowErrors,a),Object.keys(a).forEach(function(a){h.reRenderRow(a)}))},clearSelection:function(){return this.clearErrors(),this.inherited(arguments)},clearError:function(a){this.clearErrors([a])},clearErrors:function(a){if(a){var b=this._rowErrors,c=this;a.forEach(function(a){var d=a?c.row(a):null,e=d?d.id:null;e&&b[e]&&(b[e]=void 0,c.reRenderRow(d))})}else this._rowErrors={},this.refresh({keepCurrentPage:!0,keepScrollPosition:!0})},renderRow:function(a){var b=this.inherited(arguments),c=this._rowErrors[this.collection.getIdentity(a)];return c?this.renderRowError(c,b):b}})}),define("dgrid-0.4/Selector",["dojo/_base/declare","dojo/_base/lang","dojo/_base/sniff","./Selection","put-selector/put"],function(a,b,c,d,e){return a(d,{postCreate:function(){this.inherited(arguments),this.on(".dgrid-selector:click,.dgrid-selector:keydown",b.hitch(this,"_handleSelectorClick")),this.on("dgrid-select",b.hitch(this,"_changeSelectorInput",!0)),this.on("dgrid-deselect",b.hitch(this,"_changeSelectorInput",!1))},_defaultRenderSelectorInput:function(a,b,c,d){var f=c.parentNode,g=a.grid;e(f&&f.contents?f:c,".dgrid-selector");var h=c.input||(c.input=e(c,"input[type="+a.selector+"]",{tabIndex:isNaN(a.tabIndex)?-1:a.tabIndex,disabled:!g.allowSelect(g.row(d)),checked:b}));return h.setAttribute("aria-checked",b),h},_configureSelectorColumn:function(a){var b=this,c=a.selector;this._selectorColumns.push(a),this._selectorSingleRow=this._selectorSingleRow||"radio"===a.selector;var d="function"==typeof c?c:this._defaultRenderSelectorInput;a.sortable=!1,a.renderCell=function(c,e,f){var g=c&&b.row(c);e=g&&b.selection[g.id],d(a,!!e,f,c)},a.renderHeaderCell=function(c){var e="label"in a?a.label:a.field||"";"radio"!==a.selector&&b.allowSelectAll?(a._selectorHeaderCheckbox=d(a,!1,c,{}),b._hasSelectorHeaderCheckbox=!0):c.appendChild(document.createTextNode(e))}},_handleSelectorClick:function(a){if("INPUT"!==a.target.nodeName||"keydown"!==a.type||32!==a.keyCode){var b=this.cell(a),d=b.row;if("click"===a.type||32===a.keyCode||!c("opera")&&13===a.keyCode||0===a.keyCode){if(this._selectionTriggerEvent=a,d){if(this.allowSelect(d)){var e=this._lastSelected&&this.row(this._lastSelected);this._selectorSingleRow?e&&e.id===d.id||(this.clearSelection(),this.select(d,null,!0),this._lastSelected=d.element):d&&(a.shiftKey?this._changeSelectorInput(!0,{rows:[d]}):e=null,e=a.shiftKey?e:null,this.select(e||d,d,e?void 0:null),this._lastSelected=d.element)}}else this[this.allSelected?"clearSelection":"selectAll"]();this._selectionTriggerEvent=null}}},_changeSelectorInput:function(a,b){this._selectorColumns.length&&this._updateRowSelectors(a,b),this._hasSelectorHeaderCheckbox&&this._updateHeaderCheckboxes()},_updateRowSelectors:function(a,b){for(var c=b.rows,d=c.length,e=this._selectorColumns.length,f=0;f<d;f++)for(var g=0;g<e;g++){var h=this._selectorColumns[g],i=this.cell(c[f],h.id).element;i&&((i=(i.contents||i).input)&&!i.disabled&&(i.checked=a,i.setAttribute("aria-checked",a)))}},_updateHeaderCheckboxes:function(){for(var a=this._selectorColumns.length,b=0;b<a;b++){var c,d,e=this._selectorColumns[b],f="false",g=e._selectorHeaderCheckbox;if(g){c=this.selection,d=!1;for(var h in c)if(c[h]!=this.allSelected){d=!0;break}g.indeterminate=d,g.checked=this.allSelected,d?f="mixed":this.allSelected&&(f="true"),g.setAttribute("aria-checked",f)}}},configStructure:function(){this.inherited(arguments);var a=this.columns;this._selectorColumns=[],this._hasSelectorHeaderCheckbox=this._selectorSingleRow=!1;for(var b in a)a[b].selector&&this._configureSelectorColumn(a[b])},_handleSelect:function(a){var b=this.cell(a).column;b&&b.selector||this.inherited(arguments)}})}),define("hui/table/BatchMode",["dojo/_base/declare","dgrid/Selector","../core/utils","../checkbox"],function(a,b,c){return a(b,{deselectOnRefresh:!1,batchField:"_batch",shouldSelect:function(a){var b=!0;if(a&&a.target&&("HA-CHECKBOX"!==a.target.tagName&&"HA-RADIO-BUTTON"!==a.target.tagName&&"INPUT"!==a.target.tagName&&"BUTTON"!==a.target.tagName&&"A"!==a.target.tagName||(b=!1),!b))for(var c=a.target;c&&"HA-TABLE"!==c.tagName;)c.classList.contains("field-"+this.batchField)?(b=!0,c=null):c=c.parentElement;return b},batchModeEnabled:!0,startup:function(){this._started||(this.set("columns",this.table&&this.table.originalColumns?c.clone(this.table.originalColumns,[this]):this.get("columns")),this.inherited(arguments))},_setSelectionMode:function(a){return this._selectionMode=a,this.inherited(arguments,[this.allowBatchMode&&this.batchModeEnabled?this._selectionMode:"none"])},_setBatchModeEnabled:function(a){this.inherited(arguments),Array.prototype.forEach.call(this.domNode.querySelectorAll(".field-_batch ha-checkbox"),function(b){b.disabled=!a}),this.batchModeEnabled=a,this.set("selectionMode",this._selectionMode)},_setEditable:function(a){this.inherited(arguments),this.set("batchModeEnabled",!a)},_setAllowBatchMode:function(a){this.allowSelectAll=!0,this.allowBatchMode=a,this.set("selectionMode",this._selectionMode),this.set("columns",this.table&&this.table.originalColumns?c.clone(this.table.originalColumns,[this]):this.__columns)},_addCustomColumn:function(a){this.inherited(arguments),this.batchModeEnabled&&this.allowBatchMode&&a.unshift({selector:!0,field:this.batchField}),this.inherited(arguments,[a])},allowSelect:function(a){return!!a&&(!a.element||!a.element.classList.contains("category-row"))},_convertColumns:function(a){return Array.isArray(a)?a.map(function(a){return a.id=null,a}):Object.keys(a).map(function(b){var c=a[b];return"string"==typeof c?{field:b,label:c}:(c.field=b,c.id=null,c)})},_setBatchSelectAriaLabel:function(a){this._batchSelectAriaLabel=a,this.refresh()},_setBatchSelectAllAriaLabel:function(a){this._batchSelectAllAriaLabel=a;var b=this.domNode&&this.domNode.querySelector(".dgrid-header .field-_batch .sr-only");b&&(b.textContent=a)},_setBatchSelectAllHeaderAriaLabel:function(a){this._batchSelectAllHeaderAriaLabel=a;var b=this.domNode&&this.domNode.querySelector(".dgrid-header th.field-_batch");b&&(b.textContent=a)},_defaultRenderSelectorInput:function(a,b,c,d){var e=c.parentNode,f=a.grid,g=c.input||(c.input=document.createElement("ha-checkbox"));return c.appendChild(g),(e&&e.contents?e:c).classList.add("dgrid-selector"),a.tabIndex&&(g.tabIndex=a.tabIndex),g.disabled=!f.collection||!f.allowSelect(f.row(d)),g.checked=b,g.setAttribute("aria-checked",b),g.ariaLabel=f._batchSelectAriaLabel,g},_configureSelectorColumn:function(a){var b,c=a.selector;this._selectorColumns.push(a),this._selectorSingleRow=this._selectorSingleRow||"radio"===a.selector,b="function"==typeof c?c:this._defaultRenderSelectorInput,a.sortable=!1,a.unhidable=!0,a.renderCell=function(c,d,e){var f=c&&this.row(c);d=f&&this.selection[f.id],b(a,!!d,e,c);var g=e.querySelector("input");g&&g.setAttribute("aria-label",this._batchSelectAriaLabel)}.bind(this),a.renderHeaderCell=function(c){a.tabIndex=null;var d=a._selectorHeaderCheckbox=b(a,!1,c,{});c.classList.remove("dgrid-cell"),c.classList.add("batch-header-cell"),this._hasSelectorHeaderCheckbox=!0,c.setAttribute("aria-label",this._batchSelectAllHeaderAriaLabel),d.removeAttribute("aria-label"),d.querySelector("input").setAttribute("aria-label",this._batchSelectAllAriaLabel)}.bind(this)},_handleSelectorClick:function(a){if(32!==a.keyCode)return this.inherited(arguments)},_handleSelect:function(a){if(this.shouldSelect(a))return this.inherited(arguments)}})}),define("hui/table/PersistentSort",["dojo/_base/declare"],function(a){return a(null,{postMixInProperties:function(){this.inherited(arguments),this._loadLastSort()},_saveLastSort:function(){this.userId&&this.persistentId&&window.localStorage&&this.sort&&this.sort.length&&window.localStorage.setItem(this.userId+this.persistentId,JSON.stringify(this.sort))},_loadLastSort:function(){var a;if(this.userId&&this.persistentId&&window.localStorage)try{(a=JSON.parse(window.localStorage.getItem(this.userId+this.persistentId)))&&this.set("sort",a)}catch(a){}return Boolean(a)},_setSort:function(){this.inherited(arguments),this._saveLastSort()},_setUserId:function(a){this.userId=a,this._loadLastSort()||this._saveLastSort()},_setPersistentId:function(a){this.persistentId=a,this._loadLastSort()||this._saveLastSort()}})}),define("hui/table/DefaultRenderer",["object-utils/classes"],function(a){return a.extend(Object,{constructor:function(a){this.tableConfig=a||{}},row:function(a,b,c){return c()},header:function(a){if(a(),this.table)return this.table.querySelector(".ha-table-header")},setup:function(){},cleanup:function(){}})}),define("hui/table/rendererFactoryFactory",["../core/utils","object-utils/classes","./DefaultRenderer"],function(a,b,c){return function(b){b=b||{},b.default=[new c],Object.keys(b).forEach(function(a){b[a]&&!Array.isArray(b[a])&&(b[a]=[b[a]])});var d=function(c,d,e){var f,g,h;if(f=b[c]||b.default,f.forEach(function(a){a.table=e.table}),"columns"===d)return b.default.columns||(b.default.columns=e.table.originalColumns),a.clone(f.reduce(function(a,b){return b.columns||a},b.default.columns),[e]);if("tableConfig"===d){if(b.default.tableConfig=b.default.tableConfig||{},g=f.reduce(function(b,c){return c.tableConfig?a.mixin(b||{},c.tableConfig):b},null)){for(h in g)b.default.tableConfig.hasOwnProperty(h)||(b.default.tableConfig[h]=e.get(h));g=a.mixin({},b.default.tableConfig,g)}else g=b.default.tableConfig;return g}return"header"===d?function(a){var c=f.reduce(function(a,b){return b.header?b.header.bind(b,a):a},a);return c===a?b.default[0].header(a):c()}:"row"===d?function(a,c,d){var e=f.reduce(function(b,d){return d.row?d.row.bind(d,a,c,b):b},d);return e===d?b.default[0].row(a,c,d):e()}:function(a){var c=!1;f.forEach(function(b){b[d]&&(b[d](a),c=!0)}),!c&&b.default[d]&&b.default[d](a)}};return d.addRenderMode=function(c){var d={columns:b.default.columns,tableConfig:b.default.tableConfig};b[c]=Array.prototype.slice.call(arguments,1),"default"===c&&a.mixin(b.default,d)},d.removeRenderMode=function(a){delete b[a],"default"===a&&(b.default=[new c])},d.resetConfig=function(a){b.default.columns=a.table.originalColumns;var c;b.default.tableConfig=b.default.tableConfig||{};for(c in b.default.tableConfig)b.default.tableConfig[c]=a.get(c)},d}}),define("hui/table/scopeListStyles",["dojo/has","dgrid/Grid","dgrid/List","dgrid/util/misc"],function(a,b,c,d){var e,f;c.extend({resize:function(){var b=this.bodyNode,c=this.headerNode,g=this.footerNode,h=c.offsetHeight,i=this.showFooter?g.offsetHeight:0;this.headerScrollNode.style.height=b.style.marginTop=h+"px",b.style.marginBottom=i+"px",e||(e=a("dom-scrollbar-width"),f=a("dom-scrollbar-height"),a("ie")&&(e++,f++),d.addCssRule("ha-table .dgrid-scrollbar-width","width: "+e+"px"),d.addCssRule("ha-table-virtual .dgrid-scrollbar-width","width: "+e+"px"),d.addCssRule("ha-table .dgrid-scrollbar-height","height: "+f+"px"),d.addCssRule("ha-table-virtual .dgrid-scrollbar-height","height: "+f+"px"),d.addCssRule("ha-table .dgrid-header-row","right: "+e+"px"),d.addCssRule("ha-table-virtual .dgrid-header-row","right: "+e+"px"),d.addCssRule("ha-table .dgrid-rtl-swap .dgrid-header-row","left: "+e+"px"),d.addCssRule("ha-table-virtual .dgrid-rtl-swap .dgrid-header-row","left: "+e+"px"))}})}),define("hui/table/TableBase",["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/on","dojo/aspect","dgrid/Grid","dgrid/Keyboard","./ColumnLocking","./ContentGroupPagination","./OnDemandContentGroups","dgrid/extensions/ColumnResizer","./ColumnHider","./RowReordering","./RowDeletion","./Editor","./RowStatusIndicator","./RowErrors","./BatchMode","./PersistentSort","./rendererFactoryFactory","../core/deviceUtils","./scopeListStyles"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(a,b){b&&b.nodeType&&a.appendChild(b)}function w(a){var b=a.domNode&&a.domNode.parentElement&&a.domNode.parentElement.parentElement,c=b&&b.getBoundingClientRect();b&&!a._oldParentStyles&&(c.width&&c.height||(a._oldParentStyles={position:b.style.position,left:b.style.left,top:b.style.top,display:b.style.display,width:b.style.width,height:b.style.height},a._resizedParentElement=b,b.style.position="absolute",b.style.left="-5000px",b.style.top="-5000px",b.style.display="inline-block",b.style.width="2000px",b.style.height="20000px"))}function x(a){a.on("dgrid-sort",function(b){for(var c,d=b.sort[0],e=d?d.property:"",f=!!d&&d.descending,g=a.columns||[],h=0;h<g.length;++h)if(g[h].field===e){c=g[h].comparator;break}"function"==typeof c&&(b.preventDefault(),a.set("sort",function(b,d){return(f?-1:1)*c.call(a,b,d)}),a.updateSortArrow(b.sort,!0))})}f.extend({renderRow:function(a,b){var c,d=this.createRowCells("td",function(c,d){var e=a;d.get?e=d.get(a):"field"in d&&"_item"!==d.field&&(e=e[d.field]),this.print&&d.renderPrintCell?v(c,d.renderPrintCell(a,e,c,b)):d.renderCell?v(c,d.renderCell(a,e,c,b)):this._defaultRenderCell.call(d,a,e,c,b)}.bind(this),b&&b.subRows,a);return c=document.createElement("div"),c.setAttribute("role","row"),c.appendChild(d),c},configStructure:function(){var a=this.subRows,b=this._columns=this.columns;if(this.columns=b||{},a)for(var c=0;c<a.length;c++)a[c]=this._configColumns(c+"-",a[c]);else this.subRows=[this._configColumns("",b)]}});var y=a(null,{rendererFactory:null,_firstRun:!0,_totalRowClickListener:null,_totalRow:null,postMixInProperties:function(){this.inherited(arguments),this.totals&&this.set("totals",this.totals)},buildRendering:function(){this.inherited(arguments),this.headerNode.classList.add("ha-table-header"),this.contentNode.removeAttribute("role")},_setTotals:function(a){this.totals=a,this._renderTotalRow(a,"_totalRow")},postCreate:function(){this.inherited(arguments),this.on(["dgrid-select","dgrid-deselect","dgrid-refresh-complete","dgrid-error","dgrid-cellfocusin","dgrid-cellfocusout","dgrid-sort","dgrid-columnresize","dgrid-columnreorder","dgrid-columnstatechange","dgrid-datachange","dgrid-editor-show","dgrid-editor-hide"].join(","),function(a){var b=a.type.substr(6);"deselect"!==b&&"select"!==b||(b="batch-"+b),a.stopPropagation(),d.emit(this.domNode,b,a)}.bind(this));var a=function(){this._renderTotalRow(this.totals,"_totalRow")}.bind(this);this._listeners.push(e.after(this,"renderArray",function(a){return this.contentNode.removeAttribute("tabIndex"),a}),e.after(this,"renderQuery",function(a){return this._applyA11yRoles(),a}),e.after(this,"_hideColumn",a),e.after(this,"_showColumn",a),e.after(this,"_processScroll",this._publishResizeEvent.bind(this)),e.after(this,"_updateNavigation",this._publishResizeEvent.bind(this)),e.around(this,"renderHeader",function(a){return function(){var b=this,c=arguments;return this.rendererFactory?this.rendererFactory(this.renderMode,"header",this)(function(){return a.apply(b,c)}):a.call(this)}}),e.around(this,"renderRow",function(a){return function(b,c){var d=arguments,e=this;return this.rendererFactory?this.rendererFactory(this.renderMode,"row",this)(b,c,function(){return a.apply(e,d)}):a.apply(this,d)}})),x(this),this.rendererFactory=this.rendererFactory||t()},cleanup:function(){this._cleanup=!0,this.inherited(arguments),this._cleanup=!1},_publishResizeEvent:function(){d.emit(this.domNode,"table-resize",{cancelable:!1,bubbles:!0})},addRenderMode:function(){var a=Array.prototype.slice.call(arguments,0);this.rendererFactory?this.rendererFactory.addRenderMode.apply(this.rendererFactory,a):(this.rendererFactory=t(),this.rendererFactory.addRenderMode.apply(this.rendererFactory,a))},removeRenderMode:function(a){this.rendererFactory&&this.rendererFactory.removeRenderMode(a)},createRowCells:function(){var a=this.inherited(arguments);return Array.prototype.forEach.call(a.querySelectorAll("tr"),function(a){a.setAttribute("role","presentation")}),a},_setSort:function(){this._sortCalled=!0,this.inherited(arguments),this._setSortA11yAttributes()},_setSortA11yAttributes:function(){if(this.columns.length&&this.sort.length){var a={};this.sort.forEach&&this.sort.forEach(function(b){a[b.property]=b.descending?"descending":"ascending"}),this.columns.forEach(function(b){b.field in a?b.headerNode.setAttribute("aria-sort",a[b.field]):b.headerNode.classList.contains("dgrid-sortable")?b.headerNode.setAttribute("aria-sort","none"):b.headerNode.hasAttribute("aria-sort")&&b.headerNode.removeAttribute("aria-sort")})}},refresh:function(){if(this._started)return w(this),this.inherited(arguments)},resetParentStyles:function(){var a;if(this._resizedParentElement){for(a in this._oldParentStyles)this._resizedParentElement.style[a]=this._oldParentStyles[a];this._oldParentStyles=null,this._resizedParentElement=null}},reRenderRow:function(a,b){b=b||{};var c=this.row(a);if(c&&c.element){b.rows=this._rows;var d=c.element.parentElement,e=c.element.nextSibling;this.removeRow(c.element),this.insertRow(c.data,d,e,c.element.rowIndex,b)}},_setCompact:function(a){this.compact=a,this.compact?this.domNode.classList.add("compact"):this.domNode.classList.remove("compact")},_setAutoheight:function(a){this.domNode.classList[a?"add":"remove"]("dgrid-autoheight")},startup:function(){this.inherited(arguments),this._firstRun=!1},scrollTo:function(){if(!this._firstRun)return this.inherited(arguments)},_setRenderMode:function(a){this.rendererFactory&&a!==this.renderMode&&(this.rendererFactory(this.renderMode,"cleanup",this)(this),this.renderMode=a,this._pauseRendering(),this.set("columns",this.rendererFactory(this.renderMode,"columns",this)),this.set(this.rendererFactory(this.renderMode,"tableConfig",this)),this.rendererFactory(this.renderMode,"setup",this)(this),this._resumeRendering(),this.refresh())},_pauseRendering:function(){this._pausedRefresh=this.refresh,this.refresh=function(){},this._pausedRenderArray=this.renderArray,this.renderArray=function(){return this._rows},this._pausedRenderHeader=this.renderHeader,this.renderHeader=function(){}},_resumeRendering:function(){this._pausedRefresh&&(this.refresh=this._pausedRefresh,this._pausedRefresh=null),this._pausedRenderArray&&(this.renderArray=this._pausedRenderArray,this._pausedRenderArray=null),this._pausedRenderHeader&&(this.renderHeader=this._pausedRenderHeader,this._pausedRenderHeader=null)},_setRendererFactory:function(a){this.rendererFactory=a},row:function(){var a=this.inherited(arguments);return a&&a.element&&(a.flagNode=a.element.querySelector(".table-row-flag"),a.contentNode=a.element.querySelector(".table-row-content")),a},resize:function(){w(this),this.inherited(arguments),this.headerScrollNode&&(this.headerScrollNode.style.height=""),this._publishResizeEvent()},renderHeader:function(){this.inherited(arguments);var a=this.headerNode.firstChild;(this.subRows.headerRows||this.subRows).forEach(function(a){a.forEach(function(a){a.headerNode.classList.contains("dgrid-sortable")&&a.headerNode.setAttribute("aria-sort","none")})}),this._sortListener&&this._sortListener.remove(),u.isMobile()||(this._sortListener=d(a,"click,keydown",this._onHeaderClick.bind(this)))},_onHeaderClick:function(a){if("click"===a.type||32===a.keyCode||13===a.keyCode){var b,c,e=a.target,f=this.sort[0],g=[];do{if(e.sortable){c=e.field||e.columnId,g=[],f=this.sort[0],f&&f.property===c?g.push({property:c,descending:!f.descending}):g.push({property:c,descending:!1}),b={bubbles:!0,cancelable:!0,this:this,parentType:a.type,sort:g},d.emit(a.target,"dgrid-sort",b)&&(this._sortNode=e,this.set("sort",g));break}}while((e=e.parentNode)&&e!==this.headerNode)}},removeRow:function(a){var b,c=a.offsetHeight;return a.destroy&&a.destroy(),b=this.inherited(arguments),d.emit(this.domNode,"row-remove",{height:c,bubbles:!0,cancelable:!1}),b},insertRow:function(){var a=this.inherited(arguments),b=a.offsetHeight;return d.emit(this.domNode,"row-insert",{height:b,bubbles:!0,cancelable:!1}),a.classList.add("ha-table-row"),a},updateSortArrow:function(){if(this._lastSortedArrow&&this._lastSortedArrow.parentNode.parentNode.classList.remove("sorted"),this.inherited(arguments),this._lastSortedArrow){var a=this._lastSortedArrow.parentNode;a.removeChild(this._lastSortedArrow),a.parentNode.classList.add("sorted"),a.firstChild.nextSibling?a.insertBefore(this._lastSortedArrow,a.firstChild.nextSibling):a.appendChild(this._lastSortedArrow)}},_convertColumns:function(a){return Array.isArray(a)?a.map(function(a){return a.id=null,a}):Object.keys(a).map(function(b){var c=a[b];return"string"==typeof c?{field:b,label:c}:(c.field=b,c.id=null,c)})},_setColumns:function(a){if(a){this.__columns=a;var b=this._convertColumns(a);this._addCustomColumn&&this._addCustomColumn(b),this.inherited(arguments,[b]),this.headerNode.removeAttribute("tabIndex")}},_getColumns:function(){return this.__columns||this.inherited(arguments)},_renderTotalCell:function(a,b,c){var d=a[c.field]||"";b.textContent=d,c.className&&b.classList.add(c.className)},_checkForValidTotalTextCell:function(a,b,c,d){var e=this.columns[d].field;return e===this.batchField||e===this.categoryProperty?c:a[e]?null:c||b.getElementsByClassName("field-"+this.columns[d].field)[0]},_renderTotalRow:function(a,c,d){if(this[c]&&(this[c].parentNode&&this[c].parentNode.removeChild(this[c]),this[c]=null),a){var e,f,g,h,i,j,k,l,m,n,o,p=d?d.parentNode:this.contentNode,q=!1;for(g=this.createRowCells("td",b.hitch(this,"_renderTotalCell",a)),h=document.createElement("div"),h.setAttribute("role","row"),h.classList.add("total-row"),h.appendChild(g),this[c]=h,i=Array.isArray(this.columns)?new Array(this.columns.length):Object.keys(this.columns).sort(),f=i.length-1;f>=0;f--)n=void 0!==i[f]&&null!==i[f]?i[f]:f,this.columns.hasOwnProperty(n)&&(m=this.isColumnHidden&&this.isColumnHidden(this.columns[n].id),l=this.columns[n].field,a[l]&&!m&&(q=!0),(e=m?e:this._checkForValidTotalTextCell(a,h,e,n))||l===this.categoryProperty||l===this.batchField||m||(k=h.getElementsByClassName("field-"+l)[0]));return q?(e?(j=document.createElement("th"),j.innerHTML=e.innerHTML,j.setAttribute("scope","row"),j.setAttribute("role","rowheader"),j.textContent=this.totalText||"TOTAL",j.classList.add("total-text"),j.classList.add("right"),j.classList.add("dgrid-cell"),j.classList.add("ha-table-cell"),e.parentNode.replaceChild(j,e)):k&&(o=document.createElement("span"),o.classList.add("sr-only"),o.textContent=this.totalText,k.insertBefore(o,k.firstChild)),p&&p.parentNode&&p.insertBefore(h,d||null),h):null}},_setTotalText:function(a){this.totalText=a,this._totalRow&&this._renderTotalRow(this.totals,"_totalRow"),this.inherited(arguments)},_applyA11yRoles:function(){var a=this.contentNode.querySelectorAll(".dgrid-loading"),b=this.contentNode.querySelector(".dgrid-no-data");Array.prototype.slice.apply(a).forEach(function(a){a.setAttribute("role","alert")}),b&&b.setAttribute("role","gridcell")},resizeColumnWidth:function(a,b){var c=this.get("columns");if("string"==typeof a&&void 0===c[a])for(var d=0;d<c.length;d++)if(c[d].field===a){a=d;break}this.inherited(arguments,[a,b])}});return y.factory=function(b,c){b=b||{};var d=[g,k,l,o,y,p,q,r,m,n,s,h];return b.virtual?d.unshift(j):d.unshift(f,i),new(a(d))(b,c)},y}),define("hui/table/RowEditingRenderer",["./DefaultRenderer","object-utils/classes","dojo/aspect","../core/a11y"],function(a,b,c){function d(a){var b={};return a&&Object.keys(a).forEach(function(c){a[c].getValue&&(b[c]=a[c].getValue())}),b}function e(a,b){Object.keys(b).forEach(function(c){var d=a[c];d&&d.setValue&&d.setValue(b[c])})}function f(a,b,c,d){f.timeout&&(clearTimeout(f.timeout),f.timeout=null),f.timeout=setTimeout(function(){for(var a=document.activeElement,b=!1;a&&a!==document;){if(a===c){b=!0;break}a=a.target?a.target:a.parentElement}!b&&c.parentElement&&d.rowEditSaveHandler()},250)}function g(a,b,c,d){var e=a(),g=Array.prototype.slice.call(e.querySelectorAll("td"));return e.setAttribute("role","form"),g.forEach(function(a){var c=d.cell(a),g=c.column,h=b[g.field];h&&h.editor&&(h.editor.classList.add("row-editor"),h.column.label&&(h.editor.placeholder=h.column.label),a.innerHTML="",a.appendChild(h.editor)),Array.prototype.slice.call(a.children).forEach(function(a){a.addEventListener("blur",function(b){f(b,a,e,d)})})}),e}return b.extend(a,{constructor:function(){this._editableRowId=null,this._blurEventHandle=null,this._removeRowAspect=null,this._insertRowAspect=null},setup:function(a){var b=this;this._removeRowAspect=c.before(a,"removeRow",function(c){return a.row(c).id===b._editableRowId?b._savedFieldValues=d(b._editableFields):b._savedFieldValues=null,arguments}),this._insertRowAspect=c.after(a,"insertRow",function(c){var d=a.row(c);return null!==b._savedFieldValues&&b._editableRowId===d.id&&e(b._editableFields,b._savedFieldValues),c})},cleanup:function(){this._cleanEventListeners(),this._editableRowId=null,this._editableFields=null,this._removeRowAspect.remove(),this._removeRowAspect=null,this._insertRowAspect.remove(),this._insertRowAspect=null},_cleanEventListeners:function(){null!==this._blurEventHandle&&(document.body.removeEventListener("mouseup",this._blurEventHandle),this._blurEventHandle=null)},setEditableRow:function(a,b,c){var d=this._editableRowId;this._editableRowId=b,this._editableFields=c,this._savedFieldValues=null,null!==d&&(this._cleanEventListeners(),a.reRenderRow(d)),null!==b&&a.reRenderRow(b)},row:function(a,b,c){var d,e=this.table,f=e.row(a);return f.id!==this._editableRowId?c():(d=g(c,this._editableFields,a,e),d.classList.add("editable-row"),null===this._blurEventHandle&&(this._blurEventHandle=function(a){for(var b=a.target,c=!1;b&&b!==document;){if(b.classList.contains("editable-row")){c=!0;break}b=b.target?b.target:b.parentElement}c||this.table.rowEditSaveHandler()}.bind(this),document.body.addEventListener("mouseup",this._blurEventHandle)),d)}})}),define("hui/table/RowExpansionRenderer",["./DefaultRenderer","object-utils/classes","../core/keys","../core/a11y","../core/utils"],function(a,b,c,d,e){function f(a,b){var c=!0;if(a&&a.target){for(var d=a.target;d&&"HA-TABLE"!==d.tagName;)d.classList.contains(b)?(c=!1,d=null):d=d.parentElement;"HA-CHECKBOX"!==a.target.tagName&&"HA-RADIO-BUTTON"!==a.target.tagName&&"INPUT"!==a.target.tagName&&"BUTTON"!==a.target.tagName&&"A"!==a.target.tagName||(c=!1)}return c}function g(a,b){b?a.querySelector(".dgrid-grid").classList.add("animate-height"):a.querySelector(".dgrid-grid").classList.remove("animate-height")}var h=0;return b.extend(a,{constructor:function(a){a=a||{},this.renderRowExpansionContent=a.renderRowExpansionContent||function(a){var b=this.table.ownerDocument.createElement("div"),c=this.table.store.getIdentity(a);return b.textContent="RowExpansion content for row with object id: "+c,b},this.activatorSelector=a.activatorSelector,this.expansionHeight=a.expansionHeight,this.manualActivation=a.manualActivation||!1,this.expansionClassName=a.expansionClassName,this.useFocusIndicator=a.useFocusIndicator||!1,this.focusIndicatorLabel=a.focusIndicatorLabel||"",this._expandedRows={},this.scrollingThreshold=a.scrollingThreshold||!1,this.autoResizeTable=a.autoResizeTable||!1,a.activatorSelector||(this.tableConfig={selectionMode:"none"})},_expansionMouseHandler:function(a){a.stopPropagation()},_toggleRowExpansion:function(a,b,c){var d,f,h=a.querySelector(".ha-table-row-expansion"),i=this.table.row(a);if(a.querySelector("."+this.batchClass)?(h.classList.add("batch-table-expansion"),h.classList.remove("no-batch-table-expansion")):(h.classList.add("no-batch-table-expansion"),h.classList.remove("batch-table-expansion")),void 0!==b&&null!==b?d=!Boolean(b):(f=h.classList.contains("hidden")!==h.classList.contains("hide-expansion"),d=h.classList.contains("hidden")),!f)if(d){if(this._expandedRows[i.id]=!0,h.classList.remove("hidden"),this.useFocusIndicator&&a.classList.add("show-focus"),setTimeout(function(){h.classList.remove("hide-expansion"),this._handleFocusAndAriaAttributes(h,c,a)}.bind(this),0),!1!==this.scrollingThreshold){for(var j=a;j&&!j.classList.contains("dgrid-scroller");)j=j.parentElement;j&&setTimeout(function(){var b=j.getBoundingClientRect(),c=a.getBoundingClientRect();(b.bottom-c.top)/c.height<this.scrollingThreshold&&e.animateScrollTo(j,a.offsetTop,150)}.bind(this),50)}this.autoResizeTable&&setTimeout(function(){this.table._calculateInitialHeight({type:"row-expander-resize"})}.bind(this),0)}else delete this._expandedRows[i.id],h.classList.add("hide-expansion"),this.useFocusIndicator&&a.classList.remove("show-focus"),setTimeout(function(){h.classList.add("hidden")}.bind(this),350),this.autoResizeTable&&setTimeout(function(){g(this.table,!0),this.table._calculateInitialHeight({type:"row-expander-resize"}),setTimeout(function(){g(this.table,!1)}.bind(this),250)}.bind(this),250),this._handleFocusAndAriaAttributes(h,c,a)},_handleFocusAndAriaAttributes:function(a,b,c){a.classList.contains("hide-expansion")?(b.hasAttribute("tabindex")||(b.setAttribute("tabindex","-1"),b.addEventListener("blur",function a(){b.removeAttribute("tabindex"),b.removeEventListener("blur",a)})),b.focus(),b.setAttribute("aria-expanded",!1),c.classList.remove("highlighted-dgrid-row"),this.table.emit("expandable-row-close",{bubbles:!1,row:c})):(b.setAttribute("aria-expanded",!0),c.classList.add("highlighted-dgrid-row"),a.focus(),this.table.emit("expandable-row-show",{bubbles:!1,row:c}))},renderRowExpansion:function(a,b){var e,g,i=this.table,j=i.ownerDocument.createElement("div"),k=a.querySelector("table")||a,l=function(b,c){(this.activatorSelector||f(b,this.batchClass))&&this._toggleRowExpansion(a,c,k)}.bind(this),m=function(b,c){this._toggleRowExpansion(a,c,k)}.bind(this),n=this.renderRowExpansionContent(b,m),o=i.ownerDocument.createElement("button"),p=function(a){a.keyCode!==c.ENTER&&a.keyCode!==c.SPACEBAR||l(a)},q=a.querySelector("."+this.batchClass);if(this.expansionHeight&&(j.style.height=this.expansionHeight+"px"),o.className="hi hi-close close-expansion-button",o.addEventListener("click",m),o.setAttribute("aria-label","Close expanded row"),j.appendChild(n),this.manualActivation||(n.appendChild(o),j.setAttribute("tabindex","-1"),j.addEventListener("keydown",function(a){a.keyCode===c.ESCAPE&&l(),d.keepFocusInsideListener(a,j)}),j.addEventListener("click",this._expansionMouseHandler),j.addEventListener("mousedown",this._expansionMouseHandler),j.addEventListener("touchstart",this._expansionMouseHandler),this.activatorSelector&&(k=a.querySelector(this.activatorSelector)),g=j.id="table-row-expansion"+h++,k.setAttribute("aria-controls",g),k.setAttribute("aria-expanded",!1),k&&k.addEventListener&&(k.addEventListener("click",l),"BUTTON"!==k.tagName&&k.addEventListener("keydown",p)),e=function(){k.removeEventListener("click",l),k.removeEventListener("keydown",p)}),j.className="ha-table-row-expansion",b.id in this._expandedRows||(j.classList.add("hide-expansion"),j.classList.add("hidden")),this.expansionClassName&&j.classList.add(this.expansionClassName),q?j.classList.add("batch-table-expansion"):j.classList.add("no-batch-table-expansion"),this.useFocusIndicator){var r=document.createElement("button");r.className="focus-indicator hi hi-chevron-down",this.focusIndicatorLabel&&r.setAttribute("aria-label",this.focusIndicatorLabel),r.addEventListener("click",function(){this._toggleRowExpansion(a,!0,k)}.bind(this)),a.appendChild(r)}return a.appendChild(j),a.destroy=function(){e&&e(),n.destroy&&n.destroy()},a},row:function(a,b,c){var d=c();return this.renderRowExpansion(d,a,b)},setup:function(){this.batchClass="field-"+this.table.batchField}})}),define("hui/table/responsive/StackedRenderer",["object-utils/classes","../DefaultRenderer"],function(a,b){function c(a,b){return"ha-table-"+a.componentId+"-header-"+b}return a.extend(b,{constructor:function(a){this.tableConfig=a},row:function(a,b,d){var e=d();if(!e.classList.contains("category-row")){var f,g=document.createElement("td"),h=document.createElement("div"),i=document.createElement("div"),j=document.createElement("div"),k=this.table;i.classList.add("ha-stacked-left-column"),j.classList.add("ha-stacked-right-column"),g.classList.add("dgrid-cell"),Object.keys(this._matrix).forEach(function(a){var b,d,g,h,l,m=this._matrix[a];for(g=0;g<m.length;g++)d=m[g],b=document.createElement("div"),d&&(h=".field-"+d,l=e.querySelector(h),f=k.table.column(l),b.innerHTML=l.innerHTML,b.setAttribute("aria-describedby",c(k,f.id)),b.setAttribute("role","gridcell"),l.parentElement.removeChild(l)),"left"===a?i.appendChild(b):j.appendChild(b)},this),this._ignore.forEach(function(a){var b=e.querySelector(".field-"+a);b&&b.parentElement.removeChild(b)}),h.appendChild(i),h.appendChild(j),g.appendChild(h),e.querySelector("tr").appendChild(g)}return e},header:function(a){a();var b=this.table.querySelector(".ha-table-header"),d=this.table.querySelector(".batch-header-cell");if(b&&Array.prototype.slice.call(b.querySelectorAll("th.dgrid-cell"),0).forEach(function(a){a.columnId&&(a.id=c(this.table,a.columnId))}.bind(this)),d){var e=d.querySelector("ha-checkbox"),f=this.table._toolbarNode,g=f.querySelector(".mobile-batch-header");g||(g=this.table.ownerDocument.createElement("div"),g.classList.add("mobile-batch-header"),g.classList.add("dgrid-selector"),g.addEventListener("click",function(a){a.column={row:null},a.element=g,this.table.table._handleSelectorClick(a)}.bind(this)),f.classList.add("mobile-batch-container"),f.appendChild(g)),g.innerHTML="",g.appendChild(e)}},setup:function(){function a(a){"left"===a.stackedColumn||"right"===a.stackedColumn?"number"==typeof a.stackedRow&&(d[a.stackedColumn][a.stackedRow]=a.field):a.field?e.push(a.field):"string"==typeof a&&e.push(a)}var b,c=this.table.columns,d={left:[],right:[]},e=[],f=!0;if(Array.isArray(c)?c.forEach(a):Object.keys(c).map(function(a){return"string"==typeof c[a]?a:c[a]}).forEach(a),0===d.left.length&&0===d.right.length)for(;d.right.length<3&&(b=e.shift());)d[f?"left":"right"].push(b),f=!f;this._matrix=d,this._ignore=e,this.table.classList.add("ha-stacked-table")},cleanup:function(){this.table.classList.remove("ha-stacked-table")}})}),define("hui/table/responsive/ColumnLockingRenderer",["object-utils/classes","../DefaultRenderer"],function(a,b){return a.extend(b,{constructor:function a(){a.super(this),this.tableConfig.lockedColumns=1},setup:function(){this.table.classList.add("ha-column-locking-table"),this.table.refresh()},cleanup:function(){this.table.classList.remove("ha-column-locking-table")}})}),define("hui/table/responsive/ResponsiveDefaultRenderer",["object-utils/classes","../DefaultRenderer"],function(a,b){return a.extend(b,{setup:function(){this.table.classList.add("ha-table-simple-scroll")},cleanup:function(){this.table.classList.remove("ha-table-simple-scroll")}})}),define("text!hui/table/table.html",[],function(){return'<template>\n    <div class="tablebar">\n        <div class="table-bar tablebar-default" role="menubar">\n            <div class="custom-node"></div>\n            <div class="filter-node"></div>\n            <div class="default-actions">\n                <span class="custom-action-node"></span>\n                <button name="edit">\n                    <span class="hi hi-edit" role="presentation" aria-hidden="true"></span>\n                    <span class="sr-only">{{editIconText}}</span>\n                </button>\n                <button name="print">\n                    <span class="hi hi-print" role="presentation" aria-hidden="true"></span>\n                    <span class="sr-only">{{printIconText}}</span>\n                </button>\n                <button aria-haspopup="true" name="export">\n                    <span class="hi hi-export" role="presentation" aria-hidden="true"></span>\n                    <span class="sr-only">{{exportIconText}}</span>\n                </button>\n                <button name="settings">\n                    <span class="hi hi-settings-o" role="presentation" aria-hidden="true"></span>\n                    <span class="sr-only">{{settingsIconText}}</span>\n                </button>\n                <ha-popover class="ha-table-settings-popover">\n                    <ha-popover-form>\n                        <section>\n                            <div class="section column-hider hidden">\n                                <h4>{{editColumnsText}}</h4>\n\n                                <div class="edit-columns"></div>\n                            </div>\n\n\n                            <div class="section">\n                                <div class="display-density hidden">\n                                    <h4>{{displayDensityText}}</h4>\n                                </div>\n\n                                <div class="custom"></div>\n\n                                <div class="rows-per-page">\n                                    <h4>{{rowsPerPageText}}</h4>\n\n                                    <ha-radio-button-group name="rowsPerPage">\n                                        <ha-radio-button label="50" value="50"></ha-radio-button>\n                                        <ha-radio-button label="150" value="150"></ha-radio-button>\n                                        <ha-radio-button label="300" value="300"></ha-radio-button>\n                                    </ha-radio-button-group>\n                                </div>\n                            </div>\n                        </section>\n                    </ha-popover-form>\n                </ha-popover>\n            </div>\n        </div>\n        <div class="table-bar tablebar-batch animate-hidden" role="menubar">\n            <div class="batch-node"></div>\n            <div class="batch-count" role="alert"></div>\n        </div>\n        <div class="table-bar tablebar-edit animate-hidden" role="menubar">\n            <div class="edit-actions">\n                <button name="cancel" class="ha-button edit-cancel">{{editModeCancelText}}</button>\n                <button name="save" class="ha-button edit-save">{{editModeSaveText}}</button>\n            </div>\n        </div>\n    </div>\n    <div class="grid-node"></div>\n    <span class="table-escape-node" tabindex="-1" aria-label="table escaped"></span>\n</template>\n'}),define("text!hui/table/print.html",[],function(){return'<!doctype html>\n<html lang="en">\n    <head>\n        <meta charset="UTF-8">\n        <title>Print table</title>\n        <style>{{{dgridCss}}}</style>\n        <style>\n            body {\n                font-family: {{{printListFontFamily}}};\n            }\n\n            .dgrid-header-row {\n                position: static;\n            }\n\n            .dgrid-scroller {\n                margin-top: 0;\n            }\n\n            .noprint,\n            .print .tablebar {\n                display: none;\n            }\n\n            .print .numeric,\n            .print .right {\n                text-align: right;\n            }\n        </style>\n        {{{customCss}}}\n    </head>\n\n    <body>\n        <h1>{{printListTitleText}}</h1>\n        <div class="subTitle">{{printListSubTitleText}}</div>\n        <div role="grid" class="dgrid dgrid-grid ui-widget grid-node dgrid-autoheight print">{{{gridContent}}}</div>\n\n        <script>\n            window.print();\n        </script>\n    </body>\n</html>\n'}),define("text!dgrid-0.4/css/dgrid.css",[],function(){return"/* This stylesheet provides the structural CSS for the dgrid */\n.dgrid {\n\tposition: relative;\n\toverflow: hidden; /* This is needed by IE to prevent crazy scrollbar flashing */\n\tborder: 1px solid #ddd;\n\theight: 30em;\n\tdisplay: block;\n}\n\n.dgrid-header {\n\tbackground-color: #eee;\n}\n\n.dgrid-header-row {\n\tposition: absolute;\n\tright: 17px; /* scrollbar width; revised in List.js if necessary */\n\tleft: 0;\n}\n\n.dgrid-header-scroll {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n}\n\n.dgrid-footer {\n\tposition: absolute;\n\tbottom: 0;\n\twidth: 100%;\n}\n\n.dgrid-header-hidden {\n\t/*\n\t\tUsed to \"hide\" header, without losing size information for reference.\n\t\t!important is used to supersede theme styles at higher specificity.\n\t\tLeft/right box styles are untouched, as they may influence width of\n\t\t.dgrid-content as updated in Grid's resize method.\n\t*/\n\tfont-size: 0; /* allow shrinkage in IE Quirks mode for Lists */\n\theight: 0 !important;\n\tborder-top: none !important;\n\tborder-bottom: none !important;\n\tmargin-top: 0 !important;\n\tmargin-bottom: 0 !important;\n\tpadding-top: 0 !important;\n\tpadding-bottom: 0 !important;\n}\n\n.dgrid-footer-hidden {\n\t/* Hiding footer is much simpler; simply set its display to none. */\n\tdisplay: none;\n}\n\n.dgrid-sortable {\n\tcursor: pointer;\n}\n.dgrid-header, .dgrid-header-row, .dgrid-footer {\n\toverflow: hidden;\n\tbackground-color: #eee;\n}\n\n.dgrid-row-table {\n\tborder-collapse: collapse;\n\tborder: none;\n\ttable-layout: fixed;\n\tempty-cells: show;\n\twidth: 100%;\n\theight: 100%;\n}\n.dgrid-cell {\n\tpadding: 3px;\n\ttext-align: left;\n\toverflow: hidden;\n\tvertical-align: top;\n\tborder: 1px solid #ddd;\n\tborder-top-style: none;\n\n\tbox-sizing: border-box;\n\t-moz-box-sizing: border-box;\n\t-ms-box-sizing: border-box;\n\t-webkit-box-sizing: border-box;\n}\n\n.dgrid-content {\n\tposition: relative;\n\theight: 99%;\n}\n\n.dgrid-scroller {\n\toverflow-x: auto;\n\toverflow-y: scroll;\n\tposition: absolute;\n\ttop: 0px;\n\tmargin-top: 25px; /* this will be adjusted programmatically to fit below the header*/\n\tbottom: 0px;\n\twidth: 100%;\n}\n\n.dgrid-preload {\n\t/* Force IE6 to honor 0 height */\n\tfont-size: 0;\n\tline-height: 0;\n}\n\n.dgrid-loading {\n\tposition: relative;\n\theight: 100%;\n}\n.dgrid-above {\n\tposition: absolute;\n\tbottom: 0;\n}\n\n.ui-icon {\n\twidth: 16px;\n\theight: 16px;\n\tbackground-image: url('images/ui-icons_222222_256x240.png');\n}\n\n.ui-icon-triangle-1-e {\n\tbackground-position: -32px -16px;\n}\n.ui-icon-triangle-1-se {\n\tbackground-position: -48px -16px;\n}\n\n.dgrid-expando-icon {\n\twidth: 16px;\n\theight: 16px;\n}\n.dgrid-tree-container {\n\t-webkit-transition-duration: 0.3s;\n\t-moz-transition-duration: 0.3s;\n\t-ms-transition-duration: 0.3s;\n\t-o-transition-duration: 0.3s;\n\ttransition-duration: 0.3s;\n\toverflow: hidden;\n}\n.dgrid-tree-container.dgrid-tree-resetting {\n\t-webkit-transition-duration: 0;\n\t-moz-transition-duration: 0;\n\t-ms-transition-duration: 0;\n\t-o-transition-duration: 0;\n\ttransition-duration: 0;\n}\n\n/* Single Sort */\n.dgrid-sort-arrow {\n\tbackground-position: -64px -16px;\n\tdisplay: block;\n\tfloat: right;\n\tmargin: 0 4px 0 5px;\n\theight: 12px;\n}\n.dgrid-sort-up .dgrid-sort-arrow {\n\tbackground-position: 0px -16px;\n}\n\n/* selection*/\n.dgrid-selected {\n\tbackground-color: #bfd6eb;\n}\n\n.dgrid-input {\n\twidth: 99%;\n}\n\nhtml.has-mozilla .dgrid .dgrid-row:focus,\nhtml.has-mozilla .dgrid .dgrid-cell:focus {\n\t/* Fix: Firefox's focus outline doesn't work by default for divs prior to actually tabbing into it */\n\toutline: 1px dotted;\n}\n\nhtml.has-mozilla .dgrid-focus {\n\t/* Tighten outline to fit within cells (avoids cutting off top/bottom outlines) */\n\toutline-offset: -1px;\n}\n\n/* will be used to calculate the width of the scrollbar */\n.dgrid-scrollbar-measure {\n\twidth: 100px;\n\theight: 100px;\n\toverflow: scroll;\n\tposition: absolute;\n\ttop: -9999px;\n}\n\n/* Styles for auto-height grids; simply add the dgrid-autoheight class */\n.dgrid-autoheight {\n\theight: auto;\n}\n.dgrid-autoheight .dgrid-scroller {\n\tposition: relative;\n\toverflow-y: hidden;\n}\n.dgrid-autoheight .dgrid-header-scroll {\n\tdisplay: none;\n}\n.dgrid-autoheight .dgrid-header {\n\tright: 0;\n}\n\n/* indicator of a successful load */\n#dgrid-css-dgrid-loaded {\n\tdisplay: none;\n}"}),define("hui/table-column",["register-component/v2/register","register-component/v2/UIComponent","object-utils/classes"],function(a,b,c){function d(a,b){Object.defineProperty(a,b,{set:function(a){this["_"+b]=a,this.emit("column-change")},get:function(){return this["_"+b]}})}return a("ha-table-column",c.createObject(b,{init:function a(){a.super(this),this.setupProperties({field:{type:String,default:""},label:{type:String,default:""},headerText:{type:String,default:""},id:{type:String,default:""},className:{type:String,default:""},sortable:{type:Boolean,default:!1},minWidth:{type:Number,default:40},width:{type:Number,default:null},resizable:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1},unhidable:{type:Boolean,default:!1},"edit-on":{type:String,default:""},editable:{type:Boolean,default:!1}}),d(this,"renderCell"),d(this,"renderPrintCell"),d(this,"renderHeaderCell"),d(this,"formatter")},attributeChangedCallback:function a(b,c,d){a.super(this,b,c,d),this.emit("column-change",{attribute:b,value:d})},getColumnDefinition:function(){var a=this.editable,b=!(this.hasAttribute("sortable")&&"false"===this.getAttribute("sortable"));return{label:this.label,field:this.field,editor:a&&"text",editOn:a&&this["edit-on"],renderCell:this.renderCell,renderHeaderCell:this.renderHeaderCell,renderPrintCell:this.renderPrintCell,formatter:this.formatter,sortable:b}}}))}),define("hui/table",["require","register-component/v2/register","register-component/v2/UIComponent","object-utils/classes","./core/utils","./core/a11y","./core/deviceUtils","./core/event","./helpers/string.helper","./table/TableBase","./table/RowEditingRenderer","./table/RowExpansionRenderer","./table/responsive/StackedRenderer","./table/responsive/ColumnLockingRenderer","./table/responsive/ResponsiveDefaultRenderer","register-component/template!./table/table.html","register-component/template!./table/print.html","register-component/template!dgrid/css/dgrid.css","./table-column","./radio-button","./radio-button-group","./checkbox","./drawer-large","./popover","./popover-form","./tags","./page-message"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t=e.YesNoType,u=["ha-checkbox","ha-radio-button-group","ha-select","ha-select-type-ahead","ha-text-field","ha-text-field-type-ahead"];return s=d.createObject(c,{init:function a(){a.super(this),this._filterNodes=null;var b={renderMode:"",selectionMode:"toggle",allowSelectAll:!0,loadingMessage:'<div class="infinite-loader"></div><span class="sr-only">Loading</span>',noDataMessage:'<p class="ha-table-no-data">No data available</p>',paginationText:"${start}-${end} of ${total}",paginationFirstText:"< First",paginationPreviousText:"Previous",paginationNextText:"Next",paginationLastText:"Last >",paginationAriaLabel:"table pagination",settingsApplyButtonLabel:"Apply",settingsResetButtonLabel:"Reset",settingsTitleText:"Table Settings",showMobileSortOptions:!0,mobileSortingText:"Sort by",mobileSortOrderText:"Sort order",mobileSortAscendingText:"Ascending",mobileSortDescendingText:"Descending",categoryProperty:"",expandAll:!1,allowBatchMode:!1,batchCellAriaLabel:"batch edit",batchSelectAriaLabel:"select this row",batchSelectAllAriaLabel:"Select all rows for editing",batchSelectAllHeaderAriaLabel:"Select rows for editing",allowRowReordering:!1,allowRowDeletion:!1,showHeader:!0,showFooter:!0,print:!1,totalText:"TOTAL",editMode:"",bufferRows:10,farOffRemoval:2e3,maxEmptySpace:1/0,maxRowsPerPage:250,minRowsPerPage:25,pagingDelay:15,pagingMethod:"debounce",queryRowsOverlap:0,deletionIconClass:"hi-delete"},c={};Object.keys(b).forEach(function(a){var d=b[a];c[a]={type:e.type(d),default:d,change:function(b){this._set(a,b)}}}),this.setupProperties(c),this.setupProperties({compact:{default:!1,type:t,change:function(a){this.classList[a?"add":"remove"]("compact"),this._compactCheckbox.checked=this.compact,this._saveSettings()}},rowsPerPage:{default:150,type:Number,change:function(a){this._set("rowsPerPage",a),this._rowsPerPageGroup.value=a,this._saveSettings()}},showTableBar:{type:t,default:!0,change:function(){this._refreshTableBar()}},filterType:{default:"",type:String,change:function(){this._renderFilter(),this._refreshTableBar()}},simpleFindPlaceholderText:{default:"",type:String},showEditMode:{default:!1,type:t,change:function(){this._refreshTableBar()}},editModeCancelText:{default:"Cancel",type:String},editModeSaveText:{default:"Save",type:String},showPrintList:{default:!1,type:t,change:function(){this._refreshTableBar()}},showExport:{default:!1,type:t,change:function(){this._refreshTableBar()}},showSettings:{default:!1,type:t,change:function(){this._refreshTableBar()}},showColumnHider:{default:!0,type:t,change:function(a){this._columnHiderNode&&(a?(this._updateColumnHider(),this._columnHiderNode.classList.remove("hidden")):this._columnHiderNode.classList.add("hidden"))}},showDisplayDensitySettings:{default:!1,type:t,change:function(a){this._displayDensityNode&&(a?this._displayDensityNode.classList.remove("hidden"):this._displayDensityNode.classList.add("hidden"))}},showRowsPerPageSettings:{default:!1,type:t,change:function(a){this._rowsPerPageNode&&(a?this._rowsPerPageNode.classList.remove("hidden"):this._rowsPerPageNode.classList.add("hidden"))}},printListAdditionalCSSFile:{default:"",type:String},printListFontFamily:{default:'"Helvetica Neue", Helvetica, Arial, sans-serif',type:String},printListTitleText:{default:"",type:String},printListSubTitleText:{default:"",type:String},batchItemSelectedText:{default:"{count} item selected",type:String},batchItemsSelectedText:{default:"{count} items selected",type:String},editIconText:{default:"Edit Table",type:String,change:function(a){this._setIconA11yText("edit",a)}},printIconText:{default:"Print Table",type:String,change:function(a){this._setIconA11yText("print",a)}},exportIconText:{default:"Export Table",type:String,change:function(a){this._setIconA11yText("export",a)}},settingsIconText:{default:"View Table Settings",type:String,change:function(a){this._setIconA11yText("settings",a)}},persistentId:{default:"",type:String,change:function(a){this._set("persistentId",a),this._loadSettings()}},userId:{default:"",type:String,change:function(a){this._set("userId",a),this._loadSettings()}},compactText:{default:"Compact",type:String,change:function(a){this._compactCheckbox&&(this._compactCheckbox.label=a)}},editColumnsText:{default:"Edit columns",type:String,change:function(a){this._columnHiderNode&&this._columnHiderNode.firstElementChild&&(this._columnHiderNode.firstElementChild.textContent=a)}},displayDensityText:{default:"Display density",type:String,change:function(a){this._displayDensityNode.firstElementChild.textContent=a}},rowsPerPageText:{default:"Rows per page",type:String,change:function(a){this._rowsPerPageNode&&(this._rowsPerPageNode.firstElementChild.textContent=a)}},autoheight:{type:t,default:!1,change:function(a){this._set("autoheight",a),this._setMaxHeight(a?null:this.maxHeight)}},maxHeight:{default:480,type:Number,change:function(a){this._setMaxHeight(a)}},editable:{default:!1,type:t,change:function(a){this._set("editable",a),this.setEditModeEnabled(a),this._callIfExists("_togglePaginationButtons",!a),a&&this.showAllHiddenColumns()}},lockedColumns:{default:0,type:Number,change:function(a){this._callIfExists("_setLockedColumns",a)}},activeFiltersText:{default:"Filters Active ({{count}})",type:String,change:function(){this._refreshFilterStatus()}},allowRowEditing:{default:!1,type:Boolean,change:function(a){a?this._enableRowEditing():this._disableRowEditing()}},rowEditSaveText:{default:"Save",type:String},rowEditTitle:{default:"",type:String},rowEditCancelText:{default:"Cancel",type:String}}),this.template=p,this._columns=this._getColumns(),this.originalColumns=e.clone(this._columns)},postRender:function(){if(f.addA11yFocus(this),this._toolbarNode=this.querySelector(".tablebar"),this._gridNode=this.querySelector(".grid-node"),this._settingsIconButton=this._toolbarNode.querySelector('button[name="settings"]'),this._editIconButton=this._toolbarNode.querySelector('button[name="edit"]'),this._printIconButton=this._toolbarNode.querySelector('button[name="print"]'),this._exportIconButton=this._toolbarNode.querySelector('button[name="export"]'),this._defaultNode=this.querySelector(".tablebar-default"),g.isMobile())this._settingsPopover=this._toolbarNode.querySelector(".ha-table-settings-popover"),this._settingsPopover&&(this._settingsPopover.parentNode.removeChild(this._settingsPopover),this._settingsPopover=null),this._settingsDrawer=this._renderSettingsDrawer();else{this._settingsPopover=this._toolbarNode.querySelector(".ha-table-settings-popover"),this._columnHiderNode=this._settingsPopover.querySelector(".column-hider"),this._displayDensityNode=this._settingsPopover.querySelector(".display-density");var a=document.createElement("ha-checkbox");a.name="compactCheckbox",a.label=this.compactText,this._displayDensityNode.appendChild(a),this._compactCheckbox=this._displayDensityNode.querySelector("ha-checkbox[name=compactCheckbox]"),this._rowsPerPageNode=this._settingsPopover.querySelector(".rows-per-page"),this._rowsPerPageGroup=this._rowsPerPageNode.querySelector("ha-radio-button-group[name=rowsPerPage]"),this.otherSettingsNode=this._settingsPopover.querySelector(".custom"),h.on(this._settingsPopover,".edit-columns ha-checkbox:change",this._onChangeEditColumn.bind(this)),h.on(this._settingsPopover,".display-density ha-checkbox:change",this._onChangeDisplayDensity.bind(this)),h.on(this._settingsPopover,".rows-per-page ha-radio-button-group:change",this._onChangeRowsPerPage.bind(this))}this.listenTo(this._defaultNode,"button:click",function(a){var b=a.target.name,c=this["_onClick"+b.charAt(0).toUpperCase()+b.slice(1)];c&&c.call(this,a)}.bind(this)),this.table=this._createGrid();var b=function(){setTimeout(this._calculateInitialHeight.bind(this),500)}.bind(this);this.on("table-resize",b),this._batchNode=this.querySelector(".batch-node"),this._batchBarNode=this.querySelector(".tablebar-batch"),this._batchCountNode=this.querySelector(".batch-count"),this._editNode=this.querySelector(".tablebar-edit"),this._filterNode=this.querySelector(".filter-node"),this.tableBarCustomNode=this.querySelector(".custom-node"),this.tableBarCustomActionNode=this.querySelector(".custom-action-node"),this._batchModeEnabled=!1,this.on("ha-table-column:column-change",function(){this.columns=this._getColumns()}.bind(this)),this.on("batch-select",function(){this._checkBatchMode(!0)}.bind(this)),this.on("batch-deselect",function(a){this._checkBatchMode(),this.clearErrors(a.rows.map(function(a){return a.id}))}.bind(this)),this._calculateInitialHeight(),this.on("row-remove",this._adjustHeight.bind(this,!1)),this.on("row-insert",this._adjustHeight.bind(this,!0)),this.on("refresh-complete",function(){this._refreshTableBar(),this.table.gotoPage?this.table.resetParentStyles():this._calculateInitialHeight()}.bind(this)),this.listenTo(this.querySelector(".edit-cancel"),"click",this.onEditCancel.bind(this)),this.listenTo(this.querySelector(".edit-save"),"click",this.onEditSave.bind(this)),this._loadSettings(),this._addRenderModes(),this._rowExpansion=!0,this._rowExpansionRenderer=null},detachedCallback:function(){var a=this._settingsPopover||this._settingsDrawer;a.parentElement&&a.parentElement.removeChild(a)},_setMaxHeight:function(a){var b=this._get("domNode");a&&(a+="px"),b&&(b.style.maxHeight=a)},_calculateInitialHeight:function(a){if(!this._get("_isProcessingScroll")||!a||"table-resize"!==a.type){var b=this._get("domNode"),c=0;b&&(this.table.headerNode&&(c+=this.table.headerNode.offsetHeight),this.table.footerNode&&(c+=this.table.footerNode.offsetHeight),Array.prototype.forEach.call(this.querySelectorAll(".dgrid-row"),function(a){c+=a.offsetHeight}),this._lastNoDataHeight=this.table.noDataNode?this.table.noDataNode.offsetHeight:null,this._lastNoDataHeight&&(c+=this._lastNoDataHeight+35),c=Math.max(124,c),b.style.height=c+"px"),this.table.resetParentStyles()}},_adjustHeight:function(a,b){if(!this._get("_cleanup")&&!this._get("_isProcessingScroll")){var c=this._get("domNode"),d=c.style.height,e=b.height,f=Number(d.substring(0,d.length-2)),g=a?f+e:f-e;a?this._lastNoDataHeight&&(g-=this._lastNoDataHeight,this._lastNoDataHeight=null):this.table.noDataNode&&(this._lastNoDataHeight=this.table.noDataNode.offsetHeight,g+=this._lastNoDataHeight),isNaN(g)||(c.style.height=g+"px")}},set query(a){this._query=a,this._set("collection",a?this._collection.filter(a):this._collection),this.refresh()},get query(){return this._query},_checkBatchMode:function(a){var b=Object.keys(this.table.selection).reduce(function(a,b){return a+(this.table.selection[b]?1:0)}.bind(this),0),c=(1===b?this.batchItemSelectedText:this.batchItemsSelectedText).replace(/\{count\}/,b);this._batchCountNode.textContent=c,a&&!this._batchModeEnabled?this.setBatchModeActive(!0):!b&&this._batchModeEnabled&&this.setBatchModeActive(!1),this._batchModeEnabled=!!b},attachedCallback:function(){this.table&&!this.table._started&&this._callIfExists("startup")},_createGrid:function(){return j.factory({table:this,virtual:!1,columns:this._columns},this._gridNode)},_setIconA11yText:function(a,b){var c=this.querySelector(".hi-"+a+" + .icon-text");c&&(c.textContent=b)},_set:function(a,b){return this._callIfExists("set",a,b)},_get:function(a){return this._callIfExists("get",a)},_callIfExists:function(a){var b=Array.prototype.slice.call(arguments,1);return this.table&&this.table[a]&&this.table[a].apply(this.table,b)},_getColumns:function(){var a=Array.prototype.map.call(this.querySelectorAll("ha-table-column"),function(a){return a.getColumnDefinition()});return a.length?a:this.columns},addRenderMode:function(){this.table.addRenderMode.apply(this.table,arguments)},removeRenderMode:function(a){this._callIfExists("removeRenderMode",a)},set columns(a){this.renderMode&&this.rendererFactory&&this.rendererFactory(this.renderMode,"cleanup",this.table)(this.table),this._columns=a,this.originalColumns=e.clone(a,this.table?[this.table]:[]),this._set("columns",a),this._updateColumnHider(),this.updateFactorySettings(),this.renderMode&&this.rendererFactory&&this.rendererFactory(this.renderMode,"setup",this.table)(this.table)},get columns(){return this._get("columns")||this._columns},set sort(a){this._set("sort",a)},get sort(){return this._get("sort")},get renderModes(){return this._get("renderModes")},set editableFields(a){this._set("editableFields",a)},get editableFields(){return this._get("editableFields")},set exportButton(a){this._exportIconButton.parentNode.replaceChild(a,this._exportIconButton),this._exportIconButton=a},get exportButton(){return this._editIconButton},get hasToolbarContent(){return Boolean(this.filterType||this.showEditMode||this.allowBatchMode||this.showPrintList||this.showExport||this.showSettings||this.otherSettingsNode)},_shouldShowToolbar:function(){return this.showTableBar&&!!(this.filterType||this.showEditMode||this.allowBatchMode||this.showPrintList||this.showExport||this.showSettings)},set rowStatus(a){this._set("rowStatus",a)},get rowStatus(){return this._get("rowStatus")},set collection(a){this._collection=a,this._set("collection",a)},get collection(){return this._get("collection")},_onClickFilter:function(){this.filterNodes[0].show({detail:this.query})},_renderFilter:function(){var a,b,c,d,e,f,h,i,j=this.ownerDocument,k=this._filterNode,l=this.filterNodes;k.innerHTML="",k.classList.remove("mobile-filter-bar"),this._tags=null,"complex"===this.filterType?(a=j.createElement("button"),b=j.createElement("span"),c=j.createElement("span"),b.classList.add("hi"),b.classList.add("hi-filter"),b.setAttribute("aria-hidden",!0),c.classList.add("sr-only"),c.textContent="Filter",a.name="filter",a.appendChild(b),a.appendChild(c),k.appendChild(a),g.isHandheld()?(d=this._filterStatus=j.createElement("button"),d.classList.add("filter-status"),d.style.display="none",d.addEventListener("click",this._onClickFilter.bind(this))):(d=this._tags=j.createElement("ha-tags"),d.maxDisplay=3),k.appendChild(d),l.length>0&&(g.isHandheld()&&"HA-POPOVER"===l[0].tagName?(l[0]=this._buildDrawerFromPopover(l[0]),l[0].on("close",function(){a.focus()})):l[0].target=a)):"simple"===this.filterType&&g.isHandheld()&&l[0]&&"HA-TEXT-FIELD"===l[0].tagName?(e=l[0],f=j.createElement("div"),f.className="mobile-table-filter table-bar tablebar-default",h=j.createElement("button"),h.textContent="Cancel",h.addEventListener("click",function(){f.parentNode.insertBefore(i,f),f.classList.remove("visible"),this._defaultNode=i,setTimeout(function(){f.parentNode.removeChild(f),e.value="",e.emit("change")},300)}.bind(this)),a=j.createElement("button"),b=j.createElement("span"),b.classList.add("hi"),b.classList.add("hi-search"),a.appendChild(b),a.setAttribute("aria-label","Filter"),f.appendChild(e),f.appendChild(h),a.addEventListener("click",function(){i=k.parentElement,i.parentElement.appendChild(f),this._defaultNode=f,setTimeout(function(){f.classList.add("visible"),setTimeout(function(){i.parentElement.removeChild(i),e.focus()},300)},0)}.bind(this)),e.on("input",function(){e.emit("change")}),k.classList.add("mobile-filter-bar"),k.appendChild(a),l=[],e.classList.add("mobile-text-field-force-open")):"simple"===this.filterType&&g.isHandheld()&&k.classList.add("mobile-filter-bar"),l.forEach(function(a){k.appendChild(a)})},filter:function(a,b){a=a||{};var c=this._tags,d=this._filterStatus;this.query=a,c?c.tags=Object.keys(a).map(function(c){var d=document.createElement("ha-tag");return d.label=b?b[c]||a[c]:a[c],d.value=c,d}):d&&this._refreshFilterStatus()},_refreshFilterStatus:function(){var a=Object.keys(this.query||{}).length,b=this._filterStatus;b&&(a?(b.style.display="inline-block",b.textContent=i.replaceKeys(this.activeFiltersText,{count:a})):b.style.display="none")},set filterNodes(a){if(this.filterType||(this.filterType="simple"),a.length&&"complex"===this.filterType){if(a.length>1)throw new Error('filterNodes: the array can only be of length 1 when the filterType is "complex"');if("ha-popover"!==a[0].tagName.toLowerCase())throw new Error('filterNodes: This property only accepts ha-popover elements when the filterType is "complex"')}else a.forEach(function(a){var b=a.nodeName.toLowerCase();if("ha-select"!==b&&"ha-text-field"!==b)throw new Error('filterNodes: This property only accepts ha-select and ha-text-field elements when the filterType is "simple"')});this._filterNodes=a,this._renderFilter()},get filterNodes(){var a=this._filterNodes;return a||(a=this._filterNodes=[]),a},get selection(){return this._get("selection")},set store(a){this._set("collection",a)},get store(){return this._get("collection")},set footerTotalNode(a){this._set("footerTotalNode",a)},get footerTotalNode(){return this._get("footerTotalNode")},set batchNodes(a){var b=this._batchNode;b.innerHTML="",a.forEach(function(a){b.appendChild(a)})},get batchNodes(){return Array.prototype.slice.call(this._batchNode.childNodes)},get batchField(){return this._get("batchField")},get rowReorderField(){return this._get("rowReorderField")},set rendererFactory(a){this._set("rendererFactory",a),this._addRenderModes()},get rendererFactory(){return this._get("rendererFactory")},set totals(a){this._set("totals",a)},get totals(){return this._get("totals")},set categoryTotals(a){this._set("categoryTotals",a)},get categoryTotals(){return this._get("categoryTotals")},set responsiveLayout(a){this._responsiveLayout=a,g.isHandheld()&&(this.cancelRowEdit(),this.renderMode=this._responsiveLayout?a+"Renderer":"default",this._prepareRowEditor())},get responsiveLayout(){return this._responsiveLayout},cell:function(a){return this._callIfExists("cell",a)},row:function(a){return this._callIfExists("row",a)},gotoPage:function(a){return this._callIfExists("gotoPage",a)},get _total(){return this._get("_total")},setError:function(a,b){return this._callIfExists("setError",a,b)},clearError:function(a){return this._callIfExists("clearError",a)},setErrors:function(a){return this._callIfExists("setErrors",a)},clearErrors:function(a){return this._callIfExists("clearErrors",a)},reRenderRow:function(a,b){return this._callIfExists("reRenderRow",a,b)},clearSelection:function(){this._callIfExists("clearSelection")},deselect:function(a,b){this._callIfExists("deselect",a,b)},select:function(a,b){this.allowBatchMode&&this._callIfExists("select",a,b)},selectAll:function(){this.allowBatchMode&&this._callIfExists("selectAll")},refresh:function(){this._callIfExists("refresh"),this._refreshTableBar()},resize:function(){return this._callIfExists("resize")},resizeColumnWidth:function(a,b){return this._callIfExists("resizeColumnWidth",a,b)},_refreshTableBar:function(){var a=this.editMode&&"specific"===this.editMode;this.showTableBar&&this.hasToolbarContent?(this._toolbarNode.classList.remove("hidden"),this.showSettings?(this._settingsIconButton.classList.remove("hidden"),this._updateColumnHider(),this._loadSettings()):this._settingsIconButton.classList.add("hidden"),this.showExport&&this._total?this._exportIconButton.classList.remove("hidden"):this._exportIconButton.classList.add("hidden"),this.showEditMode&&this._total?a?this._changeSpecificEdit():this._editIconButton.classList.remove("hidden"):a?this._changeSpecificEdit(!0):this._editIconButton.classList.add("hidden"),this.showPrintList&&this._total?this._printIconButton.classList.remove("hidden"):this._printIconButton.classList.add("hidden")):this._toolbarNode.classList.add("hidden")},_loadSettings:function(){if(this.showSettings){var a,b,c=this._rowsPerPageGroup;if(this._loadingSettings=!0,c&&(c.value=this.rowsPerPage),this.userId&&this.persistentId&&window.localStorage){if(a="table-"+this.userId+this.persistentId+"-settings",!(b=JSON.parse(window.localStorage.getItem(a))))return void(this._loadingSettings=!1);b.compact&&(this.compact=!0,this._compactCheckbox.checked=!0),b.rowsPerPage&&(this.rowsPerPage=b.rowsPerPage),b.columns&&(Object.keys(this.table.columns).forEach(function(a){var c=this.table.columns[a];b.columns[c.field]&&(b.columns[c.field].hidden&&(c.hidden=!0,this.table._updateColumnHiddenState(c.id,!0)),b.columns[c.field].unhidable&&(c.unhidable=!0))},this),this._updateColumnHider())}this._loadingSettings=!1}},_saveSettings:function(){if(!this._loadingSettings&&window.localStorage&&this.userId&&this.persistentId){var a="table-"+this.userId+this.persistentId+"-settings",b=this._get("columns"),c={compact:this.compact,rowsPerPage:this.rowsPerPage,columns:{}};Object.keys(b).forEach(function(a){var d=b[a];d.hidden&&(c.columns[d.field]={hidden:!0}),d.unhidable&&(c.columns[d.field]||(c.columns[d.field]={}),c.columns[d.field].unhidable=!0)},this),window.localStorage.setItem(a,JSON.stringify(c))}},getAvailableEditableFields:function(){return this._callIfExists("getAvailableEditableFields")},get dirty(){return this._get("dirty")},get fields(){var a=this.columns;return Array.isArray(a)?a.map(function(a){return a.field}):Object.keys(a)},showAllHiddenColumns:function(){var a=this.columns;(Array.isArray(a)?a.map(function(a){return a.field}):Object.keys(a)).forEach(function(a,b){this._callIfExists("toggleColumnHiddenState",""+b,!1)}.bind(this))},_changeSpecificEdit:function(a){function b(a){var b=a.target.selectedItem.value;c.editableFields=[b],c.editable=!0}var c=this;if(a)return void(this.editMenu&&(this._toolbarNode.removeChild(this.editMenu),this.editMenu.removeEventListener(b)));this.editMenu||(this.editMenu=document.createElement("ha-menu-button"),this.editMenu.label="Edit Specific Field",this.editMenu.classList.add("specific-edit"),this.editMenu.icon="hi-edit",this.editMenu.items=this.getAvailableEditableFields().map(function(a){var b=document.createElement("ha-item"),d=c.columns[a].label;return b.label=d,b.value=a,b}),this.editMenu.addEventListener("select",b),this._editIconButton.parentNode.insertBefore(this.editMenu,this._editIconButton))},_onClickEdit:function(a){a.editableFields="custom"===this.editMode?this.editableFields:this.getAvailableEditableFields(),this.onClickEdit(a)},onClickEdit:function(a){this.editable=!0},onEditCancel:function(){this.emit("edit-cancel"),this.revert(),this.editable=!1},onEditSave:function(){this.emit("edit-save",{changed:this.dirty})},save:function(){this._callIfExists("save")},revert:function(){this._callIfExists("revert")},setEditModeEnabled:function(a){this._defaultNode.classList[a?"add":"remove"]("animate-hidden"),this._defaultNode[a?"setAttribute":"removeAttribute"]("aria-hidden",!0),this._editNode.classList[a?"remove":"add"]("animate-hidden"),this._editNode[a?"removeAttribute":"setAttribute"]("aria-hidden",!0)},updateFactorySettings:function(){this.rendererFactory&&this.rendererFactory.resetConfig(this.table)},_addRenderModes:function(){if(this._rowEditingRenderer=new k,this.addRenderMode("rowEdit",this._rowEditingRenderer),this._rowExpansionTableRenderer=new l({renderRowExpansionContent:function(a){var b=this.row(a);return this._lastEditRow===b.id?this._rowExpansionRenderer?(this._cachedRowExpansion||(this._cachedRowExpansion=this._rowExpansionRenderer(b.id,function(){this.cancelRowEdit()}.bind(this))),this._cachedRowExpansion):this._createMobileRowExpansion():this.ownerDocument.createElement("div")}.bind(this),manualActivation:!0,expansionClassName:"row-edit-expansion",useFocusIndicator:!0,scrollingThreshold:1,autoResizeTable:!0,focusIndicatorLabel:this.rowEditCancelText}),this.addRenderMode("rowEditExpansion",this._rowExpansionTableRenderer),this.addRenderMode("stackedRenderer",new m,this._rowExpansionTableRenderer),this.addRenderMode("columnLockingRenderer",new n,this._rowExpansionTableRenderer),g.isHandheld()&&this.addRenderMode("default",new o,this._rowExpansionTableRenderer),this.renderMode){var a=this.renderMode;this.renderMode="",this.renderMode=a}else this.renderMode="default"},_onClickSettings:function(){var a=this._settingsPopover||this._settingsDrawer;a.classList.contains("visible")?a.close():(g.isMobile()&&(this._buildMobileSortOptions(),this._storeDefaultSettings(),this._backupSettings()),a.show())},_getFormElements:function(a){return a.querySelectorAll(u.join(","))},_getSettings:function(){var a=this._settingsDrawer||this._settingsPopover,b={};return Array.prototype.forEach.call(this._getFormElements(a),function(a){var c=a.name||a.label;c&&(b[c]="checked"in a?a.checked:a.value)}),b},_storeDefaultSettings:function(){this._defaultSettings||(this._defaultSettings=this._getSettings())},_backupSettings:function(){this._backedupSettings=this._getSettings()},_onChangeDisplayDensity:function(a){this.compact=a.target.checked,this.table.resize()},_onChangeEditColumn:function(a){this.table._updateColumnHiddenState(a.target.value,!a.target.checked),this._saveSettings()},_onChangeRowsPerPage:function(a){this.rowsPerPage=parseInt(a.target.value,10),this._saveSettings()},_onClickPrint:function(){var a=window.open();this._renderPrintPage(a)},_renderPrintPage:function(b){var c,d=b.document,f={currentPath:window.location.href.substr(0,window.location.href.lastIndexOf("/")),customCss:this.printListAdditionalCSSFile,dgridCss:r,printListTitleText:this.printListTitleText,printListSubTitleText:this.printListSubTitleText,printListFontFamily:this.printListFontFamily};f.customCss&&("http"!==f.customCss.substr(0,4).toLowerCase()&&(f.customCss=f.currentPath+"/"+a.toUrl(f.customCss)),f.customCss='<link rel="stylesheet" href="'+f.customCss+'">'),a(["./table-virtual"],function(){var a=document.createElement("div");a.style.position="absolute",a.style.left="-5000px",a.style.top="-5000px",a.style.display="inline-block",a.style.width="2000px",a.style.height="20000px",c=this.ownerDocument.createElement("ha-table-virtual"),c.print=!0,c.allowBatchMode=!1,c.compact=this.compact,c.showTableBar=!1,c.columns=e.clone(this.originalColumns,[this]),c.collection=this.collection,this.printRenderer&&(c.addRenderMode("print",this.printRenderer),c.renderMode="print"),this.ownerDocument.body.appendChild(a),a.appendChild(c),c.table.minRowsPerPage=1/0,c.autoheight=!0,c.sort=this.sort,this.table._columnHiderRules&&Object.keys(this.table._columnHiderRules).forEach(function(a){c.table._updateColumnHiddenState(a,!0)}),c.on("refresh-complete",function(){c&&(c.table.bodyNode.style.marginTop="",f.gridContent=c.table.domNode.innerHTML,d.open(),d.write(q(f)),d.close(),c.ownerDocument.body.removeChild(a),c=null)})}.bind(this))},_renderSettingsDrawer:function(){var a,b,c=this.ownerDocument.createElement("ha-drawer-large"),d=this.ownerDocument.createElement("div"),e=this.ownerDocument.createElement("button"),f=this.ownerDocument.createElement("button");return c.classList.add("table-settings"),c.backdrop=!0,c.titleText=this.settingsTitleText,c.footer=this.ownerDocument.createElement("div"),c.footer[0].style.position="relative",e.className="ha-button ha-button-primary",e.textContent=this.settingsApplyButtonLabel,c.footer[0].appendChild(e),f.className="ha-button ha-button-secondary",f.textContent=this.settingsResetButtonLabel,c.footer[0].appendChild(f),this._sortNode=this.ownerDocument.createElement("div"),this._sortNode.classList.add("mobile-sort-options"),this._sortNode.appendChild(this.ownerDocument.createElement("h4")),this._sortNode.lastChild.textContent=this.mobileSortingText,this._sortOptionsNode=this.ownerDocument.createElement("div"),this._sortNode.appendChild(this._sortOptionsNode),this._sortNode.appendChild(this.ownerDocument.createElement("div")),this._sortNode.lastChild.textContent=".",this._sortNode.lastChild.classList.add("clearfix"),d.appendChild(this._sortNode),this._columnHiderNode=this.ownerDocument.createElement("div"),this._columnHiderNode.classList.add("column-hider"),a=this.ownerDocument.createElement("h4"),a.textContent=this.editColumnsText,b=this.ownerDocument.createElement("div"),b.className="edit-columns",this._columnHiderNode.appendChild(a),this._columnHiderNode.appendChild(b),d.appendChild(this._columnHiderNode),this._displayDensityNode=this.ownerDocument.createElement("div"),this._displayDensityNode.classList.add("display-density"),this._displayDensityNode.appendChild(this.ownerDocument.createElement("h4")),this._displayDensityNode.lastChild.textContent=this.displayDensityText,this._compactCheckbox=this.ownerDocument.createElement("ha-checkbox"),this._compactCheckbox.name="compactCheckbox",this._compactCheckbox.label=this.compactText,this._displayDensityNode.appendChild(this._compactCheckbox),d.appendChild(this._displayDensityNode),this.otherSettingsNode=this.ownerDocument.createElement("div"),this.otherSettingsNode.className="custom",d.appendChild(this.otherSettingsNode),this._rowsPerPageNode=this.ownerDocument.createElement("div"),this._rowsPerPageNode.classList.add("rows-per-page"),this._rowsPerPageNode.appendChild(this.ownerDocument.createElement("h4")),this._rowsPerPageNode.lastChild.textContent=this.rowsPerPageText,this._rowsPerPageGroup=this.ownerDocument.createElement("ha-radio-button-group"),this._rowsPerPageGroup.name="rowsPerPage",this._rowsPerPageGroup.radios=["50","150","300"].map(function(a){var b=this.ownerDocument.createElement("ha-radio-button");return b.label=a,b.value=a,b}.bind(this)),this._rowsPerPageNode.appendChild(this._rowsPerPageGroup),this._shouldShowPaginationSettings()&&d.appendChild(this._rowsPerPageNode),this.listenTo(e,"click",function(){this._applySettings(),this._settingsDrawer.close()}.bind(this)),this.listenTo(f,"click",function(){this._resetSettings()}.bind(this)),c.section=d,c},_applySettings:function(){Array.prototype.forEach.call(this._columnHiderNode.querySelectorAll("ha-checkbox"),function(a){var b=a.name||a.label;a.checked!==this._backedupSettings[b]&&this._onChangeEditColumn({target:a})}.bind(this)),this._compactCheckbox.checked!==this._backedupSettings[this._compactCheckbox.name]&&this._onChangeDisplayDensity({target:this._compactCheckbox}),this._shouldShowPaginationSettings()&&this._rowsPerPageGroup.value!==this._backedupSettings[this._rowsPerPageGroup.name]&&this._onChangeRowsPerPage({target:this._rowsPerPageGroup});var a,b;Array.prototype.forEach.call(this._sortNode.querySelectorAll("ha-radio-button"),function(c){"sort"===c.name&&c.checked?a=c.value:"sortDir"===c.name&&c.checked&&(b="desc"===c.value)}),void 0!==a?this.table.set("sort",[{property:a,descending:void 0!==b&&b}]):this.table.set("sort",[])},_resetSettings:function(){var a,b;for(a in this._defaultSettings)b=this._settingsDrawer.querySelector('[name="'+a+'"]'),b||(b=this._settingsDrawer.querySelector('[label="'+a+'"]')),b&&("checked"in b?b.checked=this._defaultSettings[a]:"HA-RADIO-BUTTON-GROUP"!==b.tagName||this._defaultSettings[a]?b.value=this._defaultSettings[a]:Array.prototype.forEach.call(b.querySelectorAll("ha-radio-button"),function(a){a.checked=!1}))},_shouldShowPaginationSettings:function(){return!0},_onClickExport:function(a){a.table=this,this.emit("export",a)},setBatchModeActive:function(a){a?(this._defaultNode.classList.add("animate-hidden"),this._defaultNode.setAttribute("aria-hidden",!0),this._batchBarNode.classList.remove("animate-hidden"),this._batchBarNode.removeAttribute("aria-hidden")):(this._defaultNode.removeAttribute("aria-hidden"),this._defaultNode.classList.remove("animate-hidden"),this._batchBarNode.setAttribute("aria-hidden",!0),this._batchBarNode.classList.add("animate-hidden")),this._set("batchModeActive",a)},_updateColumnHider:function(){if(this.showSettings&&this.showColumnHider){var a,b=this._columnHiderNode.querySelector(".edit-columns"),c=Object.keys(this.table.columns),d=g.isMobile()?1:Math.ceil(c.length/10),e=!1;b.innerHTML="","WebkitColumnCount"in this.ownerDocument.documentElement.style?b.style.WebkitColumnCount=d:"MozColumnCount"in this.ownerDocument.documentElement.style&&(b.style.MozColumnCount=d),b.style.columnCount=d,c.forEach(function(c){var d=this.table.columns[c];d.unhidable||(d.hidden&&this.table._hideColumn(d.id),e=!0,a=this.ownerDocument.createElement("ha-checkbox"),a.label=d.label,a.value=d.id,a.name="hide-"+d.id,a.checked=!("hidden"in d)||!d.hidden,b.appendChild(a))},this),e?this._columnHiderNode.classList.remove("hidden"):this._columnHiderNode.classList.add("hidden")}},_buildDrawerFromPopover:function(a){function b(a,b){b&&("length"in b?Array.prototype.slice.call(b).forEach(function(b){a.appendChild(b)}):a.appendChild(b))}if(a._convertedDrawer)return a._convertedDrawer;var c,d=this.ownerDocument.createElement("ha-drawer-large"),e=this.ownerDocument.createElement("section"),f=this.ownerDocument.createElement("footer"),g=a.querySelector("ha-popover-form");return g?(b(e,g.section),b(f,g.footer)):b(e,a.children),[".ha-button-primary",".ha-button-secondary"].forEach(function(b){null===f.querySelector(b)&&[a,e].forEach(function(a){(c=a.querySelector(b))&&(f.appendChild(c),c.addEventListener("click",function(){d.close()}))})}),d.backdrop=!0,d.classList.add("two-button"),d.titleText="Filters",e&&(d.section=e),f&&(d.footer=f),a._convertedDrawer=d,d},_shouldEditRow:function(a){var b=!0;return a&&a.target&&("HA-CHECKBOX"!==a.target.tagName&&"HA-RADIO-BUTTON"!==a.target.tagName&&"INPUT"!==a.target.tagName&&"BUTTON"!==a.target.tagName&&"A"!==a.target.tagName||(b=!1)),b},set rowExpansion(a){this.allowRowEditing&&this.cancelRowEdit(),this._rowExpansion=a,this.allowRowEditing&&this._prepareRowEditor()},get rowExpansion(){return this._rowExpansion},set rowExpansionRenderer(a){this.allowRowEditing&&this.cancelRowEdit(),this._rowExpansionRenderer=a},get rowExpansionRenderer(){return this._rowExpansionRenderer},_enableRowEditing:function(){this._callIfExists("_togglePaginationButtons",!1),this._lastEditRow=null,this._rowFocusEventHandle=function(a){if(this._shouldEditRow(a)){var b=this.cell(a),c=b?b.row:null;c&&b&&null===this._lastEditRow&&(a.stopPropagation(),a.preventDefault(),this._lastEditRow=c.id,this._showRowEditor(c.id))}}.bind(this),this._rowEditOldSelectionMode=this.selectionMode,this.selectionMode="none",this.on("click",this._rowFocusEventHandle),this._prepareRowEditor(),this._storeUpdateHandle=this.table.collection.on("add, delete",function(){this.cancelRowEdit()}.bind(this))},_disableRowEditing:function(){this._callIfExists("_togglePaginationButtons",!0),this.cancelRowEdit(),this.selectionMode=this._rowEditOldSelectionMode,this._rowFocusEventHandle&&(this.off("click",this._rowFocusEventHandle),this._rowFocusEventHandle=null),this._storeUpdateHandle&&(this._storeUpdateHandle.remove(),this._storeUpdateHandle=null)},rowEditValidator:function(a){a()},rowEditSaveHandler:function(){var a={},b=!0,c=Object.create(this._rowEditData);if(Object.keys(this._rowEditFields).forEach(function(d){var e=this._rowEditFields[d];if(e.getValue){"checkValidity"in e.editor&&(e.editor.checkValidity()||(b=!1));var f=e.getValue();f!==e.originalValue&&(a[d]=f,c[d]=f)}}.bind(this)),b)if(Object.keys(a).length>0){var d={};d[this._lastEditRow]=a,this.rowEditValidator(function(){null!==this._lastEditRow&&this.table.collection.get(this._lastEditRow).then(function(b){void 0===b?(this.table.collection.add(c),this.refresh()):(Object.keys(a).forEach(function(b){this.table.updateDirty(this._lastEditRow,b,a[b])}.bind(this)),this.save()),this._rowEditDeleteOnCancel=!1,this.cancelRowEdit()}.bind(this))}.bind(this),d,this)}else this.rowEditCancelHandler()},rowEditCancelHandler:function(){this.cancelRowEdit()},cancelRowEdit:function(){if(null!==this._lastEditRow){this._cachedRowExpansion=null;var a=this._lastEditRow;this._lastEditRow=null,this._rowEditFields=null,this._hideRowEditor(a),this._rowEditDeleteOnCancel&&this.table.collection.remove(a)}},rowEditChangeHandler:function(a){this.emit("row-edit-update",{editors:a})},_showRowEditor:function(a,b){var c=this.row(a);if(c&&!b&&(b=c.data),this._rowEditData=b,this._rowEditFields=this._createFieldEditors(b),this._rowEditDeleteOnCancel=!1,g.isDesktop())this._rowEditingRenderer.setEditableRow(this,a,this._rowEditFields);else if(g.isHandheld())if(this._rowExpansion){this.reRenderRow(a);var d=this.row(a).element;this._rowExpansionTableRenderer._toggleRowExpansion(d,!1,d),f.setFocusOnAnyFirst(d.querySelector(".ha-table-row-expansion")),this._rowExpansionBlurEventHandle=function(b){for(var c=this.row(a).element,d=c.querySelector("table"),e=b.target,f=!1,g=!1,h=!1;e&&e!==document;)e===c?h=!0:e===d?f=!0:e.classList.contains("dgrid-row")&&(g=!0),e=e.parentNode;f?setTimeout(function(){this.rowEditCancelHandler()}.bind(this),0):g&&!h&&this.rowEditCancelHandler()}.bind(this),document.body.addEventListener("mouseup",this._rowExpansionBlurEventHandle)}else this.emit("row-edit",{row:a}),this.cancelRowEdit()},_prepareRowEditor:function(){g.isDesktop()&&(this.renderMode="rowEdit")},_hideRowEditor:function(a){if(this.allowRowEditing)if(g.isDesktop())this._rowEditingRenderer.setEditableRow(this,null,null);else if(g.isHandheld()&&this._rowExpansion){var b=this.row(a).element;this._rowExpansionTableRenderer._toggleRowExpansion(b,!0,b),this._rowExpansionBlurEventHandle&&(document.body.removeEventListener("mouseup",this._rowExpansionBlurEventHandle),this._rowExpansionBlurEventHandle=null)}},_putEditorsIntoRows:function(a){var b=[];Object.keys(a).forEach(function(c){var d=a[c];b.push(d)}.bind(this));for(var c=[];b.length;){for(var d=[b.shift()],e=d[0].column.drawerWeight||1;b.length&&e+(b[0].column.drawerWeight||1)<=1;){var f=b.shift();d.push(f),e+=f.column.drawerWeight||1}c.push(d)}return c},_createMobileEditor:function(a){var b=this.ownerDocument.createElement("div");if(b.style.width=Math.round(100*(a.column.drawerWeight||1))+"%",a.editor)a.editor.label=a.column.label,b.appendChild(a.editor);else{var c=this.ownerDocument.createElement("ha-text-field");c.label=a.column.label,c.disabled=!0,c.value=a.displayValue,b.appendChild(c)}return b},_createMobileRowExpansion:function(){var a=this.ownerDocument.createElement("div"),b=this.ownerDocument.createElement("section"),c=this.ownerDocument.createElement("footer"),d=this._rowEditFields,e=this.ownerDocument.createElement("header");if(this.rowEditTitle){var f=this.ownerDocument.createElement("h4");f.textContent=this.rowEditTitle,e.appendChild(f)}b.appendChild(e),this._putEditorsIntoRows(d).forEach(function(a){var c=document.createElement("div");c.className="row",a.forEach(function(a){c.appendChild(this._createMobileEditor(a))}.bind(this)),b.appendChild(c)}.bind(this));var g=this.ownerDocument.createElement("button");return g.className="ha-button ha-button-primary",g.textContent=this.rowEditSaveText,g.addEventListener("click",function(){this.rowEditSaveHandler()}.bind(this)),c.appendChild(g),a.appendChild(b),a.appendChild(c),a},_createFieldEditors:function(a){function b(a,b){var c="value";return a&&a.editorArgs&&a.editorArgs.value&&(c=a.editorArgs.value),function(a){b[c]=a}}function c(a,b){var c="value";return a&&a.editorArgs&&a.editorArgs.value&&(c=a.editorArgs.value),function(){return b[c]}}function d(){var a={};Object.keys(e).forEach(function(b){e[b].editor&&(a[b]=e[b].editor)}),this.rowEditChangeHandler(a)}var e={},f=this.columns;return Object.keys(f).forEach(function(g){var h=f[g],i={};if(!h.hidden){if(i.column=h,i.value=a[h.field],h.formatter){var j=h.formatter,k=this.table.formatterScope;i.displayValue="string"==typeof j&&k?k[j](i.value,a):j(i.value,a)}else i.displayValue=i.value;if(h.editor){var l=document.createElement(h.editor);i.editor=l,h.editorInit&&h.editorInit(l,i.value,h),i.setValue=b(h,l),i.setValue(i.value),i.getValue=c(h,l),i.originalValue=i.getValue(),l.addEventListener("change",d.bind(this))}e[g]=i}}.bind(this)),e},addAndEditRow:function(){if(this.allowRowEditing){var a;this._lastEditRow&&this.cancelRowEdit(),g.isDesktop()?(a=this.addEmptyRows(1),this._lastEditRow=a,this._showRowEditor(a)):g.isHandheld()&&(a=this.addEmptyRows(1),this._lastEditRow=a,this._showRowEditor(a),this._rowExpansionRenderer||(this._rowEditDeleteOnCancel=!0))}else this.addEmptyRows(1)},_createEmptyRow:function(){var a={};Object.keys(this.columns).forEach(function(b){"id"!==b&&(a[b]="")}.bind(this));var b=0;return this.table.collection.data.forEach(function(a){a.id&&(b=Math.max(a.id,b))}.bind(this)),a.id=b+1,a},addEmptyRows:function(a){a=Math.max(0,a||1);for(var b=null;a--;){var c=this._createEmptyRow();b=c.id,this.table.collection.add(c)}return this.refresh(),b},_getSortOptions:function(){var a,b=this.table?this.table.get("_columns"):[],c=[],d=this.table?this.table.get("sort")[0]:void 0,e=!1;return b.forEach(function(b){if(!1!==b.sortable){var f={column:b,field:b.field,label:b.label||b.field};void 0!==d&&d.property===b.field&&(f.sorted=!0,f.descending=d.descending,e=!0,a=d.descending),c.push(f)}}),!e&&c.length>0&&(c[0].sorted=!0,c[0].descending=!1,a=!1),{options:c,sortDescending:a}},_buildMobileSortOptions:function(){var a,b,c,d=this.ownerDocument,e=this._sortOptionsNode,f=this._getSortOptions(),g=f.options,h=f.sortDescending;e.innerHTML="",g.length>0&&this.showMobileSortOptions?(this._sortNode.style.display="block",b=d.createElement("ha-radio-button-group"),b.name="sort",c=[],g.forEach(function(b){a=d.createElement("ha-radio-button"),a.value=b.field,a.label=b.label,a.name="sort",b.sorted&&(a.checked=!0),c.push(a)}),b.radios=c,e.appendChild(b),e.appendChild(d.createElement("h4")),e.lastChild.textContent=this.mobileSortOrderText,b=d.createElement("ha-radio-button-group"),b.name="sortDir",c=[],c.push(d.createElement("ha-radio-button")),c[0].value="asc",c[0].label=this.mobileSortAscendingText,c[0].name="sortDir",c[0].checked=!h,c.push(d.createElement("ha-radio-button")),c[1].value="desc",c[1].label=this.mobileSortDescendingText,c[1].name="sortDir",c[1].checked=h,b.radios=c,e.appendChild(b)):this._sortNode.style.display="none"}}),b("ha-table",s)}),define("hui/table/ContentGroupMemory",["dojo/_base/declare","dojo/Deferred","dojo/when","dstore/QueryResults","dstore/Memory","dstore/Tree"],function(a,b,c,d,e,f){function g(a){return function(){var e,f=new b;try{f.resolve(this[a].apply(this,arguments))}catch(a){f.reject(a)}return e=new d(f.promise),e.totalLength=c(e.totalLength),e}}return a([e,f],{_lastExpanded:null,_forceGroupOrder:!1,forceGroupOrder:function(a){this._forceGroupOrder!==a&&(this._lastExpanded=null),this._forceGroupOrder=a},fetchGroupRangeSync:function(a){var b,c,e,f,g,h,i,j,k=this.data,l=a.start,m=a.end,n=m,o=a.virtual,p=a.expanded||[],q=null,r=this._forceGroupOrder?[]:null,s=!1,t=this._getRoots(),u=this,v=!1,w=0;if(this._lastExpanded)if(this._lastExpanded.length!==p.length)s=!0;else for(c=0;c<p.length;c++)this._lastExpanded[c]!==p[c]&&(s=!0);else s=!0;if(!k||k._version!==this.storage.version||s){for(k=this.storage.fullData,this._lastExpanded=p.map(function(a){return String(a)}),k=k.filter(function(a){return t.indexOf(a)<0}),b=this.queryLog,c=0,e=b.length;c<e;c++)b[c].querier.isSort?v=!0:i=!0,k=b[c].querier(k,t);for(v||(k=this._sortAndCombineChildCollections(this._getChildCollections(k,t))),this.totalLength=k.length,c=0;c<k.length;)if(null===q||k[c].parent!==q)for(q=k[c].parent,e=0;e<t.length;e++){if(this.getIdentity(t[e])===q){if(k.splice(c,0,t.splice(e,1)[0]),r){for(f=0;f<r.length;f++)k.splice(c,0,r[f]),c++;r=[]}c+=2;break}r&&(r.unshift(t.splice(e,1)[0]),e--)}else c++;k=k.filter(function(a){return u._lastExpanded.indexOf(String(a.parent))>=0||void 0===a.parent||null===a.parent}),k._version=this.storage.version,this.data=k}else t=t.filter(function(a){return k.indexOf(a)<0});for(l>=k.length&&(h=m-l,l=Math.floor((k.length-2)/h)*h,m=l+h),c=0;c<m&&c<k.length;c++)this.mayHaveChildren(k[c])&&(m++,c<l&&!o&&(l++,w++));return k=k.slice(l,m),g=k.length,g<m-l||n>=this.totalLength?(t.length>0&&!i&&(k=k.concat(t)),j=new d(k,{totalLength:this.totalLength}),j.isLastPage=!0):j=new d(k,{totalLength:this.totalLength}),h&&(j.start=l-w+1),j},_createSortQuerier:function(a){var b=this,c=function(c,d){var e="function"==typeof a?a:function(b,c){var d,e,f,g,h,i;for(d=0;d<a.length;d++)if("function"==typeof a[d]?e=a[d](b,c):(f=a[d].property,g=a[d].descending,h=b.get?b.get(f):b[f],i=c.get?c.get(f):c[f],null!=h&&(h=h.valueOf()),null!=i&&(i=i.valueOf()),e=h===i?0:!!g==(null===h||h>i&&null!==i)?-1:1),0!==e)return e;return 0},f=b._getChildCollections(c.slice(),d);return c=b._sortAndCombineChildCollections(f,e)};return c.isSort=!0,c},_sortAndCombineChildCollections:function(a,b){var c,d=function(a,c){return a&&a[0]?c&&c[0]?b?b(a[0],c[0]):0:-1:c&&c[0]?1:0};if(b)for(c=0;c<a.length;c++)a[c].sort(b);for(this._forceGroupOrder||a.sort(d),c=1;c<a.length;c++)a[0]=a[0].concat(a[c]);return a[0]},_getChildCollections:function(a,b){var c,d,e=[];for(d=0;d<b.length;d++)c=this.getIdentity(b[d]),e.push(a.filter(function(a){return a.parent===c}));return e},_getRoots:function(){return this.storage.fullData.filter(function(a){return null==a.parent})},mayHaveChildren:function(a){return void 0===a.parent||null===a.parent},fetchGroupRange:g("fetchGroupRangeSync")})}),define("hui/table/ContentGroupRequest",["dojo/_base/declare","dojo/_base/lang","dojo/request","dstore/Request","dstore/QueryResults"],function(a,b,c,d,e){return a(d,{_forceGroupOrder:!1,forceGroupOrder:function(a){this._forceGroupOrder=a},_renderExpandedParams:function(a){var b=a.length?this._forceGroupOrder?"&forceGroupOrder=true":"":this._forceGroupOrder?"forceGroupOrder=true":"";return a.map(function(a){return"expanded="+a}).join("&")+b},_renderRangeParams:function(){var a,b=arguments[2],c=this.inherited(arguments);return a=this._renderExpandedParams(b),a&&(c=c||[],c.push(a)),c},fetchGroupRange:function(a){var b,c,d,f=a.start,g=a.end,h=a.expanded||[],i={};return this.useRangeHeaders?(i.headers=this._renderRangeHeaders(f,g),(c=this._renderExpandedParams(h))&&(i.queryParams=[c])):i.queryParams=this._renderRangeParams(f,g,h),b=this._request(i),d=new e(b.data,{totalLength:b.total,response:b.response}),d.then?d.then(function(a){a.isLastPage=b.isLastPage,a.start=b.start}):(d.isLastPage=b.isLastPage,d.start=b.start),d},mayHaveChildren:function(a){return void 0===a.parent||null===a.parent},_request:function(a){a=a||{};var d,e,f,g,h=b.delegate(this.headers,{Accept:this.accepts});return"headers"in a&&b.mixin(h,a.headers),d=this._renderUrl(a.queryParams),e=c(d,{method:"GET",headers:h}),f=this,g=e.then(function(a){return f.parse(a)}),{data:g.then(function(a){var b,c,d=a.items||a;for(b=0,c=d.length;b<c;b++)d[b]=f._restore(d[b],!0);return d}),total:g.then(function(a){var b=a.total;return b>-1?b:e.response.then(function(a){var b=a.getHeader("Content-Range");return b&&(b=b.match(/\/(.*)/))&&+b[1]})}),response:e.response,isLastPage:g.then(function(a){return a.isLastPage}),start:g.then(function(a){return a.start})}}})}),define("hui/table/RendererFactoryRegistry",["../core/utils","object-utils/classes","./rendererFactoryFactory"],function(a,b,c){return b.extend(Object,{constructor:function(a){this.rendererClassesMap=a||{},console.warn("DEPRECATION WARNING: The RendererFactoryRegistry is deprecated and should should not be used anymore. Use the Table#addRenderMode method instead to directly add a render mode to a table")},getRendererFactory:function(){var a,b={};for(a in this.rendererClassesMap)this.rendererClassesMap.hasOwnProperty(a)&&(b[a]=new this.rendererClassesMap[a]);return c(b)},registerRenderer:function(a,b){this.rendererClassesMap[a]=b}})}),define("hui/table-virtual",["register-component/v2/register","object-utils/classes","./table","./table/TableBase","./core/keys"],function(a,b,c,d,e){return a("ha-table-virtual",b.createObject(c.prototype,{_createGrid:function(){var a=d.factory({table:this,virtual:!0,columns:this._getColumns()},this._gridNode);return a.addKeyHandler(e.ESCAPE,this._escapeHandler.bind(this)),a},_escapeHandler:function(){(this._getNextFocusableSibling()||this.querySelector(".table-escape-node")).focus()},_getNextFocusableSibling:function(){for(var a=this.nextElementSibling;a;){if(a.focus&&(a.focus(),this.ownerDocument.activeElement===a))return a;a=a.nextElementSibling}},_shouldShowPaginationSettings:function(){return!1}}))}),function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/PromiseManagerSingle",["exports","dojo/Deferred"],b);else if("undefined"!=typeof exports)b(exports,require("dojo/Deferred"));else{var c={exports:{}};b(c.exports,a.Deferred),a.PromiseManagerSingle=c.exports}}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{default:a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var e=c(b),f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function(){function a(){d(this,a),this.promise=null}return f(a,[{key:"getPromise",value:function(){return this.promise=this.promise||new e.default,this.promise}},{key:"getNewPromise",value:function(){return this.promise&&this.promise.cancel(),this.promise=new e.default,this.promise}},{key:"resolvePromise",value:function(a){this.promise&&(this.promise.resolve(a),this.promise=null)}},{key:"sort",value:function(){}},{key:"destroy",value:function(){this.promise&&(this.promise.cancel(),this.promise=null)}}]),a}();a.default=g});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};!function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/CallbackCollection",["exports","dstore/Store","dstore/QueryResults","./PromiseManagerSingle"],b);else if("undefined"!=typeof exports)b(exports,require("dstore/Store"),require("dstore/QueryResults"),require("./PromiseManagerSingle"));else{var c={exports:{}};b(c.exports,a.Store,a.QueryResults,a.PromiseManagerSingle),a.CallbackCollection=c.exports}}(this,function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":_typeof(b))&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(a,"__esModule",{value:!0});var i=e(b),j=e(c),k=e(d),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},n=function(a){function b(a){f(this,b);var c=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name="CallbackCollection",c.onDataChanged=a.onDataChanged,c.state={sortColumn:null,sortDescending:null,data:null,promiseManager:new k.default},c}return h(b,a),l(b,[{key:"sort",value:function(a){var c=a[0];return this.state.sortColumn=c.property,this.state.sortDescending=c.descending,this.state.promiseManager.sort(this.state.sortColumn,this.state.sortDescending),m(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"sort",this).call(this,a)}},{key:"fetchRange",value:function(a){var b=void 0,c=void 0,d={start:a.start,end:a.end,sortColumn:this.state.sortColumn,sortDescending:this.state.sortDescending};return this.state.data&&this.state.data.results?(c=this.state.promiseManager.getPromise(d),b=this.createResults(c),this.state.promiseManager.resolvePromise(this.state.data,d),this.state.data=null):(c=this.state.promiseManager.getNewPromise(d),b=this.createResults(c),this.onDataChanged(d)),b}},{key:"createResults",value:function(a){return new j.default(a.then(function(a){var b=a.results;return b.start=a.start+1,b}),{totalLength:a.then(function(a){return a.total})})}},{key:"setData",value:function(a){this.state.data=a}},{key:"destroy",value:function(){this.state.promiseManager.destroy(),this.onDataChanged=null,this.state=null}}]),b}(i.default);a.default=n}),function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/EventFilters",["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.EventFilters=c.exports}}(this,function(a){"use strict";function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function(){function a(){b(this,a)}return c(a,null,[{key:"noFilter",value:function(a){return a}},{key:"filterSelection",value:function(a){return{eventSelection:a.rows.map(function(a){return a.data}),tableSelectionById:a.grid.selection}}}]),a}();a.default=d}),function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/config",["exports","./EventFilters"],b);else if("undefined"!=typeof exports)b(exports,require("./EventFilters"));else{var c={exports:{}};b(c.exports,a.EventFilters),a.config=c.exports}}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(a,"__esModule",{value:!0});var d=c(b);a.default={customOptions:{onOtherSettingsRender:!0,renderModes:!0,onTableBarCustomRender:!0,onTableBarCustomActionRender:!0,virtual:!0,totals:!0},apiToExpose:{clearErrors:!0,onClickEdit:!0,refresh:!0,resize:!0,resizeColumnWidth:!0,revert:!0,save:!0},eventsToCallbacks:{onCancel:{name:"edit-cancel",filter:d.default.noFilter},onColumnHiddenChange:{name:"column-hidden-change",filter:d.default.noFilter},onColumnResize:{name:"column-resize",filter:d.default.noFilter},onDatachange:{name:"datachange",filter:d.default.noFilter},onDeselect:{name:"batch-deselect",filter:d.default.filterSelection},onError:{name:"error",filter:d.default.noFilter},onExport:{name:"export",filter:d.default.noFilter},onRefresh:{name:"refresh",filter:d.default.noFilter},onSelect:{name:"batch-select",filter:d.default.filterSelection},onSave:{name:"edit-save",filter:d.default.noFilter},onSort:{name:"sort",filter:d.default.noFilter}}}}),function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/PropUtils",["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.PropUtils=c.exports}}(this,function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},c=function(a){return!!a&&"object"===(void 0===a?"undefined":b(a))&&!Array.isArray(a)},d=function(a,b){return"for prop '"+a+"' in '"+b+".'"};a.default={getKey:function(a){return a.start+"-"+a.end+"-"+a.sortColumn+"-"+a.sortDescending},validateData:function(a,e,f){var g=d(e,f);return!a.collection||a.data||a.onDataChanged?!a.collection&&a.onDataChanged&&c(a.data)?null:a.collection&&(a.data||a.onDataChanged)?new Error("(101) "+g+" Prop 'collection' was specified but is not allowed when using props 'data' or 'onDataChanged'."):a.onDataChanged&&!c(a.data)?new Error("(102) "+g+" Prop 'onDataChanged' was specified but was not accompanied by prop 'data' of type object."):Array.isArray(a.data)?null:new Error("(103) "+g+" Prop 'data' must be an array. Type '"+b(a.data)+"' was found."):null},validateOptions:function(a,e,f){var g=d(e,f);return a.options?c(a.options)?a.options.virtual&&a.onDataChanged?new Error("(202) "+g+" Prop 'onDataChanged' was specified but it does not work with the 'virtual' true option."):null:new Error("(201) "+g+" Prop 'options' must be an object. Type '"+b(a.options)+"' was found."):null}}}),define("hui/table/LazyRowExpansionRenderer",["hui/table/DefaultRenderer","object-utils/classes","hui/core/keys","hui/core/a11y","hui/core/utils"],function(a,b,c,d,e){function f(a,b){var c=!0;if(a&&a.target){for(var d=a.target;d&&"HA-TABLE"!==d.tagName;)d.classList.contains(b)?(c=!1,d=null):d=d.parentElement;"HA-CHECKBOX"!==a.target.tagName&&"HA-RADIO-BUTTON"!==a.target.tagName&&"INPUT"!==a.target.tagName&&"BUTTON"!==a.target.tagName&&"A"!==a.target.tagName||(c=!1)}return c}function g(a,b){b?a.querySelector(".dgrid-grid").classList.add("animate-height"):a.querySelector(".dgrid-grid").classList.remove("animate-height")}var h=0,i="";return b.extend(a,{constructor:function(a){a=a||{},this.renderRowExpansionContent=a.renderRowExpansionContent||function(a){var b=this.table.ownerDocument.createElement("div"),c=this.table.store.getIdentity(a);return b.textContent="RowExpansion content for row with object id: "+c,b},this.activatorSelector=a.activatorSelector,this.expansionHeight=a.expansionHeight,this.manualActivation=a.manualActivation||!1,this.expansionClassName=a.expansionClassName,this.useFocusIndicator=a.useFocusIndicator||!1,this.focusIndicatorLabel=a.focusIndicatorLabel||"",this._expandedRows={},this.scrollingThreshold=a.scrollingThreshold||!1,this.autoResizeTable=a.autoResizeTable||!1,a.activatorSelector||(this.tableConfig={selectionMode:"none"})},_expansionMouseHandler:function(a){a.stopPropagation()},_toggleRowExpansion:function(a,b,c){""!==i&&(clearTimeout(i),i=""),i=setTimeout(function(){var d,f,h=a.querySelector(".ha-table-row-expansion"),i=this.table.row(a);if(h||(this.lazyRenderRowExpansion(a,b,c),h=a.querySelector(".ha-table-row-expansion")),a.querySelector("."+this.batchClass)?(h.classList.add("batch-table-expansion"),h.classList.remove("no-batch-table-expansion")):(h.classList.add("no-batch-table-expansion"),h.classList.remove("batch-table-expansion")),void 0!==b&&null!==b?d=!Boolean(b):(f=h.classList.contains("hidden")!==h.classList.contains("hide-expansion"),d=h.classList.contains("hidden")),!f)if(d){if(a.classList.add("row-expanded"),this._expandedRows[i.id]=!0,h.classList.remove("hidden"),this.useFocusIndicator&&a.classList.add("show-focus"),setTimeout(function(){h.classList.remove("hide-expansion"),this._handleFocusAndAriaAttributes(h,c,a)}.bind(this),0),!1!==this.scrollingThreshold){for(var j=a;j&&!j.classList.contains("dgrid-scroller");)j=j.parentElement;j&&setTimeout(function(){var b=j.getBoundingClientRect(),c=a.getBoundingClientRect();(b.bottom-c.top)/c.height<this.scrollingThreshold&&e.animateScrollTo(j,a.offsetTop,150)}.bind(this),50)}this._autoResize()}else a.classList.remove("row-expanded"),delete this._expandedRows[i.id],h.classList.add("hide-expansion"),this.useFocusIndicator&&a.classList.remove("show-focus"),setTimeout(function(){h.classList.add("hidden")}.bind(this),350),this.autoResizeTable&&setTimeout(function(){g(this.table,!0),this.table._calculateInitialHeight({type:"row-expander-resize"}),setTimeout(function(){g(this.table,!1)}.bind(this),250)}.bind(this),250),this._handleFocusAndAriaAttributes(h,c,a)}.bind(this),250)},lazyRenderRowExpansion:function(a,b,e){var g,h=this.table,i=h.ownerDocument.createElement("div"),j=function(b,c){(this.activatorSelector||f(b,this.batchClass))&&this._toggleRowExpansion(a,c,e)}.bind(this),k=function(b,c){this._toggleRowExpansion(a,c,e)}.bind(this),l=function(a){a.keyCode===c.ESCAPE&&j(),d.keepFocusInsideListener(a,i)}.bind(this),m=e._expansionData,n=this.renderRowExpansionContent(m,k),o=h.ownerDocument.createElement("button"),p=a.querySelector("."+this.batchClass);if(i.id=e._expansionId,this.expansionHeight&&(i.style.height=this.expansionHeight+"px"),o.className="hi hi-close close-expansion-button",o.addEventListener("click",k),o.setAttribute("aria-label","Close expanded row"),i.appendChild(n),this.manualActivation||(n.appendChild(o),i.setAttribute("tabindex","-1"),i.addEventListener("keydown",l),i.addEventListener("click",this._expansionMouseHandler),i.addEventListener("mousedown",this._expansionMouseHandler),i.addEventListener("touchstart",this._expansionMouseHandler)),i.className="ha-table-row-expansion",m.id in this._expandedRows||(i.classList.add("hide-expansion"),i.classList.add("hidden")),this.expansionClassName&&i.classList.add(this.expansionClassName),p?(i.classList.add("batch-table-expansion"),a.classList.add("row-expanded")):i.classList.add("no-batch-table-expansion"),this.useFocusIndicator){var q=document.createElement("button"),r=function(){this._toggleRowExpansion(a,!0,e)}.bind(this);q.className="focus-indicator hi hi-chevron-down",this.focusIndicatorLabel&&q.setAttribute("aria-label",this.focusIndicatorLabel),q.addEventListener("click",r),a.appendChild(q)}g=function(){o&&o.removeEventListener&&(o.removeEventListener("click",k),n&&n.removeChild&&n.removeChild(o)),q&&q.removeEventListener&&q.removeEventListener("click",r),i&&i.removeEventListener&&(i.removeEventListener("keydown",l),i.removeEventListener("click",this._expansionMouseHandler),i.removeEventListener("mousedown",this._expansionMouseHandler),i.removeEventListener("touchstart",this._expansionMouseHandler))},i.cleanUpListeners=function(){g&&g(),n&&n.destroy&&n.destroy()},a.appendChild(i)},_handleFocusAndAriaAttributes:function(a,b,c){a.classList.contains("hide-expansion")?(b.hasAttribute("tabindex")||(b.setAttribute("tabindex","-1"),b.addEventListener("blur",function a(){b.removeAttribute("tabindex"),b.removeEventListener("blur",a)})),b.focus(),b.setAttribute("aria-expanded",!1),c.classList.remove("highlighted-dgrid-row"),this.table.emit("expandable-row-close",{bubbles:!1,row:c})):(b.setAttribute("aria-expanded",!0),c.classList.add("highlighted-dgrid-row"),a.focus(),this.table.emit("expandable-row-show",{bubbles:!1,row:c}))},_autoResize:function(){this.autoResizeTable&&setTimeout(function(){this.table._calculateInitialHeight({type:"row-expander-resize"})}.bind(this),0)},addExpansionListeners:function(a,b){var d,e,g=a.querySelector("table")||a,i=function(b,c){(this.activatorSelector||f(b,this.batchClass))&&this._toggleRowExpansion(a,c,g)}.bind(this),j=function(a){a.keyCode!==c.ENTER&&a.keyCode!==c.SPACEBAR||i(a)};return e=function(){g&&g.removeEventListener&&(g.removeEventListener("click",i),"BUTTON"!==g.tagName&&g.removeEventListener("keydown",j))},this.manualActivation||(this.activatorSelector&&(g=a.querySelector(this.activatorSelector)),d="table-row-expansion"+h++,g._expansionId=d,g._expansionData=b,g._keyboardEventHandler=j,g.setAttribute("aria-controls",d),g.setAttribute("aria-expanded",!1),e&&e(),g&&g.addEventListener&&(g.addEventListener("click",i),"BUTTON"!==g.tagName&&g.addEventListener("keydown",j))),this._expandedRows&&!0===this._expandedRows[b.id]&&(this.lazyRenderRowExpansion(a,!1,g),this._autoResize()),a.destroy=function(){var b=a.querySelector(".ha-table-row-expansion");b&&b.cleanUpListeners&&b.cleanUpListeners(),e&&e()},a},row:function(a,b,c){var d=c();return this.addExpansionListeners(d,a,b)},setup:function(){this.batchClass="field-"+this.table.batchField}})});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};!function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/Table",["exports","react","react-dom","dstore/Memory","./CallbackCollection","./config","./PropUtils","put-selector/put","hui/table/LazyRowExpansionRenderer","hui/table","hui/table-virtual","xstyle/css!hui-css/hui-table.min.css"],b);else if("undefined"!=typeof exports)b(exports,require("react"),require("react-dom"),require("dstore/Memory"),require("./CallbackCollection"),require("./config"),require("./PropUtils"),require("put-selector/put"),require("hui/table/LazyRowExpansionRenderer"),require("hui/table"),require("hui/table-virtual"),require("xstyle/css!hui-css/hui-table.min.css"));else{var c={exports:{}};b(c.exports,a.react,a.reactDom,a.Memory,a.CallbackCollection,a.config,a.PropUtils,a.put,a.LazyRowExpansionRenderer,a.table,a.tableVirtual,a.huiTableMin),a.Table=c.exports}}(this,function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":_typeof(b))&&"function"!=typeof b?a:b}function m(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(a,"__esModule",{value:!0});var n=j(b),o=j(c),p=j(d),q=j(e),r=j(f),s=j(g),t=j(h),u=j(i),v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),w=function(a){function b(a){k(this,b);var c=l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.api={},c.store=null,c.totals=null,c.table=null,c.cache={},c.otherSettingsNode=null,c.tableBarCustomNode=null,c.tableBarCustomActionNode=null,c}return m(b,a),v(b,null,[{key:"displayName",get:function(){return"Table"}},{key:"propTypes",get:function(){return{columns:n.default.PropTypes.object.isRequired,data:s.default.validateData,onDataChanged:n.default.PropTypes.func,collection:n.default.PropTypes.object,options:s.default.validateOptions,pause:n.default.PropTypes.bool}}}]),v(b,[{key:"componentDidMount",value:function(){var a=this;this.table=this.renderTable(),this.wrapper.appendChild(this.table),setTimeout(function(){a.postTableRender(a.table,a.props.options,a.props.data)},0)}},{key:"shouldComponentUpdate",value:function(a){if(a.pause){var b=this.table.table,c=b.contentNode;this.cleanupContent(b);(b.loadingNode=(0,t.default)(c,"div.dgrid-loading[role=alert]")).innerHTML=b.loadingMessage}else this.mixinOptions(this.table,a.options),this.connectCallbacks(this.table,a.options),this.setStoreData(a.data),this.postTableRender(this.table,a.options,a.data),this.table.columns=this.adaptColumns(a.columns);return!1}},{key:"componentWillUnmount",value:function(){this.otherSettingsNode&&o.default.unmountComponentAtNode(this.otherSettingsNode),this.tableBarCustomNode&&o.default.unmountComponentAtNode(this.tableBarCustomNode),this.tableBarCustomActionNode&&o.default.unmountComponentAtNode(this.tableBarCustomActionNode),this.clearCache(),this.store.destroy&&this.store.destroy(),this.table=null,this.api=null,this.totals=null,this.store=null,this.wrapper=null,this.otherSettingsNode=null,this.tableBarCustomNode=null,this.tableBarCustomActionNode=null,this.cache=null}},{key:"cleanupContent",value:function(a){a.noDataNode?((0,t.default)(a.noDataNode,"!"),delete a.noDataNode):a.cleanup(),a.contentNode.innerHTML=""}},{key:"clearCache",value:function(){var a=this;Object.keys(this.cache).forEach(function(b){o.default.unmountComponentAtNode(a.cache[b])}),this.cache={}}},{key:"handleWrapperRef",value:function(a){this.wrapper=a}},{key:"shouldUpdateTableProperty",value:function(a,b,c){return!r.default.customOptions[b]&&!r.default.eventsToCallbacks[b]&&a[b]!==c}},{key:"connectCallbacks",value:function(a,b){a&&b&&Object.keys(r.default.eventsToCallbacks).forEach(function(c){var d=b[c],e=void 0,f=void 0,g=void 0;d&&(e=r.default.eventsToCallbacks[c],f=e.name,g=e.filter,a.off(f),a.on(f,function(a){var b=g(a);d(b)}))})}},{key:"mixinOptions",value:function(a,b){var c=this;a&&b&&Object.keys(b).forEach(function(d){var e=b[d];c.shouldUpdateTableProperty(a,d,e)&&(a[d]=e)})}},{key:"adaptColumns",value:function(a){var b=this,c={};return Object.keys(a).forEach(function(d){var e=void 0,f=b;c[d]=a[d],e=c[d].onRenderCell,e&&(c[d].renderCell=function(a,b,c,d){var g=e({rowData:a,value:b,options:d,column:this.field});return f.renderReactCell(g,this.field,a,b,c)}),c[d].onRenderHeaderCell&&(c[d].renderHeaderCell=function(a){var b=c[d].onRenderHeaderCell();b&&o.default.render(b,a)})}),c}},{key:"renderReactCell",value:function(a,b,c,d,e){var f=this.store.getIdentity(c),g=this.getCellKey(f,b),h=this.cache[g],i=h||document.createElement("div");o.default.render(a,i),this.cache[g]=i,e.appendChild(i)}},{key:"getCellKey",value:function(a,b){return a+"-"+b}},{key:"getStore",value:function(){return this.store?this.store:this.props.collection?this.props.collection:this.props.onDataChanged?new q.default({onDataChanged:this.props.onDataChanged,allowMultipleConcurrentRequests:this.props.options.virtual}):new p.default}},{key:"shouldSyncCallbackCollection",value:function(){return this.table&&this.table.table&&this.table.table._renderedCollection&&"CallbackCollection"===this.table.table._renderedCollection.name}},{key:"setStoreData",value:function(a){a&&(this.store.setData(a),this.shouldSyncCallbackCollection()&&(this.table.table._renderedCollection.state=this.store.state))}},{key:"exposeApi",value:function(a){var b=this;Object.keys(r.default.apiToExpose).forEach(function(c){b.api[c]=function(){return a[c].apply(a,arguments)}})}},{key:"addRenderModes",value:function(a,b){var c=this;b&&b.renderModes&&b.renderModes.forEach(function(b){var d=b.renderer.expansionHeight,e=b.renderer.activatorSelector,f=b.renderer.autoResizeTable,g=b.renderer.scrollingThreshold,h=b.renderer.expansionClassName,i=b.renderer.useFocusIndicator,j=b.renderer.focusIndicatorLabel,k=null,l=null;b.renderer.onRenderRowExpansionContent&&(k=function(a,d){var e=b.renderer.onRenderRowExpansionContent({object:a,hideExpansion:d});return c.renderReactRowExpansionContent(e)}),l=u.default.bind(null,{activatorSelector:e,expansionHeight:d,renderRowExpansionContent:k,autoResizeTable:f,scrollingThreshold:g,expansionClassName:h,useFocusIndicator:i,focusIndicatorLabel:j}),a.addRenderMode(b.renderMode,new l)})}},{key:"renderReactRowExpansionContent",value:function(a){var b=document.createElement("div");return o.default.render(a,b),b}},{key:"updateRowSelection",value:function(a,b){var c=this,d=b.results||b;d&&d.length>0&&d.forEach(function(b){var d=c.store.getIdentity(b),e=a.row(d);!0===b._selected?a.select(e):!1===b._selected&&a.deselect(e)})}},{key:"applyOtherSettings",value:function(a,b){if(b.onOtherSettingsRender){var c=b.onOtherSettingsRender();o.default.render(c,a.otherSettingsNode),this.otherSettingsNode=a.otherSettingsNode}}},{key:"applyTableBarCustomContent",value:function(a,b){if(b.onTableBarCustomRender){var c=b.onTableBarCustomRender();o.default.render(c,a.tableBarCustomNode),this.tableBarCustomNode=a.tableBarCustomNode}if(b.onTableBarCustomActionRender){var d=b.onTableBarCustomActionRender();o.default.render(d,a.tableBarCustomActionNode),this.tableBarCustomActionNode=a.tableBarCustomActionNode}}},{key:"applyTotals",value:function(a,b){var c=this;b.totals&&!this.totals&&a.on("table-resize",function(){a.totals=c.totals}),this.totals=b.totals}},{key:"postTableRender",value:function(a,b,c){b&&(this.applyOtherSettings(a,b),this.applyTableBarCustomContent(a,b),this.applyTotals(a,b)),c&&this.updateRowSelection(a,c)}},{key:"renderTable",value:function(){var a=this.props.options,b=a&&a.virtual?"ha-table-virtual":"ha-table",c=document.createElement(b);return this.store=this.getStore(),this.setStoreData(this.props.data),this.mixinOptions(c,a),this.connectCallbacks(c,a),c.collection=this.store,c.columns=this.adaptColumns(this.props.columns),this.exposeApi(c),a&&a.renderModes&&this.addRenderModes(c,a),c}},{key:"render",value:function(){var a=this.handleWrapperRef.bind(this);return n.default.createElement("div",{className:"ha-table-react-wrapper",ref:a})}}]),b}(n.default.Component);a.default=w}),define("../../build/dist/js/hui-table",function(){});
//# sourceMappingURL=hui-table.min.map